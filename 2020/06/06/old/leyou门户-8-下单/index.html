<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="主要是调用支付接口，微信支付、支付宝支付的接口调用：  会调用订单系统接口 实现订单结算功能 实现微信支付功能">
<meta property="og:type" content="article">
<meta property="og:title" content="leyou门户#8-下单">
<meta property="og:url" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/index.html">
<meta property="og:site_name" content="摘星">
<meta property="og:description" content="主要是调用支付接口，微信支付、支付宝支付的接口调用：  会调用订单系统接口 实现订单结算功能 实现微信支付功能">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1527849592739.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1527849713858.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1527849755740.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1527988253596.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1527988384844.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1528724925709.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534050474425.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534050501639.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534050571547.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1528726383029.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534050960735.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534056625226.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534056963545.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534057111628.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534057197865.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534057752285.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1528729105237.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534057869509.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534058725566.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534058696076.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534059150417.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534059488506.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534059550338.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534059762431.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534059802562.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534059974834.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534060051812.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1528796883071.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534060875467.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534061834503.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534061965270.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534062028046.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534062115599.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1527990452791.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534062458952.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534063127883.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534063368728.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534068627040.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1528011713709.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534070259673.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1528012065388.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534070467947.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534070743780.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1528012881735.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534071010391.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534071493245.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534071647717.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534071794146.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534072483208.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534072753146.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534073678931.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534073704731.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534074122199.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534074293296.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534074374101.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1528340102503.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1528340136603.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1528340413139.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1527848350188.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1527848358128.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1527848368179.png">
<meta property="og:image" content="e:/java/%E6%95%99%E7%A8%8B/04-%E6%9E%B6%E6%9E%84%E7%8F%AD/06-%E9%A1%B9%E7%9B%AE-%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E-11%E6%9C%88%E7%89%88/leyou/day19-%E4%B8%8B%E5%8D%95/%E7%AC%94%E8%AE%B0/%E7%AC%94%E8%AE%B0/assets/chapter6_5_1.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1528362159620.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1528362220886.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534313526721.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1528362348399.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534313925398.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1528362377494.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1528362023061.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1528362420151.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1528362464276.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1528376883924.png">
<meta property="article:published_time" content="2020-06-06T09:32:26.000Z">
<meta property="article:modified_time" content="2020-06-06T09:32:26.000Z">
<meta property="article:author" content="摘星">
<meta property="article:tag" content="API">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1527849592739.png">

<link rel="canonical" href="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>leyou门户#8-下单 | 摘星</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">摘星</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/06/old/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="摘星">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="摘星">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          leyou门户#8-下单
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-06 17:32:26" itemprop="dateCreated datePublished" datetime="2020-06-06T17:32:26+08:00">2020-06-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/leyou/" itemprop="url" rel="index"><span itemprop="name">leyou</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>主要是调用支付接口，微信支付、支付宝支付的接口调用：</p>
<ul>
<li>会调用订单系统接口</li>
<li>实现订单结算功能</li>
<li>实现微信支付功能</li>
</ul>
<a id="more"></a>

<h1 id="1-订单系统接口"><a href="#1-订单系统接口" class="headerlink" title="1.订单系统接口"></a>1.订单系统接口</h1><p>我们不做开发，只讲解</p>
<h2 id="1-1-导入订单服务"><a href="#1-1-导入订单服务" class="headerlink" title="1.1.导入订单服务"></a>1.1.导入订单服务</h2><p>把课前资料提供的<code>leyou-order</code>复制到<code>D:\heima\code\leyou</code>目录。</p>
<p>然后在工程内导入：</p>
<p> <img src="1527849592739.png" alt="1527849592739"></p>
<p>然后导入module：</p>
<p> <img src="1527849713858.png" alt="1527849713858"></p>
<p>选择导入module：</p>
<p> <img src="1527849755740.png" alt="1527849755740"></p>
<p>选择目录中的 <code>ly-order</code>：</p>
<p> <img src="1527988253596.png" alt="1527988253596"></p>
<p>打开父工程leyou的pom文件，添加<code>ly-order</code>模块：</p>
<p><img src="1527988384844.png" alt="1527988384844"></p>
<h2 id="1-2-Swagger-UI"><a href="#1-2-Swagger-UI" class="headerlink" title="1.2.Swagger-UI"></a>1.2.Swagger-UI</h2><p>丝袜哥</p>
<h3 id="1-2-1-什么是OpenAPI"><a href="#1-2-1-什么是OpenAPI" class="headerlink" title="1.2.1.什么是OpenAPI"></a>1.2.1.什么是OpenAPI</h3><p>随着互联网技术的发展，现在的网站架构基本都由原来的后端渲染，变成了：前端渲染、前后端分离的形态，而且前端技术和后端技术在各自的道路上越走越远。  前端和后端的唯一联系，变成了API接口；API文档变成了前后端开发人员联系的纽带，变得越来越重要。</p>
<p>没有API文档工具之前，大家都是手写API文档的，在什么地方书写的都有，而且API文档没有统一规范和格式，每个公司都不一样。这无疑给开发带来了灾难。</p>
<p>OpenAPI规范（OpenAPI Specification 简称OAS）是Linux基金会的一个项目，试图通过定义一种用来描述API格式或API定义的语言，来规范RESTful服务开发过程。目前V3.0版本的OpenAPI规范已经发布并开源在github上 。</p>
<p>官网：<a href="https://github.com/OAI/OpenAPI-Specification" target="_blank" rel="noopener">https://github.com/OAI/OpenAPI-Specification</a></p>
<h3 id="1-2-2-什么是swagger？"><a href="#1-2-2-什么是swagger？" class="headerlink" title="1.2.2.什么是swagger？"></a>1.2.2.什么是swagger？</h3><p>OpenAPI是一个编写API文档的规范，然而如果手动去编写OpenAPI规范的文档，是非常麻烦的。而Swagger就是一个实现了OpenAPI规范的工具集。</p>
<p>官网：<a href="https://swagger.io/" target="_blank" rel="noopener">https://swagger.io/</a></p>
<p>看官方的说明：</p>
<p> <img src="1528724925709.png" alt="1528724925709"></p>
<p>Swagger包含的工具集：</p>
<ul>
<li><strong>Swagger编辑器：</strong> Swagger Editor允许您在浏览器中编辑YAML中的OpenAPI规范并实时预览文档。</li>
<li><strong>Swagger UI：</strong> Swagger UI是HTML，Javascript和CSS资产的集合，可以从符合OAS标准的API动态生成漂亮的文档。</li>
<li><strong>Swagger Codegen：</strong>允许根据OpenAPI规范自动生成API客户端库（SDK生成），服务器存根和文档。</li>
<li><strong>Swagger Parser：</strong>用于解析来自Java的OpenAPI定义的独立库</li>
<li><strong>Swagger Core：</strong>与Java相关的库，用于创建，使用和使用OpenAPI定义</li>
<li><strong>Swagger Inspector（免费）：</strong> API测试工具，可让您验证您的API并从现有API生成OpenAPI定义</li>
<li><strong>SwaggerHub（免费和商业）：</strong> API设计和文档，为使用OpenAPI的团队构建。</li>
</ul>
<h3 id="1-2-3-快速入门"><a href="#1-2-3-快速入门" class="headerlink" title="1.2.3.快速入门"></a>1.2.3.快速入门</h3><p>SpringBoot已经集成了Swagger，使用简单注解即可生成swagger的API文档。</p>
<h4 id="1）引入依赖"><a href="#1）引入依赖" class="headerlink" title="1）引入依赖"></a>1）引入依赖</h4><pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>io.springfox<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>springfox-swagger2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.8.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>io.springfox<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>springfox-swagger-ui<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.8.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="2）编写配置"><a href="#2）编写配置" class="headerlink" title="2）编写配置"></a>2）编写配置</h4><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableSwagger2</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SwaggerConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> Docket <span class="token function">api</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Docket</span><span class="token punctuation">(</span>DocumentationType<span class="token punctuation">.</span>SWAGGER_2<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">host</span><span class="token punctuation">(</span><span class="token string">"http://order.leyou.com"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">apiInfo</span><span class="token punctuation">(</span><span class="token function">apiInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">apis</span><span class="token punctuation">(</span>RequestHandlerSelectors<span class="token punctuation">.</span><span class="token function">basePackage</span><span class="token punctuation">(</span><span class="token string">"com.leyou.order.controller"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">paths</span><span class="token punctuation">(</span>PathSelectors<span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> ApiInfo <span class="token function">apiInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ApiInfoBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token string">"乐优商城订单系统"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">"乐优商城订单系统接口文档"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token string">"1.0"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="3）接口声明"><a href="#3）接口声明" class="headerlink" title="3）接口声明"></a>3）接口声明</h4><p>在controller的每个handler上添加接口说明注解：</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"order"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Api</span><span class="token punctuation">(</span><span class="token string">"订单服务接口"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> OrderService orderService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> PayHelper payHelper<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * 创建订单
     *
     * @param order 订单对象
     * @return 订单编号
     */</span>
    <span class="token annotation punctuation">@PostMapping</span>
    <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"创建订单接口，返回订单编号"</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">"创建订单"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ApiImplicitParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"order"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"订单的json对象,包含订单条目和物流信息"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> ResponseEntity<span class="token operator">&lt;</span>Long<span class="token operator">></span> <span class="token function">createOrder</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token annotation punctuation">@Valid</span> Order order<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Long id <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>orderService<span class="token punctuation">.</span><span class="token function">createOrder</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResponseEntity</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> HttpStatus<span class="token punctuation">.</span>CREATED<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">/**
     * 分页查询当前用户订单
     *
     * @param status 订单状态
     * @return 分页订单数据
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"list"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"分页查询当前用户订单，并且可以根据订单状态过滤"</span><span class="token punctuation">,</span> 
                  notes <span class="token operator">=</span> <span class="token string">"分页查询当前用户订单"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ApiImplicitParams</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token annotation punctuation">@ApiImplicitParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"page"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"当前页"</span><span class="token punctuation">,</span> 
                          defaultValue <span class="token operator">=</span> <span class="token string">"1"</span><span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token string">"Integer"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token annotation punctuation">@ApiImplicitParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"rows"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"每页大小"</span><span class="token punctuation">,</span> 
                          defaultValue <span class="token operator">=</span> <span class="token string">"5"</span><span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token string">"Integer"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token annotation punctuation">@ApiImplicitParam</span><span class="token punctuation">(</span>
            name <span class="token operator">=</span> <span class="token string">"status"</span><span class="token punctuation">,</span> 
            value <span class="token operator">=</span> <span class="token string">"订单状态：1未付款，2已付款未发货，3已发货未确认，4已确认未评价，5交易关闭，6交易成功，已评价"</span><span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token string">"Integer"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> ResponseEntity<span class="token operator">&lt;</span>PageResult<span class="token operator">&lt;</span>Order<span class="token operator">>></span> <span class="token function">queryUserOrderList</span><span class="token punctuation">(</span>
        <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"page"</span><span class="token punctuation">,</span> defaultValue <span class="token operator">=</span> <span class="token string">"1"</span><span class="token punctuation">)</span> Integer page<span class="token punctuation">,</span>
        <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"rows"</span><span class="token punctuation">,</span> defaultValue <span class="token operator">=</span> <span class="token string">"5"</span><span class="token punctuation">)</span> Integer rows<span class="token punctuation">,</span>
        <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"status"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> Integer status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        PageResult<span class="token operator">&lt;</span>Order<span class="token operator">></span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>orderService<span class="token punctuation">.</span><span class="token function">queryUserOrderList</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> rows<span class="token punctuation">,</span> status<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResponseEntity</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span>HttpStatus<span class="token punctuation">.</span>NOT_FOUND<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> ResponseEntity<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>常用注解说明：</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 @Api：修饰整个类，描述Controller的作用
 @ApiOperation：描述一个类的一个方法，或者说一个接口
 @ApiParam：单个参数描述
 @ApiModel：用对象来接收参数
 @ApiProperty：用对象接收参数时，描述对象的一个字段
 @ApiResponse：HTTP响应其中1个描述
 @ApiResponses：HTTP响应整体描述
 @ApiIgnore：使用该注解忽略这个API
 @ApiError ：发生错误返回的信息
 @ApiImplicitParam：一个请求参数
 @ApiImplicitParams：多个请求参数
 */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="4）启动测试"><a href="#4）启动测试" class="headerlink" title="4）启动测试"></a>4）启动测试</h4><p>启动服务，然后访问：<a href="http://localhost:8089/swagger-ui.html" target="_blank" rel="noopener">http://localhost:8089/swagger-ui.html</a></p>
<p><img src="1534050474425.png" alt="1534050474425"></p>
<p>点击order-controller，查看接口信息：</p>
<p><img src="1534050501639.png" alt="1534050501639"></p>
<p>点击任意一个接口，即可看到详细信息：</p>
<p><img src="1534050571547.png" alt="1534050571547"></p>
<h2 id="1-3-测试接口"><a href="#1-3-测试接口" class="headerlink" title="1.3.测试接口"></a>1.3.测试接口</h2><h3 id="1-3-1-创建订单接口"><a href="#1-3-1-创建订单接口" class="headerlink" title="1.3.1.创建订单接口"></a>1.3.1.创建订单接口</h3><p>可以通过页面看到接口信息：</p>
<ul>
<li>请求方式：POST</li>
<li>请求路径：/order</li>
<li>请求参数：包含订单、订单详情等数据的json对象。</li>
<li>返回结果：订单编号</li>
</ul>
<p>点击<code>Try It Out</code>来测试：</p>
<p><img src="1528726383029.png" alt="1528726383029"></p>
<p>输入数据：</p>
<pre class="line-numbers language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"totalPay"</span><span class="token operator">:</span> <span class="token number">236800</span><span class="token punctuation">,</span>
  <span class="token property">"postFee"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">"paymentType"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token property">"actualPay"</span><span class="token operator">:</span> <span class="token number">236800</span><span class="token punctuation">,</span>
  <span class="token property">"buyerMessage"</span><span class="token operator">:</span> <span class="token null">null</span><span class="token punctuation">,</span>
  <span class="token property">"buyerNick"</span><span class="token operator">:</span> <span class="token string">"huge"</span><span class="token punctuation">,</span>
  <span class="token property">"orderDetails"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">"skuId"</span><span class="token operator">:</span> <span class="token number">3893493</span><span class="token punctuation">,</span>
      <span class="token property">"num"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"苹果（Apple）iPhone 6 (A1586) 16GB 金色 移动联通电信4G手机3"</span><span class="token punctuation">,</span>
      <span class="token property">"price"</span><span class="token operator">:</span> <span class="token number">236800</span><span class="token punctuation">,</span>
      <span class="token property">"ownSpec"</span><span class="token operator">:</span> <span class="token property">"{\"机身颜色\":\"钻雕蓝\",\"内存\":\"4GB\",\"机身存储\"</span><span class="token operator">:</span>\<span class="token string">"64GB\"}"</span><span class="token punctuation">,</span>
      <span class="token property">"image"</span><span class="token operator">:</span> <span class="token string">"http://image.leyou.com/images/9/4/1524297342728.jpg"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"receiver"</span><span class="token operator">:</span> <span class="token string">"锋哥"</span><span class="token punctuation">,</span>
  <span class="token property">"receiverMobile"</span><span class="token operator">:</span> <span class="token string">"15800000000"</span><span class="token punctuation">,</span>
  <span class="token property">"receiverState"</span><span class="token operator">:</span> <span class="token string">"上海"</span><span class="token punctuation">,</span>
  <span class="token property">"receiverCity"</span><span class="token operator">:</span> <span class="token string">"上海"</span><span class="token punctuation">,</span>
  <span class="token property">"receiverDistrict"</span><span class="token operator">:</span> <span class="token string">"浦东新签"</span><span class="token punctuation">,</span>
  <span class="token property">"receiverAddress"</span><span class="token operator">:</span> <span class="token string">"航头镇航头路18号传智播客3号楼"</span><span class="token punctuation">,</span>
  <span class="token property">"receiverZip"</span><span class="token operator">:</span> <span class="token string">"210000"</span><span class="token punctuation">,</span>
  <span class="token property">"invoiceType"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">"sourceType"</span><span class="token operator">:</span><span class="token number">2</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>然后点击execute：</p>
<p><img src="1534050960735.png" alt="1534050960735"></p>
<p>结果：</p>
<p><img src="1534056625226.png" alt="1534056625226"></p>
<p>下单需要登录，通过登录生成token：</p>
<p><img src="1534056963545.png" alt="1534056963545"></p>
<p>把token的值手动加入到浏览器的cookie中：</p>
<p><img src="1534057111628.png" alt="1534057111628"></p>
<p><img src="1534057197865.png" alt="1534057197865"></p>
<p>添加成功，响应订单编号。但是和数据库保存的订单编号不太一样（后几位不一样，浏览器展示长整型会出现精度损失）</p>
<h3 id="1-3-2-生成ID的方式"><a href="#1-3-2-生成ID的方式" class="headerlink" title="1.3.2.生成ID的方式"></a>1.3.2.生成ID的方式</h3><blockquote>
<p>订单id的特殊性</p>
</blockquote>
<p>订单数据非常庞大，将来一定会做分库分表。那么这种情况下， 要保证id的唯一，就不能靠数据库自增，而是自己来实现算法，生成唯一id。</p>
<blockquote>
<p>雪花算法</p>
</blockquote>
<p>这里的订单id是通过一个工具类生成的：</p>
<p> <img src="1534057752285.png" alt="1534057752285"></p>
<p>而工具类所采用的生成id算法，是由Twitter公司开源的snowflake（雪花）算法。</p>
<blockquote>
<p>简单原理</p>
</blockquote>
<p>雪花算法会生成一个64位的二进制数据，为一个Long型。(转换成字符串后长度最多19) ，其基本结构：</p>
<p> <img src="1528729105237.png" alt="1528729105237"></p>
<p>第一位：为未使用</p>
<p>第二部分：41位为毫秒级时间(41位的长度可以使用69年)</p>
<p>第三部分：5位datacenterId和5位workerId(10位的长度最多支持部署1024个节点）</p>
<p>第四部分：最后12位是毫秒内的计数（12位的计数顺序号支持每个节点每毫秒产生4096个ID序号）</p>
<p>snowflake生成的ID整体上按照时间自增排序，并且整个分布式系统内不会产生ID碰撞（由datacenter和workerId作区分），并且效率较高。经测试snowflake每秒能够产生26万个ID。</p>
<blockquote>
<p>配置</p>
</blockquote>
<p>为了保证不重复，我们给每个部署的节点都配置机器id：</p>
<pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">leyou</span><span class="token punctuation">:</span>
  <span class="token key atrule">worker</span><span class="token punctuation">:</span>
    <span class="token key atrule">workerId</span><span class="token punctuation">:</span> <span class="token number">1</span>
    <span class="token key atrule">datacenterId</span><span class="token punctuation">:</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>加载属性：</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">"leyou.worker"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IdWorkerProperties</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">long</span> workerId<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 当前机器id</span>

    <span class="token keyword">private</span> <span class="token keyword">long</span> datacenterId<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 序列号</span>

    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getWorkerId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> workerId<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setWorkerId</span><span class="token punctuation">(</span><span class="token keyword">long</span> workerId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>workerId <span class="token operator">=</span> workerId<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getDatacenterId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> datacenterId<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDatacenterId</span><span class="token punctuation">(</span><span class="token keyword">long</span> datacenterId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>datacenterId <span class="token operator">=</span> datacenterId<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>编写配置类：</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span>IdWorkerProperties<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IdWorkerConfig</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> IdWorker <span class="token function">idWorker</span><span class="token punctuation">(</span>IdWorkerProperties prop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">IdWorker</span><span class="token punctuation">(</span>prop<span class="token punctuation">.</span><span class="token function">getWorkerId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> prop<span class="token punctuation">.</span><span class="token function">getDatacenterId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>使用：</p>
</blockquote>
<p><img src="1534057869509.png" alt="1534057869509"></p>
<h3 id="1-3-2-查询订单接口"><a href="#1-3-2-查询订单接口" class="headerlink" title="1.3.2.查询订单接口"></a>1.3.2.查询订单接口</h3><p>接口说明：</p>
<ul>
<li>请求方式：GET</li>
<li>请求路径：/order/{id}</li>
<li>请求参数：id，订单编号</li>
<li>返回结果：Order，订单的json对象</li>
</ul>
<p>测试：</p>
<p><img src="1534058725566.png" alt="1534058725566"></p>
<p>结果：</p>
<p><img src="1534058696076.png" alt="1534058696076"></p>
<h3 id="1-3-3-更新订单状态"><a href="#1-3-3-更新订单状态" class="headerlink" title="1.3.3.更新订单状态"></a>1.3.3.更新订单状态</h3><p>接口说明：</p>
<ul>
<li>请求参数：PUT</li>
<li>请求路径：/order/{id}/{status}</li>
<li>请求参数：<ul>
<li>id：订单编号，String类型，不能为空</li>
<li>status：订单状态，不能为空</li>
</ul>
</li>
<li>返回结果：null</li>
</ul>
<p>测试：</p>
<p><img src="1534059150417.png" alt="1534059150417"></p>
<p>结果：</p>
<p><img src="1534059488506.png" alt="1534059488506"></p>
<p>数据库中也发生了改变：</p>
<p><img src="1534059550338.png" alt="1534059550338"></p>
<h3 id="1-3-4-分页查询订单"><a href="#1-3-4-分页查询订单" class="headerlink" title="1.3.4.分页查询订单"></a>1.3.4.分页查询订单</h3><p>接口说明：</p>
<ul>
<li>请求方式：Get</li>
<li>请求路径：/order/list</li>
<li>请求参数：<ul>
<li>page：当前页，Integer类型，默认为1</li>
<li>rows：每页大小，Integer类型，默认为5</li>
<li>status：订单状态，String类型，默认查询全部状态订单</li>
</ul>
</li>
<li>返回结果：PageResult   对象，包含下面属性：<ul>
<li>total：总条数</li>
<li>items：当前页订单数组<ul>
<li>订单对象</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>测试：</p>
<p><img src="1534059762431.png" alt="1534059762431"></p>
<p>结果：</p>
<p><img src="1534059802562.png" alt="1534059802562"></p>
<h3 id="1-3-5-生成微信付款链接"><a href="#1-3-5-生成微信付款链接" class="headerlink" title="1.3.5.生成微信付款链接"></a>1.3.5.生成微信付款链接</h3><p>接口说明：</p>
<ul>
<li>请求方式：Get</li>
<li>请求路径：/order/url/{id}</li>
<li>请求参数：id，订单编号</li>
<li>返回结果：String类型，生成的微信支付链接</li>
</ul>
<p>测试：</p>
<p><img src="1534059974834.png" alt="1534059974834"></p>
<p>结果：</p>
<p><img src="1534060051812.png" alt="1534060051812"></p>
<h4 id="微信支付工具"><a href="#微信支付工具" class="headerlink" title="微信支付工具"></a>微信支付工具</h4><blockquote>
<p>PayHelper</p>
</blockquote>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PayHelper</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> WXPay wxPay<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> Logger logger <span class="token operator">=</span> LoggerFactory<span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span>PayHelper<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> StringRedisTemplate redisTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> OrderService orderService<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">PayHelper</span><span class="token punctuation">(</span>PayConfig payConfig<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 真实开发时</span>
        wxPay <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WXPay</span><span class="token punctuation">(</span>payConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 测试时</span>
        <span class="token comment" spellcheck="true">// wxPay = new WXPay(payConfig, WXPayConstants.SignType.MD5, true);</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> String <span class="token function">createPayUrl</span><span class="token punctuation">(</span>Long orderId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        String key <span class="token operator">=</span> <span class="token string">"ly.pay.url."</span> <span class="token operator">+</span> orderId<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            String url <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> url<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"查询缓存付款链接异常,订单编号：{}"</span><span class="token punctuation">,</span> orderId<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> String<span class="token operator">></span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// 商品描述</span>
            data<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"body"</span><span class="token punctuation">,</span> <span class="token string">"乐优商城测试"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// 订单号</span>
            data<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"out_trade_no"</span><span class="token punctuation">,</span> orderId<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">//货币</span>
            data<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"fee_type"</span><span class="token punctuation">,</span> <span class="token string">"CNY"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">//金额，单位是分</span>
            data<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"total_fee"</span><span class="token punctuation">,</span> <span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">//调用微信支付的终端IP（estore商城的IP）</span>
            data<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"spbill_create_ip"</span><span class="token punctuation">,</span> <span class="token string">"127.0.0.1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">//回调地址</span>
            data<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"notify_url"</span><span class="token punctuation">,</span> <span class="token string">"http://test.leyou.com/wxpay/notify"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// 交易类型为扫码支付</span>
            data<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"trade_type"</span><span class="token punctuation">,</span> <span class="token string">"NATIVE"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">//商品id,使用假数据</span>
            data<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"product_id"</span><span class="token punctuation">,</span> <span class="token string">"1234567"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> String<span class="token operator">></span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>wxPay<span class="token punctuation">.</span><span class="token function">unifiedOrder</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"SUCCESS"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"return_code"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                String url <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"code_url"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment" spellcheck="true">// 将付款地址缓存，时间为10分钟</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> TimeUnit<span class="token punctuation">.</span>MINUTES<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"缓存付款链接异常,订单编号：{}"</span><span class="token punctuation">,</span> orderId<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> url<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"创建预交易订单失败，错误信息：{}"</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"return_msg"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> null<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"创建预交易订单异常"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> null<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">/**
     * 查询订单状态
     *
     * @param orderId
     * @return
     */</span>
    <span class="token keyword">public</span> PayState <span class="token function">queryOrder</span><span class="token punctuation">(</span>Long orderId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> String<span class="token operator">></span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 订单号</span>
        data<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"out_trade_no"</span><span class="token punctuation">,</span> orderId<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> String<span class="token operator">></span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>wxPay<span class="token punctuation">.</span><span class="token function">orderQuery</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// 未查询到结果，认为是未付款</span>
                <span class="token keyword">return</span> PayState<span class="token punctuation">.</span>NOT_PAY<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            String state <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"trade_state"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"SUCCESS"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// success，则认为付款成功</span>

                <span class="token comment" spellcheck="true">// 修改订单状态</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>orderService<span class="token punctuation">.</span><span class="token function">updateStatus</span><span class="token punctuation">(</span>orderId<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> PayState<span class="token punctuation">.</span>SUCCESS<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"USERPAYING"</span><span class="token punctuation">,</span> state<span class="token punctuation">)</span>
                       <span class="token operator">||</span> StringUtils<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"NOTPAY"</span><span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// 未付款或正在付款，都认为是未付款</span>
                <span class="token keyword">return</span> PayState<span class="token punctuation">.</span>NOT_PAY<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// 其它状态认为是付款失败</span>
                <span class="token keyword">return</span> PayState<span class="token punctuation">.</span>FAIL<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"查询订单状态异常"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> PayState<span class="token punctuation">.</span>NOT_PAY<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>跟支付相关的其它几个类：</p>
<p> <img src="1528796883071.png" alt="1528796883071"></p>
<h3 id="1-3-6-查询支付状态"><a href="#1-3-6-查询支付状态" class="headerlink" title="1.3.6.查询支付状态"></a>1.3.6.查询支付状态</h3><p>接口说明：</p>
<ul>
<li>请求方式： Get</li>
<li>请求路径： /state/{id}</li>
<li>请求参数： id，订单编号</li>
<li>返回结果：0, 未查询到支付信息 1,支付成功 2,支付失败（查询失败，或者订单过期）</li>
</ul>
<h4 id="1-3-6-1-未付款"><a href="#1-3-6-1-未付款" class="headerlink" title="1.3.6.1.未付款"></a>1.3.6.1.未付款</h4><p>未付款时查询，测试：</p>
<p><img src="1534060875467.png" alt="1534060875467"></p>
<p>结果：</p>
<p><img src="1534061834503.png" alt="1534061834503"></p>
<p>因为尚未付款，所以查询返回0。</p>
<h4 id="1-3-6-2-付款"><a href="#1-3-6-2-付款" class="headerlink" title="1.3.6.2.付款"></a>1.3.6.2.付款</h4><p>通过JS把链接变成二维码。</p>
<p>找到课前资料提供的JS页面：</p>
<p><img src="1534061965270.png" alt="1534061965270"></p>
<p>进入，并输入刚刚生成的地址：</p>
<p><img src="1534062028046.png" alt="1534062028046"></p>
<h4 id="1-3-6-3-已付款"><a href="#1-3-6-3-已付款" class="headerlink" title="1.3.6.3.已付款"></a>1.3.6.3.已付款</h4><p>扫码支付，然后再次查询：</p>
<p><img src="1534062115599.png" alt="1534062115599"></p>
<p>状态码为1，代表支付成功了！</p>
<h1 id="2-订单结算页"><a href="#2-订单结算页" class="headerlink" title="2.订单结算页"></a>2.订单结算页</h1><h2 id="2-1-页面跳转"><a href="#2-1-页面跳转" class="headerlink" title="2.1.页面跳转"></a>2.1.页面跳转</h2><p>在购物车页面的最下方，有一个去结算按钮：</p>
<p><img src="1527990452791.png" alt="1527990452791"></p>
<p>当点击结算，我们应该跳转到订单结算页，即：<code>getOrderInfo.html</code></p>
<p> <img src="1534062458952.png" alt="1534062458952"></p>
<p>查看购物车的<code>结算</code>按钮：</p>
<p><img src="1534063127883.png" alt="1534063127883"></p>
<p>可以看到，地址是正确的。但是只有登录用户才可以去结算付款，因此我们不能直接跳转，而是在跳转前校验用户的登录状态，如果发现是未登录，应该重定向到登录页！</p>
<p>我们给这个按钮绑定点击事件：</p>
<p><img src="1534063368728.png" alt="1534063368728"></p>
<p>事件中判断登录状态，进行页面跳转：</p>
<pre class="line-numbers language-js"><code class="language-js"><span class="token function">toOrderInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 判断是否登录</span>
    ly<span class="token punctuation">.</span><span class="token function">verifyUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 已登录</span>
        window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"/getOrderInfo.html"</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 未登录</span>
        window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"/login.html?returnUrl="</span> <span class="token operator">+</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>登录后测试：</p>
<p><img src="1534068627040.png" alt="1534068627040"></p>
<p>此处页面需要渲染的内容主要包含3部分：</p>
<ul>
<li>收货人信息</li>
<li>支付方式</li>
<li>商品信息</li>
</ul>
<h2 id="2-2-收货人信息（作业）"><a href="#2-2-收货人信息（作业）" class="headerlink" title="2.2.收货人信息（作业）"></a>2.2.收货人信息（作业）</h2><p><img src="1528011713709.png" alt="1528011713709"></p>
<p>这里的收货人信息肯定是当前登录用户的收货地址。所以需要根据当前登录用户去查询，目前我们在页面是写的假数据：</p>
<p><img src="1534070259673.png" alt="1534070259673"></p>
<p>大家可以在在后台提供地址的增删改查接口，然后页面加载时根据当前登录用户查询，而后赋值给addresses即可。</p>
<h2 id="2-3-支付方式"><a href="#2-3-支付方式" class="headerlink" title="2.3.支付方式"></a>2.3.支付方式</h2><p>支付方式有2种：</p>
<ul>
<li>微信支付</li>
<li>货到付款</li>
</ul>
<p>与我们订单数据中的<code>paymentType</code>关联：</p>
<p><img src="1528012065388.png" alt="1528012065388"></p>
<p>所以我们可以在Vue实例中定义一个属性来记录支付方式：</p>
<p><img src="1534070467947.png" alt="1534070467947"></p>
<p>然后在页面渲染时与这个变量关联：</p>
<p><img src="1534070743780.png" alt="1534070743780"></p>
<h2 id="2-4-商品列表"><a href="#2-4-商品列表" class="headerlink" title="2.4.商品列表"></a>2.4.商品列表</h2><p>效果图：</p>
<p><img src="1528012881735.png" alt="1528012881735"></p>
<p>这里的送货清单，其实就是购物车中用户选择的要付款的商品</p>
<p>因此，我们需要在购物车跳转过来的同时，携带选中的购物车的信息</p>
<h3 id="2-4-1-购物车信息获取"><a href="#2-4-1-购物车信息获取" class="headerlink" title="2.4.1.购物车信息获取"></a>2.4.1.购物车信息获取</h3><p>我们修改<code>cart.html</code>中的页面跳转逻辑，把用户选中的购物车信息传递过来：</p>
<p><img src="1534071010391.png" alt="1534071010391"></p>
<p>然后在<code>created</code>钩子函数中获取购物车数据，保存到本地属性，要注意的是，我们应该在获取数据前校验用户登录状态，如果发现未登录，则直接重定向到登录页：</p>
<p><img src="1534071493245.png" alt="1534071493245"></p>
<p>然后重新加载页面，查看控制台：</p>
<p><img src="1534071647717.png" alt="1534071647717"></p>
<h3 id="2-4-2-页面渲染"><a href="#2-4-2-页面渲染" class="headerlink" title="2.4.2.页面渲染"></a>2.4.2.页面渲染</h3><p>要修改的页面位置：每一个li就是一件商品</p>
<p><img src="1534071794146.png" alt="1534071794146"></p>
<p>我们修改为：</p>
<pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>send-detail<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>(cart,index) in carts<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>index<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sendGoods<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>yui3-g<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>yui3-u-1-6<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>70px<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>70px<span class="token punctuation">"</span></span> <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cart.image<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>yui3-u-7-12<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>desc<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{cart.title}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>seven<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>(v) in JSON.parse(cart.ownSpec)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{v + "  "}} <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>yui3-u-1-12<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>price<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>￥{{ly.formatPrice(cart.price * cart.num)}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>yui3-u-1-12<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>num<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{cart.num}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>yui3-u-1-12<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>exit<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>有货<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="2-5-总金额"><a href="#2-5-总金额" class="headerlink" title="2.5.总金额"></a>2.5.总金额</h2><p>另外在商品列表下面，还有一个总金额的计算：</p>
<p><img src="1534072483208.png" alt="1534072483208"></p>
<p>可以看出这里主要有4个数据：</p>
<ul>
<li>总金额：totalPay</li>
<li>优惠返现：discount</li>
<li>运费：postFee</li>
<li>实付金额：actualPay</li>
</ul>
<p>不过我们没有做优惠活动，另外运费需要结合物流系统来计算，暂时我们都设置为0，在order属性中写死：</p>
<p><img src="1534072753146.png" alt="1534072753146"></p>
<p>我们通过计算属性来得到<code>totalPay</code>和<code>actualPay</code>值：</p>
<pre class="line-numbers language-js"><code class="language-js">computed<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">totalNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>carts<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>c1<span class="token punctuation">,</span> c2<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> c1 <span class="token operator">+</span> c2<span class="token punctuation">.</span>num<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">totalPay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>carts<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>c1<span class="token punctuation">,</span> c2<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> c1 <span class="token operator">+</span> c2<span class="token punctuation">.</span>price <span class="token operator">*</span> c2<span class="token punctuation">.</span>num<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">actualPay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>totalPay <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>order<span class="token punctuation">.</span>postFee <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>order<span class="token punctuation">.</span>discount<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>然后在页面渲染：</p>
<p><img src="1534073678931.png" alt="1534073678931"></p>
<p>效果：</p>
<p><img src="1534073704731.png" alt="1534073704731"></p>
<h2 id="2-6-提交订单"><a href="#2-6-提交订单" class="headerlink" title="2.6.提交订单"></a>2.6.提交订单</h2><h3 id="2-6-1-页面提交"><a href="#2-6-1-页面提交" class="headerlink" title="2.6.1.页面提交"></a>2.6.1.页面提交</h3><p>来看下订单接口所需要的数据：</p>
<p><img src="1534074122199.png" alt="1534074122199"></p>
<p>分为3部分，分别是</p>
<ul>
<li><p>订单本身的基本信息</p>
<ul>
<li>总金额</li>
<li>实付金额</li>
<li>付款类型</li>
<li>买家信息就是当前用户</li>
</ul>
</li>
<li><p>订单详情</p>
<ul>
<li>就是购物车中的商品，不过购物车数据会多出一个userId，我们去除即可：</li>
</ul>
<p><img src="1534074293296.png" alt="1534074293296"></p>
</li>
<li><p>物流信息</p>
<ul>
<li>当前用户选中的物流地址信息</li>
</ul>
</li>
</ul>
<p>给提交按钮绑定事件：</p>
<p><img src="1534074374101.png" alt="1534074374101"></p>
<p>然后编写方法，组织数据并提交：</p>
<pre class="line-numbers language-js"><code class="language-js">methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 把购物车数据处理成订单详情</span>
        <span class="token keyword">const</span> orderDetails <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>carts<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span>userId<span class="token punctuation">,</span> <span class="token operator">...</span>rest<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> rest<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 处理物流信息</span>
        <span class="token keyword">const</span> addr <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>addresses<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>selectedAddress<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
            receiver<span class="token punctuation">:</span> addr<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
            receiverState<span class="token punctuation">:</span> addr<span class="token punctuation">.</span>state<span class="token punctuation">,</span>
            receiverCity<span class="token punctuation">:</span> addr<span class="token punctuation">.</span>city<span class="token punctuation">,</span>
            receiverAddress<span class="token punctuation">:</span> addr<span class="token punctuation">.</span>address<span class="token punctuation">,</span>
            receiverDistrict<span class="token punctuation">:</span> addr<span class="token punctuation">.</span>district<span class="token punctuation">,</span>
            receiverMobile<span class="token punctuation">:</span> addr<span class="token punctuation">.</span>phone<span class="token punctuation">,</span>
            receiverZip<span class="token punctuation">:</span> addr<span class="token punctuation">.</span>zipCode
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 复制到订单对象</span>
        Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>order<span class="token punctuation">,</span> obj<span class="token punctuation">,</span> <span class="token punctuation">{</span>
            orderDetails<span class="token punctuation">,</span>
            totalPay<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>totalPay<span class="token punctuation">,</span>
            actualPay<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>actualPay<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 提交订单</span>
        ly<span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/order"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>order<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span>data<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 在线支付，需要到付款页</span>
            window<span class="token punctuation">.</span>location <span class="token operator">=</span> <span class="token string">"pay.html?orderId="</span> <span class="token operator">+</span> data<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resp<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"订单提交失败，可能是缺货!"</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="2-6-2-精度损失问题"><a href="#2-6-2-精度损失问题" class="headerlink" title="2.6.2.精度损失问题"></a>2.6.2.精度损失问题</h3><p>在页面点击提交测试：</p>
<p> <img src="1528340102503.png" alt="1528340102503"></p>
<p>成功生成订单！</p>
<p>然后看页面跳转：</p>
<p> <img src="1528340136603.png" alt="1528340136603"></p>
<p>好像有什么不对？订单号的最后2位不正确啊！</p>
<p>这其实是因为JS的长整数精度有限，java的Long类型数据超出了范围，所以出现了精度损失。</p>
<p>我们后台返回的是Json的字符串，在axios内部会自动调用 JSON.parse()方法把json字符串转为JS数据，就会出现进度损失。如果不进行转换，依然当做字符串来使用，就不会有问题了。</p>
<p>因此，我们重写axios对响应的处理回调函数：</p>
<p> <img src="1528340413139.png" alt="1528340413139"></p>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token punctuation">{</span>
    transformResponse<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> data<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>再次测试，就OK了。</p>
<p>接下来就轮到支付了。</p>
<h1 id="3-微信支付"><a href="#3-微信支付" class="headerlink" title="3.微信支付"></a>3.微信支付</h1><h2 id="3-1-介绍"><a href="#3-1-介绍" class="headerlink" title="3.1.介绍"></a>3.1.介绍</h2><p>微信支付官方文档：<a href="https://pay.weixin.qq.com/index.php/core/home/login?return_url=%2F" target="_blank" rel="noopener">https://pay.weixin.qq.com/index.php/core/home/login?return_url=%2F</a></p>
<p><img src="1527848350188.png" alt="1527848350188"></p>
<p>我们选择开发文档，而后进入选择页面：</p>
<p><img src="1527848358128.png" alt="1527848358128"></p>
<p>选择扫码支付：</p>
<p><img src="1527848368179.png" alt="1527848368179"></p>
<p>此处我们使用模式二来开发：</p>
<h2 id="3-2-开发流程"><a href="#3-2-开发流程" class="headerlink" title="3.2.开发流程"></a>3.2.开发流程</h2><p>模式二与模式一相比，流程更为简单，不依赖设置的回调支付URL。</p>
<p>商户后台系统先调用微信支付的统一下单接口，微信后台系统返回链接参数code_url；</p>
<p>商户后台系统将code_url值生成二维码图片，用户使用微信客户端扫码后发起支付。</p>
<p>注意：code_url有效期为2小时，过期后扫码不能再发起支付。 </p>
<p>流程图：</p>
<p><img src="E:/java/%E6%95%99%E7%A8%8B/04-%E6%9E%B6%E6%9E%84%E7%8F%AD/06-%E9%A1%B9%E7%9B%AE-%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E-11%E6%9C%88%E7%89%88/leyou/day19-%E4%B8%8B%E5%8D%95/%E7%AC%94%E8%AE%B0/%E7%AC%94%E8%AE%B0/assets/chapter6_5_1.png" alt="2wa23131"></p>
<p>这里我们把商户（我们）要做的事情总结一下：</p>
<ul>
<li>1、商户生成订单</li>
<li>2、商户调用微信下单接口，获取预交易的链接</li>
<li>3、商户将链接生成二维码图片，展示给用户；</li>
<li>4、用户支付并确认</li>
<li>5、支付结果通知：<ul>
<li>微信异步通知商户支付结果，商户告知微信支付接收情况</li>
<li>商户如果没有收到通知，可以调用接口，查询支付状态</li>
</ul>
</li>
<li>6、如果支付成功，发货，修改订单状态</li>
</ul>
<p>在前面的业务中，我们已经完成了：</p>
<ul>
<li>1、生成订单</li>
</ul>
<p>接下来，我们需要做的是：</p>
<ul>
<li>2、调用微信接口，生成链接。</li>
<li>3、并且生成二维码图片</li>
</ul>
<h2 id="3-3-生成二维码"><a href="#3-3-生成二维码" class="headerlink" title="3.3.生成二维码"></a>3.3.生成二维码</h2><h3 id="3-3-1-生成预交易链接"><a href="#3-3-1-生成预交易链接" class="headerlink" title="3.3.1.生成预交易链接"></a>3.3.1.生成预交易链接</h3><p>我们先根据订单的编号，调用后台服务，生成交易链接，而后才能根据链接生成二维码。</p>
<p>在页面发起请求：</p>
<pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">var</span> payVm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    el<span class="token punctuation">:</span><span class="token string">"#payVm"</span><span class="token punctuation">,</span>
    data<span class="token punctuation">:</span><span class="token punctuation">{</span>
        ly<span class="token punctuation">,</span>
        orderId<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">// 订单编号</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 判断登录状态</span>
        ly<span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"/auth/verify"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 获取订单编号</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>orderId <span class="token operator">=</span> ly<span class="token punctuation">.</span><span class="token function">getUrlParam</span><span class="token punctuation">(</span><span class="token string">"orderId"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// 获取请求链接</span>
            ly<span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"/order/url/"</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>orderId<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resp <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 未登录，跳转至登录页</span>
             location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"/login.html?returnUrl="</span> <span class="token operator">+</span> location<span class="token punctuation">.</span>href<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    components<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        shortcut<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">"./js/pages/shortcut.js"</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>后台已经定义好生成付款地址的接口。</p>
<p> <img src="1528362159620.png" alt="1528362159620"></p>
<p>刷新页面查看：</p>
<p> <img src="1528362220886.png" alt="1528362220886"></p>
<h3 id="3-3-2-生成二维码"><a href="#3-3-2-生成二维码" class="headerlink" title="3.3.2.生成二维码"></a>3.3.2.生成二维码</h3><p>这里我们使用一个生成二维码的JS插件：qrcode，官网：<a href="https://github.com/davidshimjs/qrcodejs" target="_blank" rel="noopener">https://github.com/davidshimjs/qrcodejs</a></p>
<p><img src="1534313526721.png" alt="1534313526721"></p>
<p>我们把课这个js脚本引入到项目中：</p>
<p> <img src="1528362348399.png" alt="1528362348399"></p>
<p>官方使用案例：</p>
<p><img src="1534313925398.png" alt="1534313925398"></p>
<p>然后在页面引用：</p>
<p> <img src="1528362377494.png" alt="1528362377494"></p>
<p>页面定义一个div，用于展示二维码：</p>
<p> <img src="1528362023061.png" alt="1528362023061"></p>
<p>然后获取到付款链接后，根据链接生成二维码：</p>
<p> <img src="1528362420151.png" alt="1528362420151"></p>
<pre class="line-numbers language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 判断登录状态</span>
ly<span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"/auth/verify"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 获取订单编号</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>orderId <span class="token operator">=</span> ly<span class="token punctuation">.</span><span class="token function">getUrlParam</span><span class="token punctuation">(</span><span class="token string">"orderId"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 获取请求链接</span>
    ly<span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"/order/url/"</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>orderId<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resp <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">QRCode</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"qrImage"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                text<span class="token punctuation">:</span> resp<span class="token punctuation">.</span>data<span class="token punctuation">,</span>
                width<span class="token punctuation">:</span> <span class="token number">250</span><span class="token punctuation">,</span>
                height<span class="token punctuation">:</span> <span class="token number">250</span><span class="token punctuation">,</span>
                colorDark<span class="token punctuation">:</span> <span class="token string">"#000000"</span><span class="token punctuation">,</span>
                colorLight<span class="token punctuation">:</span> <span class="token string">"#ffffff"</span><span class="token punctuation">,</span>
                correctLevel<span class="token punctuation">:</span> QRCode<span class="token punctuation">.</span>CorrectLevel<span class="token punctuation">.</span>H
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 未登录，跳转至登录页</span>
    location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"/login.html?returnUrl="</span> <span class="token operator">+</span> location<span class="token punctuation">.</span>href<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>刷新页面，查看效果：</p>
<p> <img src="1528362464276.png" alt="1528362464276"></p>
<p>此时，客户用手机扫描二维码，可以看到付款页面。</p>
<h2 id="3-4-付款状态查询"><a href="#3-4-付款状态查询" class="headerlink" title="3.4.付款状态查询"></a>3.4.付款状态查询</h2><p>跳转到支付页面后，我们等待用户付款，付款完成则跳转到付款成功页面。</p>
<h3 id="3-4-1-页面循环查询支付状态"><a href="#3-4-1-页面循环查询支付状态" class="headerlink" title="3.4.1.页面循环查询支付状态"></a>3.4.1.页面循环查询支付状态</h3><p>不过，因为不清楚用户何时会付款，因此这里采用循环的方式，不断请求判断是否支付成功。</p>
<pre class="line-numbers language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 开启定时任务，查询付款状态</span>
<span class="token keyword">const</span> taskId <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    ly<span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"/order/state/"</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>orderId<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resp <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> i <span class="token operator">=</span> resp<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 付款成功</span>
            <span class="token function">clearInterval</span><span class="token punctuation">(</span>taskId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// 跳转到付款成功页</span>
            location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"/paysuccess.html?orderId="</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>orderId<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 付款失败</span>
            <span class="token function">clearInterval</span><span class="token punctuation">(</span>taskId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// 跳转到付款失败页</span>
            location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"/payfail.html"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="3-4-2-付款成功页面"><a href="#3-4-2-付款成功页面" class="headerlink" title="3.4.2.付款成功页面"></a>3.4.2.付款成功页面</h3><p>当付款成功后，自动跳转到付款成功页面：</p>
<p><img src="1528376883924.png" alt="1528376883924"></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/API/" rel="tag"># API</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/06/05/old/leyou%E9%97%A8%E6%88%B7-7-%E8%B4%AD%E7%89%A9%E8%BD%A6/" rel="prev" title="leyou门户#7-购物车">
      <i class="fa fa-chevron-left"></i> leyou门户#7-购物车
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/06/07/old/java%E5%AE%B9%E5%99%A8-1-Collection%E6%8E%A5%E5%8F%A3/" rel="next" title="java容器#1-Collection接口">
      java容器#1-Collection接口 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-订单系统接口"><span class="nav-text">1.订单系统接口</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-导入订单服务"><span class="nav-text">1.1.导入订单服务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-Swagger-UI"><span class="nav-text">1.2.Swagger-UI</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-1-什么是OpenAPI"><span class="nav-text">1.2.1.什么是OpenAPI</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-2-什么是swagger？"><span class="nav-text">1.2.2.什么是swagger？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-3-快速入门"><span class="nav-text">1.2.3.快速入门</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1）引入依赖"><span class="nav-text">1）引入依赖</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2）编写配置"><span class="nav-text">2）编写配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3）接口声明"><span class="nav-text">3）接口声明</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4）启动测试"><span class="nav-text">4）启动测试</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-测试接口"><span class="nav-text">1.3.测试接口</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-1-创建订单接口"><span class="nav-text">1.3.1.创建订单接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-2-生成ID的方式"><span class="nav-text">1.3.2.生成ID的方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-2-查询订单接口"><span class="nav-text">1.3.2.查询订单接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-3-更新订单状态"><span class="nav-text">1.3.3.更新订单状态</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-4-分页查询订单"><span class="nav-text">1.3.4.分页查询订单</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-5-生成微信付款链接"><span class="nav-text">1.3.5.生成微信付款链接</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#微信支付工具"><span class="nav-text">微信支付工具</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-6-查询支付状态"><span class="nav-text">1.3.6.查询支付状态</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-6-1-未付款"><span class="nav-text">1.3.6.1.未付款</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-6-2-付款"><span class="nav-text">1.3.6.2.付款</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-6-3-已付款"><span class="nav-text">1.3.6.3.已付款</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-订单结算页"><span class="nav-text">2.订单结算页</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-页面跳转"><span class="nav-text">2.1.页面跳转</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-收货人信息（作业）"><span class="nav-text">2.2.收货人信息（作业）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3-支付方式"><span class="nav-text">2.3.支付方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-4-商品列表"><span class="nav-text">2.4.商品列表</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-1-购物车信息获取"><span class="nav-text">2.4.1.购物车信息获取</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-2-页面渲染"><span class="nav-text">2.4.2.页面渲染</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-5-总金额"><span class="nav-text">2.5.总金额</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-6-提交订单"><span class="nav-text">2.6.提交订单</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-1-页面提交"><span class="nav-text">2.6.1.页面提交</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-2-精度损失问题"><span class="nav-text">2.6.2.精度损失问题</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-微信支付"><span class="nav-text">3.微信支付</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-介绍"><span class="nav-text">3.1.介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-开发流程"><span class="nav-text">3.2.开发流程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-生成二维码"><span class="nav-text">3.3.生成二维码</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-1-生成预交易链接"><span class="nav-text">3.3.1.生成预交易链接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-2-生成二维码"><span class="nav-text">3.3.2.生成二维码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-4-付款状态查询"><span class="nav-text">3.4.付款状态查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-1-页面循环查询支付状态"><span class="nav-text">3.4.1.页面循环查询支付状态</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-2-付款成功页面"><span class="nav-text">3.4.2.付款成功页面</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="摘星"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">摘星</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">261</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">142</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/zhangkexuan" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zhangkexuan" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/kexuan_zhang@qq.com" title="E-Mail → kexuan_zhang@qq.com"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2019 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">摘星</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>

<!-- ҳ����С���� -->
<script type="text/javascript" src="/js/clicklove.js"></script>
