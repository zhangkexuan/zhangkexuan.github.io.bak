<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="主要是调用支付接口，微信支付、支付宝支付的接口调用：  会调用订单系统接口 实现订单结算功能 实现微信支付功能">
<meta property="og:type" content="article">
<meta property="og:title" content="leyou门户#8-下单">
<meta property="og:url" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/index.html">
<meta property="og:site_name" content="摘星">
<meta property="og:description" content="主要是调用支付接口，微信支付、支付宝支付的接口调用：  会调用订单系统接口 实现订单结算功能 实现微信支付功能">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1527849592739.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1527849713858.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1527849755740.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1527988253596.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1527988384844.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1528724925709.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534050474425.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534050501639.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534050571547.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1528726383029.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534050960735.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534056625226.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534056963545.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534057111628.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534057197865.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534057752285.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1528729105237.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534057869509.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534058725566.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534058696076.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534059150417.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534059488506.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534059550338.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534059762431.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534059802562.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534059974834.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534060051812.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1528796883071.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534060875467.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534061834503.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534061965270.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534062028046.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534062115599.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1527990452791.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534062458952.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534063127883.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534063368728.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534068627040.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1528011713709.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534070259673.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1528012065388.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534070467947.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534070743780.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1528012881735.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534071010391.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534071493245.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534071647717.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534071794146.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534072483208.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534072753146.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534073678931.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534073704731.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534074122199.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534074293296.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534074374101.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1528340102503.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1528340136603.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1528340413139.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1527848350188.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1527848358128.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1527848368179.png">
<meta property="og:image" content="e:/java/教程/04-架构班/06-项目-微服务/乐优商城-11月版/leyou/day19-下单/笔记/笔记/assets/chapter6_5_1.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1528362159620.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1528362220886.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534313526721.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1528362348399.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1534313925398.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1528362377494.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1528362023061.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1528362420151.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1528362464276.png">
<meta property="og:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1528376883924.png">
<meta property="article:published_time" content="2020-06-06T09:32:26.000Z">
<meta property="article:modified_time" content="2021-05-19T02:13:47.108Z">
<meta property="article:author" content="摘星">
<meta property="article:tag" content="API">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/1527849592739.png">

<link rel="canonical" href="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>leyou门户#8-下单 | 摘星</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">摘星</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/06/leyou%E9%97%A8%E6%88%B7-8-%E4%B8%8B%E5%8D%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="摘星">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="摘星">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          leyou门户#8-下单
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-06 17:32:26" itemprop="dateCreated datePublished" datetime="2020-06-06T17:32:26+08:00">2020-06-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/leyou/" itemprop="url" rel="index"><span itemprop="name">leyou</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>主要是调用支付接口，微信支付、支付宝支付的接口调用：</p>
<ul>
<li>会调用订单系统接口</li>
<li>实现订单结算功能</li>
<li>实现微信支付功能</li>
</ul>
<span id="more"></span>

<h1 id="1-订单系统接口"><a href="#1-订单系统接口" class="headerlink" title="1.订单系统接口"></a>1.订单系统接口</h1><p>我们不做开发，只讲解</p>
<h2 id="1-1-导入订单服务"><a href="#1-1-导入订单服务" class="headerlink" title="1.1.导入订单服务"></a>1.1.导入订单服务</h2><p>把课前资料提供的<code>leyou-order</code>复制到<code>D:\heima\code\leyou</code>目录。</p>
<p>然后在工程内导入：</p>
<p> <img src="1527849592739.png" alt="1527849592739"></p>
<p>然后导入module：</p>
<p> <img src="1527849713858.png" alt="1527849713858"></p>
<p>选择导入module：</p>
<p> <img src="1527849755740.png" alt="1527849755740"></p>
<p>选择目录中的 <code>ly-order</code>：</p>
<p> <img src="1527988253596.png" alt="1527988253596"></p>
<p>打开父工程leyou的pom文件，添加<code>ly-order</code>模块：</p>
<p><img src="1527988384844.png" alt="1527988384844"></p>
<h2 id="1-2-Swagger-UI"><a href="#1-2-Swagger-UI" class="headerlink" title="1.2.Swagger-UI"></a>1.2.Swagger-UI</h2><p>丝袜哥</p>
<h3 id="1-2-1-什么是OpenAPI"><a href="#1-2-1-什么是OpenAPI" class="headerlink" title="1.2.1.什么是OpenAPI"></a>1.2.1.什么是OpenAPI</h3><p>随着互联网技术的发展，现在的网站架构基本都由原来的后端渲染，变成了：前端渲染、前后端分离的形态，而且前端技术和后端技术在各自的道路上越走越远。  前端和后端的唯一联系，变成了API接口；API文档变成了前后端开发人员联系的纽带，变得越来越重要。</p>
<p>没有API文档工具之前，大家都是手写API文档的，在什么地方书写的都有，而且API文档没有统一规范和格式，每个公司都不一样。这无疑给开发带来了灾难。</p>
<p>OpenAPI规范（OpenAPI Specification 简称OAS）是Linux基金会的一个项目，试图通过定义一种用来描述API格式或API定义的语言，来规范RESTful服务开发过程。目前V3.0版本的OpenAPI规范已经发布并开源在github上 。</p>
<p>官网：<a target="_blank" rel="noopener" href="https://github.com/OAI/OpenAPI-Specification">https://github.com/OAI/OpenAPI-Specification</a></p>
<h3 id="1-2-2-什么是swagger？"><a href="#1-2-2-什么是swagger？" class="headerlink" title="1.2.2.什么是swagger？"></a>1.2.2.什么是swagger？</h3><p>OpenAPI是一个编写API文档的规范，然而如果手动去编写OpenAPI规范的文档，是非常麻烦的。而Swagger就是一个实现了OpenAPI规范的工具集。</p>
<p>官网：<a target="_blank" rel="noopener" href="https://swagger.io/">https://swagger.io/</a></p>
<p>看官方的说明：</p>
<p> <img src="1528724925709.png" alt="1528724925709"></p>
<p>Swagger包含的工具集：</p>
<ul>
<li><strong>Swagger编辑器：</strong> Swagger Editor允许您在浏览器中编辑YAML中的OpenAPI规范并实时预览文档。</li>
<li><strong>Swagger UI：</strong> Swagger UI是HTML，Javascript和CSS资产的集合，可以从符合OAS标准的API动态生成漂亮的文档。</li>
<li><strong>Swagger Codegen：</strong>允许根据OpenAPI规范自动生成API客户端库（SDK生成），服务器存根和文档。</li>
<li><strong>Swagger Parser：</strong>用于解析来自Java的OpenAPI定义的独立库</li>
<li><strong>Swagger Core：</strong>与Java相关的库，用于创建，使用和使用OpenAPI定义</li>
<li><strong>Swagger Inspector（免费）：</strong> API测试工具，可让您验证您的API并从现有API生成OpenAPI定义</li>
<li><strong>SwaggerHub（免费和商业）：</strong> API设计和文档，为使用OpenAPI的团队构建。</li>
</ul>
<h3 id="1-2-3-快速入门"><a href="#1-2-3-快速入门" class="headerlink" title="1.2.3.快速入门"></a>1.2.3.快速入门</h3><p>SpringBoot已经集成了Swagger，使用简单注解即可生成swagger的API文档。</p>
<h4 id="1）引入依赖"><a href="#1）引入依赖" class="headerlink" title="1）引入依赖"></a>1）引入依赖</h4><pre><code class="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.springfox&lt;/groupId&gt;
    &lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt;
    &lt;version&gt;2.8.0&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;io.springfox&lt;/groupId&gt;
    &lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt;
    &lt;version&gt;2.8.0&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<h4 id="2）编写配置"><a href="#2）编写配置" class="headerlink" title="2）编写配置"></a>2）编写配置</h4><pre><code class="java">@Configuration
@EnableSwagger2
public class SwaggerConfig &#123;
    @Bean
    public Docket api() &#123;
        return new Docket(DocumentationType.SWAGGER_2)
                .host(&quot;http://order.leyou.com&quot;)
                .apiInfo(apiInfo())
                .select()
                .apis(RequestHandlerSelectors.basePackage(&quot;com.leyou.order.controller&quot;))
                .paths(PathSelectors.any())
                .build();
    &#125;

    private ApiInfo apiInfo() &#123;
        return new ApiInfoBuilder()
                .title(&quot;乐优商城订单系统&quot;)
                .description(&quot;乐优商城订单系统接口文档&quot;)
                .version(&quot;1.0&quot;)
                .build();
    &#125;
&#125;
</code></pre>
<h4 id="3）接口声明"><a href="#3）接口声明" class="headerlink" title="3）接口声明"></a>3）接口声明</h4><p>在controller的每个handler上添加接口说明注解：</p>
<pre><code class="java">@RestController
@RequestMapping(&quot;order&quot;)
@Api(&quot;订单服务接口&quot;)
public class OrderController &#123;

    @Autowired
    private OrderService orderService;

    @Autowired
    private PayHelper payHelper;

    /**
     * 创建订单
     *
     * @param order 订单对象
     * @return 订单编号
     */
    @PostMapping
    @ApiOperation(value = &quot;创建订单接口，返回订单编号&quot;, notes = &quot;创建订单&quot;)
    @ApiImplicitParam(name = &quot;order&quot;, required = true, value = &quot;订单的json对象,包含订单条目和物流信息&quot;)
    public ResponseEntity&lt;Long&gt; createOrder(@RequestBody @Valid Order order) &#123;
        Long id = this.orderService.createOrder(order);
        return new ResponseEntity&lt;&gt;(id, HttpStatus.CREATED);
    &#125;

    /**
     * 分页查询当前用户订单
     *
     * @param status 订单状态
     * @return 分页订单数据
     */
    @GetMapping(&quot;list&quot;)
    @ApiOperation(value = &quot;分页查询当前用户订单，并且可以根据订单状态过滤&quot;, 
                  notes = &quot;分页查询当前用户订单&quot;)
    @ApiImplicitParams(&#123;
        @ApiImplicitParam(name = &quot;page&quot;, value = &quot;当前页&quot;, 
                          defaultValue = &quot;1&quot;, type = &quot;Integer&quot;),
        @ApiImplicitParam(name = &quot;rows&quot;, value = &quot;每页大小&quot;, 
                          defaultValue = &quot;5&quot;, type = &quot;Integer&quot;),
        @ApiImplicitParam(
            name = &quot;status&quot;, 
            value = &quot;订单状态：1未付款，2已付款未发货，3已发货未确认，4已确认未评价，5交易关闭，6交易成功，已评价&quot;, type = &quot;Integer&quot;),
    &#125;)
    public ResponseEntity&lt;PageResult&lt;Order&gt;&gt; queryUserOrderList(
        @RequestParam(value = &quot;page&quot;, defaultValue = &quot;1&quot;) Integer page,
        @RequestParam(value = &quot;rows&quot;, defaultValue = &quot;5&quot;) Integer rows,
        @RequestParam(value = &quot;status&quot;, required = false) Integer status) &#123;
        PageResult&lt;Order&gt; result = this.orderService.queryUserOrderList(page, rows, status);
        if (result == null) &#123;
            return new ResponseEntity&lt;&gt;(HttpStatus.NOT_FOUND);
        &#125;
        return ResponseEntity.ok(result);
    &#125;
&#125;
</code></pre>
<p>常用注解说明：</p>
<pre><code class="java">/**
 @Api：修饰整个类，描述Controller的作用
 @ApiOperation：描述一个类的一个方法，或者说一个接口
 @ApiParam：单个参数描述
 @ApiModel：用对象来接收参数
 @ApiProperty：用对象接收参数时，描述对象的一个字段
 @ApiResponse：HTTP响应其中1个描述
 @ApiResponses：HTTP响应整体描述
 @ApiIgnore：使用该注解忽略这个API
 @ApiError ：发生错误返回的信息
 @ApiImplicitParam：一个请求参数
 @ApiImplicitParams：多个请求参数
 */
</code></pre>
<h4 id="4）启动测试"><a href="#4）启动测试" class="headerlink" title="4）启动测试"></a>4）启动测试</h4><p>启动服务，然后访问：<a target="_blank" rel="noopener" href="http://localhost:8089/swagger-ui.html">http://localhost:8089/swagger-ui.html</a></p>
<p><img src="1534050474425.png" alt="1534050474425"></p>
<p>点击order-controller，查看接口信息：</p>
<p><img src="1534050501639.png" alt="1534050501639"></p>
<p>点击任意一个接口，即可看到详细信息：</p>
<p><img src="1534050571547.png" alt="1534050571547"></p>
<h2 id="1-3-测试接口"><a href="#1-3-测试接口" class="headerlink" title="1.3.测试接口"></a>1.3.测试接口</h2><h3 id="1-3-1-创建订单接口"><a href="#1-3-1-创建订单接口" class="headerlink" title="1.3.1.创建订单接口"></a>1.3.1.创建订单接口</h3><p>可以通过页面看到接口信息：</p>
<ul>
<li>请求方式：POST</li>
<li>请求路径：/order</li>
<li>请求参数：包含订单、订单详情等数据的json对象。</li>
<li>返回结果：订单编号</li>
</ul>
<p>点击<code>Try It Out</code>来测试：</p>
<p><img src="1528726383029.png" alt="1528726383029"></p>
<p>输入数据：</p>
<pre><code class="json">&#123;
  &quot;totalPay&quot;: 236800,
  &quot;postFee&quot;: 0,
  &quot;paymentType&quot;: 2,
  &quot;actualPay&quot;: 236800,
  &quot;buyerMessage&quot;: null,
  &quot;buyerNick&quot;: &quot;huge&quot;,
  &quot;orderDetails&quot;: [
    &#123;
      &quot;skuId&quot;: 3893493,
      &quot;num&quot;: 1,
      &quot;title&quot;: &quot;苹果（Apple）iPhone 6 (A1586) 16GB 金色 移动联通电信4G手机3&quot;,
      &quot;price&quot;: 236800,
      &quot;ownSpec&quot;: &quot;&#123;\&quot;机身颜色\&quot;:\&quot;钻雕蓝\&quot;,\&quot;内存\&quot;:\&quot;4GB\&quot;,\&quot;机身存储\&quot;:\&quot;64GB\&quot;&#125;&quot;,
      &quot;image&quot;: &quot;http://image.leyou.com/images/9/4/1524297342728.jpg&quot;
    &#125;
  ],
  &quot;receiver&quot;: &quot;锋哥&quot;,
  &quot;receiverMobile&quot;: &quot;15800000000&quot;,
  &quot;receiverState&quot;: &quot;上海&quot;,
  &quot;receiverCity&quot;: &quot;上海&quot;,
  &quot;receiverDistrict&quot;: &quot;浦东新签&quot;,
  &quot;receiverAddress&quot;: &quot;航头镇航头路18号传智播客3号楼&quot;,
  &quot;receiverZip&quot;: &quot;210000&quot;,
  &quot;invoiceType&quot;: 0,
  &quot;sourceType&quot;:2
&#125;
</code></pre>
<p>然后点击execute：</p>
<p><img src="1534050960735.png" alt="1534050960735"></p>
<p>结果：</p>
<p><img src="1534056625226.png" alt="1534056625226"></p>
<p>下单需要登录，通过登录生成token：</p>
<p><img src="1534056963545.png" alt="1534056963545"></p>
<p>把token的值手动加入到浏览器的cookie中：</p>
<p><img src="1534057111628.png" alt="1534057111628"></p>
<p><img src="1534057197865.png" alt="1534057197865"></p>
<p>添加成功，响应订单编号。但是和数据库保存的订单编号不太一样（后几位不一样，浏览器展示长整型会出现精度损失）</p>
<h3 id="1-3-2-生成ID的方式"><a href="#1-3-2-生成ID的方式" class="headerlink" title="1.3.2.生成ID的方式"></a>1.3.2.生成ID的方式</h3><blockquote>
<p>订单id的特殊性</p>
</blockquote>
<p>订单数据非常庞大，将来一定会做分库分表。那么这种情况下， 要保证id的唯一，就不能靠数据库自增，而是自己来实现算法，生成唯一id。</p>
<blockquote>
<p>雪花算法</p>
</blockquote>
<p>这里的订单id是通过一个工具类生成的：</p>
<p> <img src="1534057752285.png" alt="1534057752285"></p>
<p>而工具类所采用的生成id算法，是由Twitter公司开源的snowflake（雪花）算法。</p>
<blockquote>
<p>简单原理</p>
</blockquote>
<p>雪花算法会生成一个64位的二进制数据，为一个Long型。(转换成字符串后长度最多19) ，其基本结构：</p>
<p> <img src="1528729105237.png" alt="1528729105237"></p>
<p>第一位：为未使用</p>
<p>第二部分：41位为毫秒级时间(41位的长度可以使用69年)</p>
<p>第三部分：5位datacenterId和5位workerId(10位的长度最多支持部署1024个节点）</p>
<p>第四部分：最后12位是毫秒内的计数（12位的计数顺序号支持每个节点每毫秒产生4096个ID序号）</p>
<p>snowflake生成的ID整体上按照时间自增排序，并且整个分布式系统内不会产生ID碰撞（由datacenter和workerId作区分），并且效率较高。经测试snowflake每秒能够产生26万个ID。</p>
<blockquote>
<p>配置</p>
</blockquote>
<p>为了保证不重复，我们给每个部署的节点都配置机器id：</p>
<pre><code class="yaml">leyou:
  worker:
    workerId: 1
    datacenterId: 1
</code></pre>
<p>加载属性：</p>
<pre><code class="java">@ConfigurationProperties(prefix = &quot;leyou.worker&quot;)
public class IdWorkerProperties &#123;

    private long workerId;// 当前机器id

    private long datacenterId;// 序列号

    public long getWorkerId() &#123;
        return workerId;
    &#125;

    public void setWorkerId(long workerId) &#123;
        this.workerId = workerId;
    &#125;

    public long getDatacenterId() &#123;
        return datacenterId;
    &#125;

    public void setDatacenterId(long datacenterId) &#123;
        this.datacenterId = datacenterId;
    &#125;
&#125;
</code></pre>
<p>编写配置类：</p>
<pre><code class="java">@Configuration
@EnableConfigurationProperties(IdWorkerProperties.class)
public class IdWorkerConfig &#123;

    @Bean
    public IdWorker idWorker(IdWorkerProperties prop) &#123;
        return new IdWorker(prop.getWorkerId(), prop.getDatacenterId());
    &#125;
&#125;
</code></pre>
<blockquote>
<p>使用：</p>
</blockquote>
<p><img src="1534057869509.png" alt="1534057869509"></p>
<h3 id="1-3-2-查询订单接口"><a href="#1-3-2-查询订单接口" class="headerlink" title="1.3.2.查询订单接口"></a>1.3.2.查询订单接口</h3><p>接口说明：</p>
<ul>
<li>请求方式：GET</li>
<li>请求路径：/order/{id}</li>
<li>请求参数：id，订单编号</li>
<li>返回结果：Order，订单的json对象</li>
</ul>
<p>测试：</p>
<p><img src="1534058725566.png" alt="1534058725566"></p>
<p>结果：</p>
<p><img src="1534058696076.png" alt="1534058696076"></p>
<h3 id="1-3-3-更新订单状态"><a href="#1-3-3-更新订单状态" class="headerlink" title="1.3.3.更新订单状态"></a>1.3.3.更新订单状态</h3><p>接口说明：</p>
<ul>
<li>请求参数：PUT</li>
<li>请求路径：/order/{id}/{status}</li>
<li>请求参数：<ul>
<li>id：订单编号，String类型，不能为空</li>
<li>status：订单状态，不能为空</li>
</ul>
</li>
<li>返回结果：null</li>
</ul>
<p>测试：</p>
<p><img src="1534059150417.png" alt="1534059150417"></p>
<p>结果：</p>
<p><img src="1534059488506.png" alt="1534059488506"></p>
<p>数据库中也发生了改变：</p>
<p><img src="1534059550338.png" alt="1534059550338"></p>
<h3 id="1-3-4-分页查询订单"><a href="#1-3-4-分页查询订单" class="headerlink" title="1.3.4.分页查询订单"></a>1.3.4.分页查询订单</h3><p>接口说明：</p>
<ul>
<li>请求方式：Get</li>
<li>请求路径：/order/list</li>
<li>请求参数：<ul>
<li>page：当前页，Integer类型，默认为1</li>
<li>rows：每页大小，Integer类型，默认为5</li>
<li>status：订单状态，String类型，默认查询全部状态订单</li>
</ul>
</li>
<li>返回结果：PageResult   对象，包含下面属性：<ul>
<li>total：总条数</li>
<li>items：当前页订单数组<ul>
<li>订单对象</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>测试：</p>
<p><img src="1534059762431.png" alt="1534059762431"></p>
<p>结果：</p>
<p><img src="1534059802562.png" alt="1534059802562"></p>
<h3 id="1-3-5-生成微信付款链接"><a href="#1-3-5-生成微信付款链接" class="headerlink" title="1.3.5.生成微信付款链接"></a>1.3.5.生成微信付款链接</h3><p>接口说明：</p>
<ul>
<li>请求方式：Get</li>
<li>请求路径：/order/url/{id}</li>
<li>请求参数：id，订单编号</li>
<li>返回结果：String类型，生成的微信支付链接</li>
</ul>
<p>测试：</p>
<p><img src="1534059974834.png" alt="1534059974834"></p>
<p>结果：</p>
<p><img src="1534060051812.png" alt="1534060051812"></p>
<h4 id="微信支付工具"><a href="#微信支付工具" class="headerlink" title="微信支付工具"></a>微信支付工具</h4><blockquote>
<p>PayHelper</p>
</blockquote>
<pre><code class="java">@Component
public class PayHelper &#123;

    private WXPay wxPay;

    private static final Logger logger = LoggerFactory.getLogger(PayHelper.class);

    @Autowired
    private StringRedisTemplate redisTemplate;

    @Autowired
    private OrderService orderService;

    public PayHelper(PayConfig payConfig) &#123;
        // 真实开发时
        wxPay = new WXPay(payConfig);
        // 测试时
        // wxPay = new WXPay(payConfig, WXPayConstants.SignType.MD5, true);
    &#125;

    public String createPayUrl(Long orderId) &#123;
        String key = &quot;ly.pay.url.&quot; + orderId;
        try &#123;
            String url = this.redisTemplate.opsForValue().get(key);
            if (StringUtils.isNotBlank(url)) &#123;
                return url;
            &#125;
        &#125; catch (Exception e) &#123;
            logger.error(&quot;查询缓存付款链接异常,订单编号：&#123;&#125;&quot;, orderId, e);
        &#125;

        try &#123;
            Map&lt;String, String&gt; data = new HashMap&lt;&gt;();
            // 商品描述
            data.put(&quot;body&quot;, &quot;乐优商城测试&quot;);
            // 订单号
            data.put(&quot;out_trade_no&quot;, orderId.toString());
            //货币
            data.put(&quot;fee_type&quot;, &quot;CNY&quot;);
            //金额，单位是分
            data.put(&quot;total_fee&quot;, &quot;1&quot;);
            //调用微信支付的终端IP（estore商城的IP）
            data.put(&quot;spbill_create_ip&quot;, &quot;127.0.0.1&quot;);
            //回调地址
            data.put(&quot;notify_url&quot;, &quot;http://test.leyou.com/wxpay/notify&quot;);
            // 交易类型为扫码支付
            data.put(&quot;trade_type&quot;, &quot;NATIVE&quot;);
            //商品id,使用假数据
            data.put(&quot;product_id&quot;, &quot;1234567&quot;);

            Map&lt;String, String&gt; result = this.wxPay.unifiedOrder(data);

            if (&quot;SUCCESS&quot;.equals(result.get(&quot;return_code&quot;))) &#123;
                String url = result.get(&quot;code_url&quot;);
                // 将付款地址缓存，时间为10分钟
                try &#123;
                    this.redisTemplate.opsForValue().set(key, url, 10, TimeUnit.MINUTES);
                &#125; catch (Exception e) &#123;
                    logger.error(&quot;缓存付款链接异常,订单编号：&#123;&#125;&quot;, orderId, e);
                &#125;
                return url;
            &#125; else &#123;
                logger.error(&quot;创建预交易订单失败，错误信息：&#123;&#125;&quot;, result.get(&quot;return_msg&quot;));
                return null;
            &#125;
        &#125; catch (Exception e) &#123;
            logger.error(&quot;创建预交易订单异常&quot;, e);
            return null;
        &#125;
    &#125;

    /**
     * 查询订单状态
     *
     * @param orderId
     * @return
     */
    public PayState queryOrder(Long orderId) &#123;
        Map&lt;String, String&gt; data = new HashMap&lt;&gt;();
        // 订单号
        data.put(&quot;out_trade_no&quot;, orderId.toString());
        try &#123;
            Map&lt;String, String&gt; result = this.wxPay.orderQuery(data);
            if (result == null) &#123;
                // 未查询到结果，认为是未付款
                return PayState.NOT_PAY;
            &#125;
            String state = result.get(&quot;trade_state&quot;);
            if (&quot;SUCCESS&quot;.equals(state)) &#123;
                // success，则认为付款成功

                // 修改订单状态
                this.orderService.updateStatus(orderId, 2);
                return PayState.SUCCESS;
            &#125; else if (StringUtils.equals(&quot;USERPAYING&quot;, state)
                       || StringUtils.equals(&quot;NOTPAY&quot;, state)) &#123;
                // 未付款或正在付款，都认为是未付款
                return PayState.NOT_PAY;
            &#125; else &#123;
                // 其它状态认为是付款失败
                return PayState.FAIL;
            &#125;
        &#125; catch (Exception e) &#123;
            logger.error(&quot;查询订单状态异常&quot;, e);
            return PayState.NOT_PAY;
        &#125;
    &#125;
&#125;
</code></pre>
<p>跟支付相关的其它几个类：</p>
<p> <img src="1528796883071.png" alt="1528796883071"></p>
<h3 id="1-3-6-查询支付状态"><a href="#1-3-6-查询支付状态" class="headerlink" title="1.3.6.查询支付状态"></a>1.3.6.查询支付状态</h3><p>接口说明：</p>
<ul>
<li>请求方式： Get</li>
<li>请求路径： /state/{id}</li>
<li>请求参数： id，订单编号</li>
<li>返回结果：0, 未查询到支付信息 1,支付成功 2,支付失败（查询失败，或者订单过期）</li>
</ul>
<h4 id="1-3-6-1-未付款"><a href="#1-3-6-1-未付款" class="headerlink" title="1.3.6.1.未付款"></a>1.3.6.1.未付款</h4><p>未付款时查询，测试：</p>
<p><img src="1534060875467.png" alt="1534060875467"></p>
<p>结果：</p>
<p><img src="1534061834503.png" alt="1534061834503"></p>
<p>因为尚未付款，所以查询返回0。</p>
<h4 id="1-3-6-2-付款"><a href="#1-3-6-2-付款" class="headerlink" title="1.3.6.2.付款"></a>1.3.6.2.付款</h4><p>通过JS把链接变成二维码。</p>
<p>找到课前资料提供的JS页面：</p>
<p><img src="1534061965270.png" alt="1534061965270"></p>
<p>进入，并输入刚刚生成的地址：</p>
<p><img src="1534062028046.png" alt="1534062028046"></p>
<h4 id="1-3-6-3-已付款"><a href="#1-3-6-3-已付款" class="headerlink" title="1.3.6.3.已付款"></a>1.3.6.3.已付款</h4><p>扫码支付，然后再次查询：</p>
<p><img src="1534062115599.png" alt="1534062115599"></p>
<p>状态码为1，代表支付成功了！</p>
<h1 id="2-订单结算页"><a href="#2-订单结算页" class="headerlink" title="2.订单结算页"></a>2.订单结算页</h1><h2 id="2-1-页面跳转"><a href="#2-1-页面跳转" class="headerlink" title="2.1.页面跳转"></a>2.1.页面跳转</h2><p>在购物车页面的最下方，有一个去结算按钮：</p>
<p><img src="1527990452791.png" alt="1527990452791"></p>
<p>当点击结算，我们应该跳转到订单结算页，即：<code>getOrderInfo.html</code></p>
<p> <img src="1534062458952.png" alt="1534062458952"></p>
<p>查看购物车的<code>结算</code>按钮：</p>
<p><img src="1534063127883.png" alt="1534063127883"></p>
<p>可以看到，地址是正确的。但是只有登录用户才可以去结算付款，因此我们不能直接跳转，而是在跳转前校验用户的登录状态，如果发现是未登录，应该重定向到登录页！</p>
<p>我们给这个按钮绑定点击事件：</p>
<p><img src="1534063368728.png" alt="1534063368728"></p>
<p>事件中判断登录状态，进行页面跳转：</p>
<pre><code class="js">toOrderInfo() &#123;
    // 判断是否登录
    ly.verifyUser().then(() =&gt; &#123;
        // 已登录
        window.location.href = &quot;/getOrderInfo.html&quot;
    &#125;).catch(() =&gt; &#123;
        // 未登录
        window.location.href = &quot;/login.html?returnUrl=&quot; + window.location.href;
    &#125;)
&#125;
</code></pre>
<p>登录后测试：</p>
<p><img src="1534068627040.png" alt="1534068627040"></p>
<p>此处页面需要渲染的内容主要包含3部分：</p>
<ul>
<li>收货人信息</li>
<li>支付方式</li>
<li>商品信息</li>
</ul>
<h2 id="2-2-收货人信息（作业）"><a href="#2-2-收货人信息（作业）" class="headerlink" title="2.2.收货人信息（作业）"></a>2.2.收货人信息（作业）</h2><p><img src="1528011713709.png" alt="1528011713709"></p>
<p>这里的收货人信息肯定是当前登录用户的收货地址。所以需要根据当前登录用户去查询，目前我们在页面是写的假数据：</p>
<p><img src="1534070259673.png" alt="1534070259673"></p>
<p>大家可以在在后台提供地址的增删改查接口，然后页面加载时根据当前登录用户查询，而后赋值给addresses即可。</p>
<h2 id="2-3-支付方式"><a href="#2-3-支付方式" class="headerlink" title="2.3.支付方式"></a>2.3.支付方式</h2><p>支付方式有2种：</p>
<ul>
<li>微信支付</li>
<li>货到付款</li>
</ul>
<p>与我们订单数据中的<code>paymentType</code>关联：</p>
<p><img src="1528012065388.png" alt="1528012065388"></p>
<p>所以我们可以在Vue实例中定义一个属性来记录支付方式：</p>
<p><img src="1534070467947.png" alt="1534070467947"></p>
<p>然后在页面渲染时与这个变量关联：</p>
<p><img src="1534070743780.png" alt="1534070743780"></p>
<h2 id="2-4-商品列表"><a href="#2-4-商品列表" class="headerlink" title="2.4.商品列表"></a>2.4.商品列表</h2><p>效果图：</p>
<p><img src="1528012881735.png" alt="1528012881735"></p>
<p>这里的送货清单，其实就是购物车中用户选择的要付款的商品</p>
<p>因此，我们需要在购物车跳转过来的同时，携带选中的购物车的信息</p>
<h3 id="2-4-1-购物车信息获取"><a href="#2-4-1-购物车信息获取" class="headerlink" title="2.4.1.购物车信息获取"></a>2.4.1.购物车信息获取</h3><p>我们修改<code>cart.html</code>中的页面跳转逻辑，把用户选中的购物车信息传递过来：</p>
<p><img src="1534071010391.png" alt="1534071010391"></p>
<p>然后在<code>created</code>钩子函数中获取购物车数据，保存到本地属性，要注意的是，我们应该在获取数据前校验用户登录状态，如果发现未登录，则直接重定向到登录页：</p>
<p><img src="1534071493245.png" alt="1534071493245"></p>
<p>然后重新加载页面，查看控制台：</p>
<p><img src="1534071647717.png" alt="1534071647717"></p>
<h3 id="2-4-2-页面渲染"><a href="#2-4-2-页面渲染" class="headerlink" title="2.4.2.页面渲染"></a>2.4.2.页面渲染</h3><p>要修改的页面位置：每一个li就是一件商品</p>
<p><img src="1534071794146.png" alt="1534071794146"></p>
<p>我们修改为：</p>
<pre><code class="html">&lt;ul class=&quot;send-detail&quot;&gt;
    &lt;li v-for=&quot;(cart,index) in carts&quot; :key=&quot;index&quot;&gt;
        &lt;div class=&quot;sendGoods&quot;&gt;
            &lt;ul class=&quot;yui3-g&quot;&gt;
                &lt;li class=&quot;yui3-u-1-6&quot;&gt;
                    &lt;span&gt;&lt;img width=&quot;70px&quot; height=&quot;70px&quot; :src=&quot;cart.image&quot;/&gt;&lt;/span&gt;
                &lt;/li&gt;
                &lt;li class=&quot;yui3-u-7-12&quot;&gt;
                    &lt;div class=&quot;desc&quot;&gt;&#123;&#123;cart.title&#125;&#125;&lt;/div&gt;
                    &lt;div class=&quot;seven&quot;&gt;
                        &lt;span v-for=&quot;(v) in JSON.parse(cart.ownSpec)&quot;&gt;&#123;&#123;v + "  "&#125;&#125; &lt;/span&gt;
                    &lt;/div&gt;
                &lt;/li&gt;
                &lt;li class=&quot;yui3-u-1-12&quot;&gt;
                    &lt;div class=&quot;price&quot;&gt;￥&#123;&#123;ly.formatPrice(cart.price * cart.num)&#125;&#125;&lt;/div&gt;
                &lt;/li&gt;
                &lt;li class=&quot;yui3-u-1-12&quot;&gt;
                    &lt;div class=&quot;num&quot;&gt;&#123;&#123;cart.num&#125;&#125;&lt;/div&gt;
                &lt;/li&gt;
                &lt;li class=&quot;yui3-u-1-12&quot;&gt;
                    &lt;div class=&quot;exit&quot;&gt;有货&lt;/div&gt;
                &lt;/li&gt;
            &lt;/ul&gt;
        &lt;/div&gt;
    &lt;/li&gt;
&lt;/ul&gt;
</code></pre>
<h2 id="2-5-总金额"><a href="#2-5-总金额" class="headerlink" title="2.5.总金额"></a>2.5.总金额</h2><p>另外在商品列表下面，还有一个总金额的计算：</p>
<p><img src="1534072483208.png" alt="1534072483208"></p>
<p>可以看出这里主要有4个数据：</p>
<ul>
<li>总金额：totalPay</li>
<li>优惠返现：discount</li>
<li>运费：postFee</li>
<li>实付金额：actualPay</li>
</ul>
<p>不过我们没有做优惠活动，另外运费需要结合物流系统来计算，暂时我们都设置为0，在order属性中写死：</p>
<p><img src="1534072753146.png" alt="1534072753146"></p>
<p>我们通过计算属性来得到<code>totalPay</code>和<code>actualPay</code>值：</p>
<pre><code class="js">computed: &#123;
    totalNum()&#123;
        return this.carts.reduce((c1, c2) =&gt; c1 + c2.num, 0)
    &#125;,
    totalPay()&#123;
        return this.carts.reduce((c1, c2) =&gt; c1 + c2.price * c2.num, 0);
    &#125;,
    actualPay()&#123;
        return this.totalPay + this.order.postFee - this.order.discount;
    &#125;
&#125;,
</code></pre>
<p>然后在页面渲染：</p>
<p><img src="1534073678931.png" alt="1534073678931"></p>
<p>效果：</p>
<p><img src="1534073704731.png" alt="1534073704731"></p>
<h2 id="2-6-提交订单"><a href="#2-6-提交订单" class="headerlink" title="2.6.提交订单"></a>2.6.提交订单</h2><h3 id="2-6-1-页面提交"><a href="#2-6-1-页面提交" class="headerlink" title="2.6.1.页面提交"></a>2.6.1.页面提交</h3><p>来看下订单接口所需要的数据：</p>
<p><img src="1534074122199.png" alt="1534074122199"></p>
<p>分为3部分，分别是</p>
<ul>
<li><p>订单本身的基本信息</p>
<ul>
<li>总金额</li>
<li>实付金额</li>
<li>付款类型</li>
<li>买家信息就是当前用户</li>
</ul>
</li>
<li><p>订单详情</p>
<ul>
<li>就是购物车中的商品，不过购物车数据会多出一个userId，我们去除即可：</li>
</ul>
<p><img src="1534074293296.png" alt="1534074293296"></p>
</li>
<li><p>物流信息</p>
<ul>
<li>当前用户选中的物流地址信息</li>
</ul>
</li>
</ul>
<p>给提交按钮绑定事件：</p>
<p><img src="1534074374101.png" alt="1534074374101"></p>
<p>然后编写方法，组织数据并提交：</p>
<pre><code class="js">methods: &#123;
    submit() &#123;
        // 把购物车数据处理成订单详情
        const orderDetails = this.carts.map((&#123;userId, ...rest&#125;) =&gt; rest);
        // 处理物流信息
        const addr = this.addresses[this.selectedAddress];
        const obj = &#123;
            receiver: addr.name,
            receiverState: addr.state,
            receiverCity: addr.city,
            receiverAddress: addr.address,
            receiverDistrict: addr.district,
            receiverMobile: addr.phone,
            receiverZip: addr.zipCode
        &#125;;
        // 复制到订单对象
        Object.assign(this.order, obj, &#123;
            orderDetails,
            totalPay: this.totalPay,
            actualPay: this.actualPay,
        &#125;);
        // 提交订单
        ly.http.post(&quot;/order&quot;, this.order).then((&#123;data&#125;) =&gt; &#123;
            // 在线支付，需要到付款页
            window.location = &quot;pay.html?orderId=&quot; + data;
        &#125;).catch((resp) =&gt; &#123;
            alert(&quot;订单提交失败，可能是缺货!&quot;)
        &#125;)
    &#125;
&#125;,
</code></pre>
<h3 id="2-6-2-精度损失问题"><a href="#2-6-2-精度损失问题" class="headerlink" title="2.6.2.精度损失问题"></a>2.6.2.精度损失问题</h3><p>在页面点击提交测试：</p>
<p> <img src="1528340102503.png" alt="1528340102503"></p>
<p>成功生成订单！</p>
<p>然后看页面跳转：</p>
<p> <img src="1528340136603.png" alt="1528340136603"></p>
<p>好像有什么不对？订单号的最后2位不正确啊！</p>
<p>这其实是因为JS的长整数精度有限，java的Long类型数据超出了范围，所以出现了精度损失。</p>
<p>我们后台返回的是Json的字符串，在axios内部会自动调用 JSON.parse()方法把json字符串转为JS数据，就会出现进度损失。如果不进行转换，依然当做字符串来使用，就不会有问题了。</p>
<p>因此，我们重写axios对响应的处理回调函数：</p>
<p> <img src="1528340413139.png" alt="1528340413139"></p>
<pre><code class="javascript">&#123;
    transformResponse: [
        function(data)&#123;
            return data;
        &#125;
    ]
&#125;
</code></pre>
<p>再次测试，就OK了。</p>
<p>接下来就轮到支付了。</p>
<h1 id="3-微信支付"><a href="#3-微信支付" class="headerlink" title="3.微信支付"></a>3.微信支付</h1><h2 id="3-1-介绍"><a href="#3-1-介绍" class="headerlink" title="3.1.介绍"></a>3.1.介绍</h2><p>微信支付官方文档：<a target="_blank" rel="noopener" href="https://pay.weixin.qq.com/index.php/core/home/login?return_url=/">https://pay.weixin.qq.com/index.php/core/home/login?return_url=%2F</a></p>
<p><img src="1527848350188.png" alt="1527848350188"></p>
<p>我们选择开发文档，而后进入选择页面：</p>
<p><img src="1527848358128.png" alt="1527848358128"></p>
<p>选择扫码支付：</p>
<p><img src="1527848368179.png" alt="1527848368179"></p>
<p>此处我们使用模式二来开发：</p>
<h2 id="3-2-开发流程"><a href="#3-2-开发流程" class="headerlink" title="3.2.开发流程"></a>3.2.开发流程</h2><p>模式二与模式一相比，流程更为简单，不依赖设置的回调支付URL。</p>
<p>商户后台系统先调用微信支付的统一下单接口，微信后台系统返回链接参数code_url；</p>
<p>商户后台系统将code_url值生成二维码图片，用户使用微信客户端扫码后发起支付。</p>
<p>注意：code_url有效期为2小时，过期后扫码不能再发起支付。 </p>
<p>流程图：</p>
<p><img src="E:/java/教程/04-架构班/06-项目-微服务/乐优商城-11月版/leyou/day19-下单/笔记/笔记/assets/chapter6_5_1.png" alt="2wa23131"></p>
<p>这里我们把商户（我们）要做的事情总结一下：</p>
<ul>
<li>1、商户生成订单</li>
<li>2、商户调用微信下单接口，获取预交易的链接</li>
<li>3、商户将链接生成二维码图片，展示给用户；</li>
<li>4、用户支付并确认</li>
<li>5、支付结果通知：<ul>
<li>微信异步通知商户支付结果，商户告知微信支付接收情况</li>
<li>商户如果没有收到通知，可以调用接口，查询支付状态</li>
</ul>
</li>
<li>6、如果支付成功，发货，修改订单状态</li>
</ul>
<p>在前面的业务中，我们已经完成了：</p>
<ul>
<li>1、生成订单</li>
</ul>
<p>接下来，我们需要做的是：</p>
<ul>
<li>2、调用微信接口，生成链接。</li>
<li>3、并且生成二维码图片</li>
</ul>
<h2 id="3-3-生成二维码"><a href="#3-3-生成二维码" class="headerlink" title="3.3.生成二维码"></a>3.3.生成二维码</h2><h3 id="3-3-1-生成预交易链接"><a href="#3-3-1-生成预交易链接" class="headerlink" title="3.3.1.生成预交易链接"></a>3.3.1.生成预交易链接</h3><p>我们先根据订单的编号，调用后台服务，生成交易链接，而后才能根据链接生成二维码。</p>
<p>在页面发起请求：</p>
<pre><code class="js">var payVm = new Vue(&#123;
    el:&quot;#payVm&quot;,
    data:&#123;
        ly,
        orderId:0,// 订单编号
    &#125;,
    created()&#123;
        // 判断登录状态
        ly.http.get(&quot;/auth/verify&quot;).then(() =&gt; &#123;
            // 获取订单编号
            this.orderId = ly.getUrlParam(&quot;orderId&quot;);
            // 获取请求链接
            ly.http.get(&quot;/order/url/&quot; + this.orderId)
                .then(resp =&gt; &#123;
                    console.log(resp.data);
                &#125;)
        &#125;).catch(() =&gt; &#123;
            // 未登录，跳转至登录页
             location.href = &quot;/login.html?returnUrl=&quot; + location.href;
        &#125;)
    &#125;,
    components: &#123;
        shortcut: () =&gt; import(&quot;./js/pages/shortcut.js&quot;)
    &#125;
&#125;);
</code></pre>
<p>后台已经定义好生成付款地址的接口。</p>
<p> <img src="1528362159620.png" alt="1528362159620"></p>
<p>刷新页面查看：</p>
<p> <img src="1528362220886.png" alt="1528362220886"></p>
<h3 id="3-3-2-生成二维码"><a href="#3-3-2-生成二维码" class="headerlink" title="3.3.2.生成二维码"></a>3.3.2.生成二维码</h3><p>这里我们使用一个生成二维码的JS插件：qrcode，官网：<a target="_blank" rel="noopener" href="https://github.com/davidshimjs/qrcodejs">https://github.com/davidshimjs/qrcodejs</a></p>
<p><img src="1534313526721.png" alt="1534313526721"></p>
<p>我们把课这个js脚本引入到项目中：</p>
<p> <img src="1528362348399.png" alt="1528362348399"></p>
<p>官方使用案例：</p>
<p><img src="1534313925398.png" alt="1534313925398"></p>
<p>然后在页面引用：</p>
<p> <img src="1528362377494.png" alt="1528362377494"></p>
<p>页面定义一个div，用于展示二维码：</p>
<p> <img src="1528362023061.png" alt="1528362023061"></p>
<p>然后获取到付款链接后，根据链接生成二维码：</p>
<p> <img src="1528362420151.png" alt="1528362420151"></p>
<pre><code class="js">// 判断登录状态
ly.http.get(&quot;/auth/verify&quot;).then(() =&gt; &#123;
    // 获取订单编号
    this.orderId = ly.getUrlParam(&quot;orderId&quot;);
    // 获取请求链接
    ly.http.get(&quot;/order/url/&quot; + this.orderId)
        .then(resp =&gt; &#123;
            new QRCode(document.getElementById(&quot;qrImage&quot;), &#123;
                text: resp.data,
                width: 250,
                height: 250,
                colorDark: &quot;#000000&quot;,
                colorLight: &quot;#ffffff&quot;,
                correctLevel: QRCode.CorrectLevel.H
            &#125;);
        &#125;)
&#125;).catch(() =&gt; &#123;
    // 未登录，跳转至登录页
    location.href = &quot;/login.html?returnUrl=&quot; + location.href;
&#125;)
</code></pre>
<p>刷新页面，查看效果：</p>
<p> <img src="1528362464276.png" alt="1528362464276"></p>
<p>此时，客户用手机扫描二维码，可以看到付款页面。</p>
<h2 id="3-4-付款状态查询"><a href="#3-4-付款状态查询" class="headerlink" title="3.4.付款状态查询"></a>3.4.付款状态查询</h2><p>跳转到支付页面后，我们等待用户付款，付款完成则跳转到付款成功页面。</p>
<h3 id="3-4-1-页面循环查询支付状态"><a href="#3-4-1-页面循环查询支付状态" class="headerlink" title="3.4.1.页面循环查询支付状态"></a>3.4.1.页面循环查询支付状态</h3><p>不过，因为不清楚用户何时会付款，因此这里采用循环的方式，不断请求判断是否支付成功。</p>
<pre><code class="js">// 开启定时任务，查询付款状态
const taskId = setInterval(() =&gt; &#123;
    ly.http.get(&quot;/order/state/&quot; + this.orderId)
        .then(resp =&gt; &#123;
        let i = resp.data;
        if (i === 1) &#123;
            // 付款成功
            clearInterval(taskId);
            // 跳转到付款成功页
            location.href = &quot;/paysuccess.html?orderId=&quot; + this.orderId;
        &#125; else if (i === 2) &#123;
            // 付款失败
            clearInterval(taskId);
            // 跳转到付款失败页
            location.href = &quot;/payfail.html&quot;;
        &#125;
    &#125;)
&#125;, 3000);
</code></pre>
<h3 id="3-4-2-付款成功页面"><a href="#3-4-2-付款成功页面" class="headerlink" title="3.4.2.付款成功页面"></a>3.4.2.付款成功页面</h3><p>当付款成功后，自动跳转到付款成功页面：</p>
<p><img src="1528376883924.png" alt="1528376883924"></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/API/" rel="tag"># API</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/06/05/leyou%E9%97%A8%E6%88%B7-7-%E8%B4%AD%E7%89%A9%E8%BD%A6/" rel="prev" title="leyou门户#7-购物车">
      <i class="fa fa-chevron-left"></i> leyou门户#7-购物车
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/06/07/java%E5%AE%B9%E5%99%A8-1-Collection%E6%8E%A5%E5%8F%A3/" rel="next" title="java容器#1-Collection接口">
      java容器#1-Collection接口 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-%E8%AE%A2%E5%8D%95%E7%B3%BB%E7%BB%9F%E6%8E%A5%E5%8F%A3"><span class="nav-text">1.订单系统接口</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-%E5%AF%BC%E5%85%A5%E8%AE%A2%E5%8D%95%E6%9C%8D%E5%8A%A1"><span class="nav-text">1.1.导入订单服务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-Swagger-UI"><span class="nav-text">1.2.Swagger-UI</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-1-%E4%BB%80%E4%B9%88%E6%98%AFOpenAPI"><span class="nav-text">1.2.1.什么是OpenAPI</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-2-%E4%BB%80%E4%B9%88%E6%98%AFswagger%EF%BC%9F"><span class="nav-text">1.2.2.什么是swagger？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-3-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="nav-text">1.2.3.快速入门</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%EF%BC%89%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="nav-text">1）引入依赖</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%EF%BC%89%E7%BC%96%E5%86%99%E9%85%8D%E7%BD%AE"><span class="nav-text">2）编写配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3%EF%BC%89%E6%8E%A5%E5%8F%A3%E5%A3%B0%E6%98%8E"><span class="nav-text">3）接口声明</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4%EF%BC%89%E5%90%AF%E5%8A%A8%E6%B5%8B%E8%AF%95"><span class="nav-text">4）启动测试</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-%E6%B5%8B%E8%AF%95%E6%8E%A5%E5%8F%A3"><span class="nav-text">1.3.测试接口</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-1-%E5%88%9B%E5%BB%BA%E8%AE%A2%E5%8D%95%E6%8E%A5%E5%8F%A3"><span class="nav-text">1.3.1.创建订单接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-2-%E7%94%9F%E6%88%90ID%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="nav-text">1.3.2.生成ID的方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-2-%E6%9F%A5%E8%AF%A2%E8%AE%A2%E5%8D%95%E6%8E%A5%E5%8F%A3"><span class="nav-text">1.3.2.查询订单接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-3-%E6%9B%B4%E6%96%B0%E8%AE%A2%E5%8D%95%E7%8A%B6%E6%80%81"><span class="nav-text">1.3.3.更新订单状态</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-4-%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E8%AE%A2%E5%8D%95"><span class="nav-text">1.3.4.分页查询订单</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-5-%E7%94%9F%E6%88%90%E5%BE%AE%E4%BF%A1%E4%BB%98%E6%AC%BE%E9%93%BE%E6%8E%A5"><span class="nav-text">1.3.5.生成微信付款链接</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98%E5%B7%A5%E5%85%B7"><span class="nav-text">微信支付工具</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-6-%E6%9F%A5%E8%AF%A2%E6%94%AF%E4%BB%98%E7%8A%B6%E6%80%81"><span class="nav-text">1.3.6.查询支付状态</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-6-1-%E6%9C%AA%E4%BB%98%E6%AC%BE"><span class="nav-text">1.3.6.1.未付款</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-6-2-%E4%BB%98%E6%AC%BE"><span class="nav-text">1.3.6.2.付款</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-6-3-%E5%B7%B2%E4%BB%98%E6%AC%BE"><span class="nav-text">1.3.6.3.已付款</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-%E8%AE%A2%E5%8D%95%E7%BB%93%E7%AE%97%E9%A1%B5"><span class="nav-text">2.订单结算页</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-%E9%A1%B5%E9%9D%A2%E8%B7%B3%E8%BD%AC"><span class="nav-text">2.1.页面跳转</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-%E6%94%B6%E8%B4%A7%E4%BA%BA%E4%BF%A1%E6%81%AF%EF%BC%88%E4%BD%9C%E4%B8%9A%EF%BC%89"><span class="nav-text">2.2.收货人信息（作业）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3-%E6%94%AF%E4%BB%98%E6%96%B9%E5%BC%8F"><span class="nav-text">2.3.支付方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-4-%E5%95%86%E5%93%81%E5%88%97%E8%A1%A8"><span class="nav-text">2.4.商品列表</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-1-%E8%B4%AD%E7%89%A9%E8%BD%A6%E4%BF%A1%E6%81%AF%E8%8E%B7%E5%8F%96"><span class="nav-text">2.4.1.购物车信息获取</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-2-%E9%A1%B5%E9%9D%A2%E6%B8%B2%E6%9F%93"><span class="nav-text">2.4.2.页面渲染</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-5-%E6%80%BB%E9%87%91%E9%A2%9D"><span class="nav-text">2.5.总金额</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-6-%E6%8F%90%E4%BA%A4%E8%AE%A2%E5%8D%95"><span class="nav-text">2.6.提交订单</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-1-%E9%A1%B5%E9%9D%A2%E6%8F%90%E4%BA%A4"><span class="nav-text">2.6.1.页面提交</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-2-%E7%B2%BE%E5%BA%A6%E6%8D%9F%E5%A4%B1%E9%97%AE%E9%A2%98"><span class="nav-text">2.6.2.精度损失问题</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98"><span class="nav-text">3.微信支付</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-%E4%BB%8B%E7%BB%8D"><span class="nav-text">3.1.介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B"><span class="nav-text">3.2.开发流程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-%E7%94%9F%E6%88%90%E4%BA%8C%E7%BB%B4%E7%A0%81"><span class="nav-text">3.3.生成二维码</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-1-%E7%94%9F%E6%88%90%E9%A2%84%E4%BA%A4%E6%98%93%E9%93%BE%E6%8E%A5"><span class="nav-text">3.3.1.生成预交易链接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-2-%E7%94%9F%E6%88%90%E4%BA%8C%E7%BB%B4%E7%A0%81"><span class="nav-text">3.3.2.生成二维码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-4-%E4%BB%98%E6%AC%BE%E7%8A%B6%E6%80%81%E6%9F%A5%E8%AF%A2"><span class="nav-text">3.4.付款状态查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-1-%E9%A1%B5%E9%9D%A2%E5%BE%AA%E7%8E%AF%E6%9F%A5%E8%AF%A2%E6%94%AF%E4%BB%98%E7%8A%B6%E6%80%81"><span class="nav-text">3.4.1.页面循环查询支付状态</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-2-%E4%BB%98%E6%AC%BE%E6%88%90%E5%8A%9F%E9%A1%B5%E9%9D%A2"><span class="nav-text">3.4.2.付款成功页面</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="摘星"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">摘星</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">241</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">24</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">139</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/zhangkexuan" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zhangkexuan" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/kexuan_zhang@qq.com" title="E-Mail → kexuan_zhang@qq.com"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2019 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">摘星</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>

<!-- ҳ����С���� -->
<script type="text/javascript" src="/js/clicklove.js"></script>
