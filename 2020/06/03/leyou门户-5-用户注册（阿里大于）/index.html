<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="在门户网站上的注册，需要使用阿里大于短信服务：  创建用户中心 了解面向接口开发方式 实现数据校验功能 实现短信发送功能 实现注册功能 实现根据用户名和密码查询用户功能">
<meta property="og:type" content="article">
<meta property="og:title" content="leyou门户#5-用户注册（阿里大于）">
<meta property="og:url" content="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/index.html">
<meta property="og:site_name" content="摘星">
<meta property="og:description" content="在门户网站上的注册，需要使用阿里大于短信服务：  创建用户中心 了解面向接口开发方式 实现数据校验功能 实现短信发送功能 实现注册功能 实现根据用户名和密码查询用户功能">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/1532778843008.png">
<meta property="og:image" content="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/1532778910920.png">
<meta property="og:image" content="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/1532779001951.png">
<meta property="og:image" content="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/1532779042843.png">
<meta property="og:image" content="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/1532779120507.png">
<meta property="og:image" content="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/1532779166910.png">
<meta property="og:image" content="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/1532779772325.png">
<meta property="og:image" content="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/1527174356711.png">
<meta property="og:image" content="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/1532781014342.png">
<meta property="og:image" content="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/1532781696303.png">
<meta property="og:image" content="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/1532781679924.png">
<meta property="og:image" content="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/1532781726835.png">
<meta property="og:image" content="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/1532786840913.png">
<meta property="og:image" content="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/1532786877872.png">
<meta property="og:image" content="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/1532955721215.png">
<meta property="og:image" content="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/1532953272670.png">
<meta property="og:image" content="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/1532953320455.png">
<meta property="og:image" content="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/1532953460407.png">
<meta property="og:image" content="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/1527238127932.png">
<meta property="og:image" content="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/1532955014018.png">
<meta property="og:image" content="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/1527250056698.png">
<meta property="og:image" content="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/1527250218215.png">
<meta property="og:image" content="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/1527256139407.png">
<meta property="og:image" content="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/1533013812311.png">
<meta property="og:image" content="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/1533013709197.png">
<meta property="og:image" content="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/1533020768508.png">
<meta property="og:image" content="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/1533017923560.png">
<meta property="og:image" content="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/1533018062186.png">
<meta property="og:image" content="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/1527240855176.png">
<meta property="og:image" content="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/1533023141026.png">
<meta property="og:image" content="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/1533024221725.png">
<meta property="og:image" content="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/1533024241233.png">
<meta property="og:image" content="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/1527244265451.png">
<meta property="og:image" content="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/1527244393041.png">
<meta property="og:image" content="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/1533030001081.png">
<meta property="og:image" content="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/1533029312208.png">
<meta property="og:image" content="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/1533029343713.png">
<meta property="og:image" content="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/1533030961886.png">
<meta property="og:image" content="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/1533031066018.png">
<meta property="og:image" content="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/1533031705871.png">
<meta property="article:published_time" content="2020-06-03T09:21:04.000Z">
<meta property="article:modified_time" content="2021-05-19T02:12:12.552Z">
<meta property="article:author" content="摘星">
<meta property="article:tag" content="dayu">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/1532778843008.png">

<link rel="canonical" href="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>leyou门户#5-用户注册（阿里大于） | 摘星</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">摘星</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/03/leyou%E9%97%A8%E6%88%B7-5-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%EF%BC%88%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="摘星">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="摘星">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          leyou门户#5-用户注册（阿里大于）
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-03 17:21:04" itemprop="dateCreated datePublished" datetime="2020-06-03T17:21:04+08:00">2020-06-03</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/leyou/" itemprop="url" rel="index"><span itemprop="name">leyou</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>在门户网站上的注册，需要使用阿里大于短信服务：</p>
<ul>
<li>创建用户中心</li>
<li>了解面向接口开发方式</li>
<li>实现数据校验功能</li>
<li>实现短信发送功能</li>
<li>实现注册功能</li>
<li>实现根据用户名和密码查询用户功能</li>
</ul>
<span id="more"></span>

<h1 id="1-创建用户中心"><a href="#1-创建用户中心" class="headerlink" title="1.创建用户中心"></a>1.创建用户中心</h1><p>用户搜索到自己心仪的商品，接下来就要去购买，但是购买必须先登录。所以接下来我们编写用户中心，实现用户的登录和注册功能。</p>
<p>用户中心的提供的服务：</p>
<ul>
<li>用户的注册</li>
<li>用户登录</li>
<li>用户个人信息管理</li>
<li>用户地址管理</li>
<li>用户收藏管理</li>
<li>我的订单</li>
<li>优惠券管理</li>
</ul>
<p>这里我们暂时先实现基本的：<code>注册和登录</code>功能，其它功能大家可以自行补充完整。</p>
<p>因为用户中心的服务其它微服务也会调用，因此这里我们做聚合。</p>
<p>leyou-user：父工程，包含2个子工程：</p>
<ul>
<li>leyou-user-interface：实体及接口</li>
<li>leyou-user-service：业务和服务</li>
</ul>
<h2 id="1-1-创建父module"><a href="#1-1-创建父module" class="headerlink" title="1.1.创建父module"></a>1.1.创建父module</h2><p>创建</p>
<p><img src="1532778843008.png" alt="1532778843008"></p>
<p>位置：</p>
<p><img src="1532778910920.png" alt="1532778910920"></p>
<h2 id="1-2-创建leyou-user-interface"><a href="#1-2-创建leyou-user-interface" class="headerlink" title="1.2.创建leyou-user-interface"></a>1.2.创建leyou-user-interface</h2><p>在leyou-user下，创建module：</p>
<p><img src="1532779001951.png" alt="1532779001951"></p>
<p><img src="1532779042843.png" alt="1532779042843"></p>
<p>pom：</p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;parent&gt;
        &lt;artifactId&gt;leyou-user&lt;/artifactId&gt;
        &lt;groupId&gt;com.leyou.user&lt;/groupId&gt;
        &lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;groupId&gt;com.leyou.user&lt;/groupId&gt;
    &lt;artifactId&gt;leyou-user-interface&lt;/artifactId&gt;
    &lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;

&lt;/project&gt;
</code></pre>
<h2 id="1-3-创建leyou-user-service"><a href="#1-3-创建leyou-user-service" class="headerlink" title="1.3.创建leyou-user-service"></a>1.3.创建leyou-user-service</h2><p>创建module</p>
<p><img src="1532779120507.png" alt="1532779120507"></p>
<p><img src="1532779166910.png" alt="1532779166910"></p>
<p>pom</p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;parent&gt;
        &lt;artifactId&gt;leyou-user&lt;/artifactId&gt;
        &lt;groupId&gt;com.leyou.user&lt;/groupId&gt;
        &lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;groupId&gt;com.leyou.user&lt;/groupId&gt;
    &lt;artifactId&gt;leyou-user-service&lt;/artifactId&gt;
    &lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- mybatis启动器 --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;
            &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- 通用Mapper启动器 --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;tk.mybatis&lt;/groupId&gt;
            &lt;artifactId&gt;mapper-spring-boot-starter&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- mysql驱动 --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;mysql&lt;/groupId&gt;
            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.leyou.user&lt;/groupId&gt;
            &lt;artifactId&gt;leyou-user-interface&lt;/artifactId&gt;
            &lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

&lt;/project&gt;
</code></pre>
<p>启动类</p>
<pre><code class="java">@SpringBootApplication
@EnableDiscoveryClient
@MapperScan(&quot;com.leyou.user.mapper&quot;)
public class LeyouUserApplication &#123;

    public static void main(String[] args) &#123;
        SpringApplication.run(LeyouUserApplication.class, args);
    &#125;
&#125;
</code></pre>
<p>配置：</p>
<pre><code class="yaml">server:
  port: 8085
spring:
  application:
    name: user-service
  datasource:
    url: jdbc:mysql://127.0.0.1:3306/leyou
    username: root
    password: root
    driver-class-name: com.mysql.jdbc.Driver
eureka:
  client:
    service-url:
      defaultZone: http://127.0.0.1:10086/eureka
  instance:
    lease-renewal-interval-in-seconds: 5
    lease-expiration-duration-in-seconds: 15

mybatis:
  type-aliases-package: com.leyou.user.pojo
</code></pre>
<p>父工程leyou-user的pom：</p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;parent&gt;
        &lt;artifactId&gt;leyou&lt;/artifactId&gt;
        &lt;groupId&gt;com.leyou.parent&lt;/groupId&gt;
        &lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;groupId&gt;com.leyou.user&lt;/groupId&gt;
    &lt;artifactId&gt;leyou-user&lt;/artifactId&gt;
    &lt;packaging&gt;pom&lt;/packaging&gt;
    &lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;
    &lt;modules&gt;
        &lt;module&gt;leyou-user-interface&lt;/module&gt;
        &lt;module&gt;leyou-user-service&lt;/module&gt;
    &lt;/modules&gt;

&lt;/project&gt;
</code></pre>
<h2 id="1-4-添加网关路由"><a href="#1-4-添加网关路由" class="headerlink" title="1.4.添加网关路由"></a>1.4.添加网关路由</h2><p>我们修改<code>leyou-gateway</code>，添加路由规则，对<code>leyou-user-service</code>进行路由:</p>
<p><img src="1532779772325.png" alt="1532779772325"></p>
<h1 id="2-后台功能准备"><a href="#2-后台功能准备" class="headerlink" title="2.后台功能准备"></a>2.后台功能准备</h1><h2 id="2-1-接口文档"><a href="#2-1-接口文档" class="headerlink" title="2.1.接口文档"></a>2.1.接口文档</h2><p>整个用户中心的开发，我们将模拟公司内面向接口的开发。</p>
<p>现在假设项目经理已经设计好了接口文档，详见：《用户中心接口说明.md》</p>
<p><img src="1527174356711.png" alt="1527174356711"></p>
<p>我们将根据文档直接编写后台功能，不关心页面实现。</p>
<h2 id="2-2-数据结构"><a href="#2-2-数据结构" class="headerlink" title="2.2.数据结构"></a>2.2.数据结构</h2><pre><code class="mysql">CREATE TABLE `tb_user` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `username` varchar(50) NOT NULL COMMENT &#39;用户名&#39;,
  `password` varchar(32) NOT NULL COMMENT &#39;密码，加密存储&#39;,
  `phone` varchar(20) DEFAULT NULL COMMENT &#39;注册手机号&#39;,
  `created` datetime NOT NULL COMMENT &#39;创建时间&#39;,
  `salt` varchar(32) NOT NULL COMMENT &#39;密码加密的salt值&#39;,
  PRIMARY KEY (`id`),
  UNIQUE KEY `username` (`username`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=28 DEFAULT CHARSET=utf8 COMMENT=&#39;用户表&#39;;
</code></pre>
<p>数据结构比较简单，因为根据用户名查询的频率较高，所以我们给用户名创建了索引</p>
<h2 id="2-3-基本代码"><a href="#2-3-基本代码" class="headerlink" title="2.3.基本代码"></a>2.3.基本代码</h2><p> <img src="1532781014342.png" alt="1532781014342"></p>
<h3 id="2-3-1-实体类"><a href="#2-3-1-实体类" class="headerlink" title="2.3.1.实体类"></a>2.3.1.实体类</h3><pre><code class="java">@Table(name = &quot;tb_user&quot;)
public class User &#123;
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String username;// 用户名

    @JsonIgnore
    private String password;// 密码

    private String phone;// 电话

    private Date created;// 创建时间

    @JsonIgnore
    private String salt;// 密码的盐值
&#125;
</code></pre>
<p>注意：为了安全考虑。这里对password和salt添加了注解@JsonIgnore，这样在json序列化时，就不会把password和salt返回。</p>
<h3 id="2-3-2-mapper"><a href="#2-3-2-mapper" class="headerlink" title="2.3.2.mapper"></a>2.3.2.mapper</h3><pre><code class="java">public interface UserMapper extends Mapper&lt;User&gt; &#123;
&#125;
</code></pre>
<h3 id="2-3-3-Service"><a href="#2-3-3-Service" class="headerlink" title="2.3.3.Service"></a>2.3.3.Service</h3><pre><code class="java">@Service
public class UserService &#123;

    @Autowired
    private UserMapper userMapper;
&#125;
</code></pre>
<h3 id="2-3-4-controller"><a href="#2-3-4-controller" class="headerlink" title="2.3.4.controller"></a>2.3.4.controller</h3><pre><code class="java">@Controller
public class UserController &#123;

    @Autowired
    private UserService userService;
    
&#125;
</code></pre>
<h1 id="3-数据验证功能"><a href="#3-数据验证功能" class="headerlink" title="3.数据验证功能"></a>3.数据验证功能</h1><h2 id="3-1-接口说明"><a href="#3-1-接口说明" class="headerlink" title="3.1.接口说明"></a>3.1.接口说明</h2><p>实现用户数据的校验，主要包括对：手机号、用户名的唯一性校验。</p>
<p><strong>接口路径：</strong></p>
<pre><code>GET /check/&#123;data&#125;/&#123;type&#125;
</code></pre>
<p><strong>参数说明：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>是否必须</th>
<th>数据类型</th>
<th>默认值</th>
</tr>
</thead>
<tbody><tr>
<td>data</td>
<td>要校验的数据</td>
<td>是</td>
<td>String</td>
<td>无</td>
</tr>
<tr>
<td>type</td>
<td>要校验的数据类型：1，用户名；2，手机；</td>
<td>否</td>
<td>Integer</td>
<td>1</td>
</tr>
</tbody></table>
<p><strong>返回结果：</strong></p>
<p>返回布尔类型结果：</p>
<ul>
<li>true：可用</li>
<li>false：不可用</li>
</ul>
<p>状态码：</p>
<ul>
<li>200：校验成功</li>
<li>400：参数有误</li>
<li>500：服务器内部异常</li>
</ul>
<h2 id="3-2-controller"><a href="#3-2-controller" class="headerlink" title="3.2.controller"></a>3.2.controller</h2><p>因为有了接口，我们可以不关心页面，所有需要的东西都一清二楚：</p>
<ul>
<li>请求方式：GET</li>
<li>请求路径：/check/{param}/{type}</li>
<li>请求参数：param,type</li>
<li>返回结果：true或false</li>
</ul>
<pre><code class="java">/**
  * 校验数据是否可用
  * @param data
  * @param type
  * @return
  */
@GetMapping(&quot;check/&#123;data&#125;/&#123;type&#125;&quot;)
public ResponseEntity&lt;Boolean&gt; checkUserData(@PathVariable(&quot;data&quot;) String data, @PathVariable(value = &quot;type&quot;) Integer type) &#123;
    Boolean boo = this.userService.checkData(data, type);
    if (boo == null) &#123;
        return ResponseEntity.status(HttpStatus.BAD_REQUEST).build();
    &#125;
    return ResponseEntity.ok(boo);
&#125;
</code></pre>
<h2 id="3-3-Service"><a href="#3-3-Service" class="headerlink" title="3.3.Service"></a>3.3.Service</h2><pre><code class="java">public Boolean checkData(String data, Integer type) &#123;
    User record = new User();
    switch (type) &#123;
        case 1:
            record.setUsername(data);
            break;
        case 2:
            record.setPhone(data);
            break;
        default:
            return null;
    &#125;
    return this.userMapper.selectCount(record) == 0;
&#125;
</code></pre>
<h2 id="3-4-测试"><a href="#3-4-测试" class="headerlink" title="3.4.测试"></a>3.4.测试</h2><p>我们在数据库插入一条假数据：</p>
<p><img src="1532781696303.png" alt="1532781696303"></p>
<p>然后在浏览器调用接口，测试：</p>
<p><img src="1532781679924.png" alt="1532781679924"></p>
<p><img src="1532781726835.png" alt="1532781726835"></p>
<h1 id="4-阿里大于短信服务"><a href="#4-阿里大于短信服务" class="headerlink" title="4.阿里大于短信服务"></a>4.阿里大于短信服务</h1><h2 id="4-1-demo"><a href="#4-1-demo" class="headerlink" title="4.1.demo"></a>4.1.demo</h2><p>注册页面上有短信发送的按钮，当用户点击发送短信，我们需要生成验证码，发送给用户。我们将使用阿里提供的阿里大于来实现短信发送。</p>
<p>参考课前资料的《阿里短信.md》学习demo入门</p>
<h2 id="4-2-创建短信微服务"><a href="#4-2-创建短信微服务" class="headerlink" title="4.2.创建短信微服务"></a>4.2.创建短信微服务</h2><p>因为系统中不止注册一个地方需要短信发送，因此我们将短信发送抽取为微服务：<code>leyou-sms-service</code>，凡是需要的地方都可以使用。</p>
<p>另外，因为短信发送API调用时长的不确定性，为了提高程序的响应速度，短信发送我们都将采用异步发送方式，即：</p>
<ul>
<li>短信服务监听MQ消息，收到消息后发送短信。</li>
<li>其它服务要发送短信时，通过MQ通知短信微服务。</li>
</ul>
<h3 id="4-2-1-创建module"><a href="#4-2-1-创建module" class="headerlink" title="4.2.1.创建module"></a>4.2.1.创建module</h3><p><img src="1532786840913.png" alt="1532786840913"></p>
<p><img src="1532786877872.png" alt="1532786877872"></p>
<h3 id="4-2-2-pom"><a href="#4-2-2-pom" class="headerlink" title="4.2.2.pom"></a>4.2.2.pom</h3><pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;parent&gt;
        &lt;artifactId&gt;leyou&lt;/artifactId&gt;
        &lt;groupId&gt;com.leyou.parent&lt;/groupId&gt;
        &lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;groupId&gt;com.leyou.sms&lt;/groupId&gt;
    &lt;artifactId&gt;leyou-sms-service&lt;/artifactId&gt;
    &lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.aliyun&lt;/groupId&gt;
            &lt;artifactId&gt;aliyun-java-sdk-core&lt;/artifactId&gt;
            &lt;version&gt;3.3.1&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.aliyun&lt;/groupId&gt;
            &lt;artifactId&gt;aliyun-java-sdk-dysmsapi&lt;/artifactId&gt;
            &lt;version&gt;1.0.0&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/project&gt;
</code></pre>
<h3 id="4-2-3-编写启动类"><a href="#4-2-3-编写启动类" class="headerlink" title="4.2.3.编写启动类"></a>4.2.3.编写启动类</h3><pre><code class="java">@SpringBootApplication
public class LeyouSmsApplication &#123;
    public static void main(String[] args) &#123;
        SpringApplication.run(LeyouSmsApplication.class, args);
    &#125;
&#125;
</code></pre>
<h3 id="4-2-4-编写application-yml"><a href="#4-2-4-编写application-yml" class="headerlink" title="4.2.4.编写application.yml"></a>4.2.4.编写application.yml</h3><pre><code class="yaml">server:
  port: 8086
spring:
  application:
    name: sms-service
  rabbitmq:
    host: 192.168.56.101
    username: leyou
    password: leyou
    virtual-host: /leyou
</code></pre>
<h2 id="4-3-编写短信工具类"><a href="#4-3-编写短信工具类" class="headerlink" title="4.3.编写短信工具类"></a>4.3.编写短信工具类</h2><p>项目结构：</p>
<p> <img src="1532955721215.png" alt="1532955721215"></p>
<h3 id="4-3-1-属性抽取"><a href="#4-3-1-属性抽取" class="headerlink" title="4.3.1.属性抽取"></a>4.3.1.属性抽取</h3><p>我们首先把一些常量抽取到application.yml中：</p>
<pre><code class="yaml">leyou:
  sms:
    accessKeyId: JWffwFJIwada # 你自己的accessKeyId
    accessKeySecret: aySRliswq8fe7rF9gQyy1Izz4MQ # 你自己的AccessKeySecret
    signName: 乐优商城 # 签名名称
    verifyCodeTemplate: SMS_133976814 # 模板名称
</code></pre>
<p>然后注入到属性类中：</p>
<pre><code class="java">@ConfigurationProperties(prefix = &quot;leyou.sms&quot;)
public class SmsProperties &#123;

    String accessKeyId;

    String accessKeySecret;

    String signName;

    String verifyCodeTemplate;

    public String getAccessKeyId() &#123;
        return accessKeyId;
    &#125;

    public void setAccessKeyId(String accessKeyId) &#123;
        this.accessKeyId = accessKeyId;
    &#125;

    public String getAccessKeySecret() &#123;
        return accessKeySecret;
    &#125;

    public void setAccessKeySecret(String accessKeySecret) &#123;
        this.accessKeySecret = accessKeySecret;
    &#125;

    public String getSignName() &#123;
        return signName;
    &#125;

    public void setSignName(String signName) &#123;
        this.signName = signName;
    &#125;

    public String getVerifyCodeTemplate() &#123;
        return verifyCodeTemplate;
    &#125;

    public void setVerifyCodeTemplate(String verifyCodeTemplate) &#123;
        this.verifyCodeTemplate = verifyCodeTemplate;
    &#125;
&#125;
</code></pre>
<h3 id="4-3-2-工具类"><a href="#4-3-2-工具类" class="headerlink" title="4.3.2.工具类"></a>4.3.2.工具类</h3><p>我们把阿里提供的demo进行简化和抽取，封装一个工具类：</p>
<pre><code class="java">@Component
@EnableConfigurationProperties(SmsProperties.class)
public class SmsUtils &#123;

    @Autowired
    private SmsProperties prop;

    //产品名称:云通信短信API产品,开发者无需替换
    static final String product = &quot;Dysmsapi&quot;;
    //产品域名,开发者无需替换
    static final String domain = &quot;dysmsapi.aliyuncs.com&quot;;

    static final Logger logger = LoggerFactory.getLogger(SmsUtils.class);

    public SendSmsResponse sendSms(String phone, String code, String signName, String template) throws ClientException &#123;

        //可自助调整超时时间
        System.setProperty(&quot;sun.net.client.defaultConnectTimeout&quot;, &quot;10000&quot;);
        System.setProperty(&quot;sun.net.client.defaultReadTimeout&quot;, &quot;10000&quot;);

        //初始化acsClient,暂不支持region化
        IClientProfile profile = DefaultProfile.getProfile(&quot;cn-hangzhou&quot;,
                prop.getAccessKeyId(), prop.getAccessKeySecret());
        DefaultProfile.addEndpoint(&quot;cn-hangzhou&quot;, &quot;cn-hangzhou&quot;, product, domain);
        IAcsClient acsClient = new DefaultAcsClient(profile);

        //组装请求对象-具体描述见控制台-文档部分内容
        SendSmsRequest request = new SendSmsRequest();
        request.setMethod(MethodType.POST);
        //必填:待发送手机号
        request.setPhoneNumbers(phone);
        //必填:短信签名-可在短信控制台中找到
        request.setSignName(signName);
        //必填:短信模板-可在短信控制台中找到
        request.setTemplateCode(template);
        //可选:模板中的变量替换JSON串,如模板内容为&quot;亲爱的$&#123;name&#125;,您的验证码为$&#123;code&#125;&quot;时,此处的值为
        request.setTemplateParam(&quot;&#123;\&quot;code\&quot;:\&quot;&quot; + code + &quot;\&quot;&#125;&quot;);

        //选填-上行短信扩展码(无特殊需求用户请忽略此字段)
        //request.setSmsUpExtendCode(&quot;90997&quot;);

        //可选:outId为提供给业务方扩展字段,最终在短信回执消息中将此值带回给调用者
        request.setOutId(&quot;123456&quot;);

        //hint 此处可能会抛出异常，注意catch
        SendSmsResponse sendSmsResponse = acsClient.getAcsResponse(request);

        logger.info(&quot;发送短信状态：&#123;&#125;&quot;, sendSmsResponse.getCode());
        logger.info(&quot;发送短信消息：&#123;&#125;&quot;, sendSmsResponse.getMessage());

        return sendSmsResponse;
    &#125;
&#125;
</code></pre>
<h2 id="4-4-编写消息监听器"><a href="#4-4-编写消息监听器" class="headerlink" title="4.4.编写消息监听器"></a>4.4.编写消息监听器</h2><p>接下来，编写消息监听器，当接收到消息后，我们发送短信。</p>
<pre><code class="java">@Component
@EnableConfigurationProperties(SmsProperties.class)
public class SmsListener &#123;

    @Autowired
    private SmsUtils smsUtils;

    @Autowired
    private SmsProperties prop;

    @RabbitListener(bindings = @QueueBinding(
            value = @Queue(value = &quot;leyou.sms.queue&quot;, durable = &quot;true&quot;),
            exchange = @Exchange(value = &quot;leyou.sms.exchange&quot;, 
                                 ignoreDeclarationExceptions = &quot;true&quot;),
            key = &#123;&quot;sms.verify.code&quot;&#125;))
    public void listenSms(Map&lt;String, String&gt; msg) throws Exception &#123;
        if (msg == null || msg.size() &lt;= 0) &#123;
            // 放弃处理
            return;
        &#125;
        String phone = msg.get(&quot;phone&quot;);
        String code = msg.get(&quot;code&quot;);

        if (StringUtils.isBlank(phone) || StringUtils.isBlank(code)) &#123;
            // 放弃处理
            return;
        &#125;
        // 发送消息
        SendSmsResponse resp = this.smsUtils.sendSms(phone, code, 
                                                     prop.getSignName(),
                                                     prop.getVerifyCodeTemplate());
        
    &#125;
&#125;
</code></pre>
<p>我们注意到，消息体是一个Map，里面有两个属性：</p>
<ul>
<li>phone：电话号码</li>
<li>code：短信验证码</li>
</ul>
<h2 id="4-5-启动"><a href="#4-5-启动" class="headerlink" title="4.5.启动"></a>4.5.启动</h2><p>启动项目，然后查看RabbitMQ控制台，发现交换机已经创建：</p>
<p><img src="1532953272670.png" alt="1532953272670"></p>
<p>队列也已经创建：</p>
<p><img src="1532953320455.png" alt="1532953320455"></p>
<p>并且绑定：</p>
<p><img src="1532953460407.png" alt="1532953460407"></p>
<h1 id="5-发送短信功能"><a href="#5-发送短信功能" class="headerlink" title="5.发送短信功能"></a>5.发送短信功能</h1><p>短信微服务已经准备好，我们就可以继续编写用户中心接口了。</p>
<h2 id="5-1-接口说明"><a href="#5-1-接口说明" class="headerlink" title="5.1.接口说明"></a>5.1.接口说明</h2><p><img src="1527238127932.png" alt="1527238127932"></p>
<p>这里的业务逻辑是这样的：</p>
<ul>
<li>1）我们接收页面发送来的手机号码</li>
<li>2）生成一个随机验证码</li>
<li>3）将验证码保存在服务端</li>
<li>4）发送短信，将验证码发送到用户手机</li>
</ul>
<p>那么问题来了：验证码保存在哪里呢？</p>
<p>验证码有一定有效期，一般是5分钟，我们可以利用Redis的过期机制来保存。</p>
<h2 id="5-2-Redis"><a href="#5-2-Redis" class="headerlink" title="5.2.Redis"></a>5.2.Redis</h2><h3 id="5-2-1-安装"><a href="#5-2-1-安装" class="headerlink" title="5.2.1.安装"></a>5.2.1.安装</h3><p>参考课前资料中的：《centos下的redis安装配置.md》</p>
<p><img src="1532955014018.png" alt="1532955014018"></p>
<h3 id="5-2-2-Spring-Data-Redis"><a href="#5-2-2-Spring-Data-Redis" class="headerlink" title="5.2.2.Spring Data Redis"></a>5.2.2.Spring Data Redis</h3><p>官网：<a target="_blank" rel="noopener" href="http://projects.spring.io/spring-data-redis/">http://projects.spring.io/spring-data-redis/</a></p>
<p> <img src="1527250056698.png" alt="1527250056698">                                    </p>
<p>Spring Data Redis，是Spring Data 家族的一部分。 对Jedis客户端进行了封装，与spring进行了整合。可以非常方便的来实现redis的配置和操作。 </p>
<h3 id="5-2-3-RedisTemplate基本操作"><a href="#5-2-3-RedisTemplate基本操作" class="headerlink" title="5.2.3.RedisTemplate基本操作"></a>5.2.3.RedisTemplate基本操作</h3><p>Spring Data Redis 提供了一个工具类：RedisTemplate。里面封装了对于Redis的五种数据结构的各种操作，包括：</p>
<ul>
<li>redisTemplate.opsForValue() ：操作字符串 </li>
<li>redisTemplate.opsForHash() ：操作hash</li>
<li>redisTemplate.opsForList()：操作list</li>
<li>redisTemplate.opsForSet()：操作set</li>
<li>redisTemplate.opsForZSet()：操作zset</li>
</ul>
<p>其它一些通用命令，如expire，可以通过redisTemplate.xx()来直接调用</p>
<p>5种结构：</p>
<ul>
<li>String：等同于java中的，<code>Map&lt;String,String&gt;</code></li>
<li>list：等同于java中的<code>Map&lt;String,List&lt;String&gt;&gt;</code></li>
<li>set：等同于java中的<code>Map&lt;String,Set&lt;String&gt;&gt;</code></li>
<li>sort_set：可排序的set</li>
<li>hash：等同于java中的：`Map&lt;String,Map&lt;String,String&gt;&gt;</li>
</ul>
<h3 id="5-2-4-StringRedisTemplate"><a href="#5-2-4-StringRedisTemplate" class="headerlink" title="5.2.4.StringRedisTemplate"></a>5.2.4.StringRedisTemplate</h3><p>RedisTemplate在创建时，可以指定其泛型类型：</p>
<ul>
<li>K：代表key 的数据类型</li>
<li>V: 代表value的数据类型</li>
</ul>
<p>注意：这里的类型不是Redis中存储的数据类型，而是Java中的数据类型，RedisTemplate会自动将Java类型转为Redis支持的数据类型：字符串、字节、二进制等等。</p>
<p><img src="1527250218215.png" alt="1527250218215"></p>
<p>不过RedisTemplate默认会采用JDK自带的序列化（Serialize）来对对象进行转换。生成的数据十分庞大，因此一般我们都会指定key和value为String类型，这样就由我们自己把对象序列化为json字符串来存储即可。</p>
<p>因为大部分情况下，我们都会使用key和value都为String的RedisTemplate，因此Spring就默认提供了这样一个实现： <img src="1527256139407.png" alt="1527256139407"></p>
<h3 id="5-2-5-测试"><a href="#5-2-5-测试" class="headerlink" title="5.2.5.测试"></a>5.2.5.测试</h3><p>我们在项目中编写一个测试案例，把课前资料中的redisTest.java导入到项目中</p>
<p><img src="1533013812311.png" alt="1533013812311"></p>
<p> <img src="1533013709197.png" alt="1533013709197"></p>
<p>需要在项目中引入Redis启动器：</p>
<pre><code class="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
<p>然后在配置文件中指定Redis地址：</p>
<pre><code class="yaml">spring:
  redis:
    host: 192.168.56.101
</code></pre>
<h2 id="5-3-在项目中实现"><a href="#5-3-在项目中实现" class="headerlink" title="5.3.在项目中实现"></a>5.3.在项目中实现</h2><p>需要三个步骤：</p>
<ul>
<li>生成随机验证码</li>
<li>将验证码保存到Redis中，用来在注册的时候验证</li>
<li>发送验证码到<code>leyou-sms-service</code>服务，发送短信</li>
</ul>
<p>因此，我们需要引入Redis和AMQP：</p>
<pre><code class="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
<p>添加RabbitMQ和Redis配置：</p>
<pre><code class="yaml">spring:
  redis:
    host: 192.168.56.101
  rabbitmq:
    host: 192.168.56.101
    username: leyou
    password: leyou
    virtual-host: /leyou
</code></pre>
<p>另外还要用到工具类，生成6位随机码，这个我们封装到了<code>leyou-common</code>中，因此需要引入依赖：</p>
<pre><code class="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.leyou.common&lt;/groupId&gt;
    &lt;artifactId&gt;leyou-common&lt;/artifactId&gt;
    &lt;version&gt;$&#123;leyou.latest.version&#125;&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p>NumberUtils中有生成随机码的工具方法：</p>
<pre><code class="java">/**
 * 生成指定位数的随机数字
 * @param len 随机数的位数
 * @return 生成的随机数
 */
public static String generateCode(int len)&#123;
    len = Math.min(len, 8);
    int min = Double.valueOf(Math.pow(10, len - 1)).intValue();
    int num = new Random().nextInt(
        Double.valueOf(Math.pow(10, len + 1)).intValue() - 1) + min;
    return String.valueOf(num).substring(0,len);
&#125;
</code></pre>
<h3 id="5-3-1-UserController"><a href="#5-3-1-UserController" class="headerlink" title="5.3.1.UserController"></a>5.3.1.UserController</h3><p>在leyou-user-service工程中的UserController添加方法：</p>
<pre><code class="java">/**
 * 发送手机验证码
 * @param phone
 * @return
 */
@PostMapping(&quot;code&quot;)
public ResponseEntity&lt;Void&gt; sendVerifyCode(String phone) &#123;
    Boolean boo = this.userService.sendVerifyCode(phone);
    if (boo == null || !boo) &#123;
        return new ResponseEntity&lt;&gt;(HttpStatus.INTERNAL_SERVER_ERROR);
    &#125;
    return new ResponseEntity&lt;&gt;(HttpStatus.CREATED);
&#125;
</code></pre>
<h3 id="5-3-2-UserService"><a href="#5-3-2-UserService" class="headerlink" title="5.3.2.UserService"></a>5.3.2.UserService</h3><p>在Service中添加代码：</p>
<pre><code class="java">@Autowired
private StringRedisTemplate redisTemplate;

@Autowired
private AmqpTemplate amqpTemplate;

static final String KEY_PREFIX = &quot;user:code:phone:&quot;;

static final Logger logger = LoggerFactory.getLogger(UserService.class);

public Boolean sendVerifyCode(String phone) &#123;
    // 生成验证码
    String code = NumberUtils.generateCode(6);
    try &#123;
        // 发送短信
        Map&lt;String, String&gt; msg = new HashMap&lt;&gt;();
        msg.put(&quot;phone&quot;, phone);
        msg.put(&quot;code&quot;, code);
        this.amqpTemplate.convertAndSend(&quot;leyou.sms.exchange&quot;, &quot;sms.verify.code&quot;, msg);
        // 将code存入redis
        this.redisTemplate.opsForValue().set(KEY_PREFIX + phone, code, 5, TimeUnit.MINUTES);
        return true;
    &#125; catch (Exception e) &#123;
        logger.error(&quot;发送短信失败。phone：&#123;&#125;， code：&#123;&#125;&quot;, phone, code);
        return false;
    &#125;
&#125;
</code></pre>
<p>注意：要设置短信验证码在Redis的缓存时间为5分钟</p>
<h3 id="5-3-3-测试"><a href="#5-3-3-测试" class="headerlink" title="5.3.3.测试"></a>5.3.3.测试</h3><p>通过RestClient发送请求试试：</p>
<p><img src="1533020768508.png" alt="1533020768508"></p>
<p>查看Redis中的数据：</p>
<p><img src="1533017923560.png" alt="1533017923560"></p>
<p>查看短信：</p>
<p> <img src="1533018062186.png" alt="1533018062186"></p>
<h1 id="6-注册功能"><a href="#6-注册功能" class="headerlink" title="6.注册功能"></a>6.注册功能</h1><h2 id="6-1-接口说明"><a href="#6-1-接口说明" class="headerlink" title="6.1.接口说明"></a>6.1.接口说明</h2><p> <img src="1527240855176.png" alt="1527240855176"></p>
<p>基本逻辑：</p>
<ul>
<li>1）校验短信验证码</li>
<li>2）生成盐</li>
<li>3）对密码加密</li>
<li>4）写入数据库</li>
<li>5）删除Redis中的验证码</li>
</ul>
<h2 id="6-2-UserController"><a href="#6-2-UserController" class="headerlink" title="6.2.UserController"></a>6.2.UserController</h2><pre><code class="java">/**
 * 注册
 * @param user
 * @param code
 * @return
 */
@PostMapping(&quot;register&quot;)
public ResponseEntity&lt;Void&gt; register(User user, @RequestParam(&quot;code&quot;) String code) &#123;
    Boolean boo = this.userService.register(user, code);
    if (boo == null || !boo) &#123;
        return ResponseEntity.status(HttpStatus.BAD_REQUEST).build();
    &#125;
    return new ResponseEntity&lt;&gt;(HttpStatus.CREATED);
&#125;
</code></pre>
<h2 id="6-3-UserService"><a href="#6-3-UserService" class="headerlink" title="6.3.UserService"></a>6.3.UserService</h2><pre><code class="java">public Boolean register(User user, String code) &#123;
    // 校验短信验证码
    String cacheCode = this.redisTemplate.opsForValue().get(KEY_PREFIX + user.getPhone());
    if (!StringUtils.equals(code, cacheCode)) &#123;
        return false;
    &#125;

    // 生成盐
    String salt = CodecUtils.generateSalt();
    user.setSalt(salt);

    // 对密码加密
    user.setPassword(CodecUtils.md5Hex(user.getPassword(), salt));

    // 强制设置不能指定的参数为null
    user.setId(null);
    user.setCreated(new Date());
    // 添加到数据库
    boolean b = this.userMapper.insertSelective(user) == 1;

    if(b)&#123;
        // 注册成功，删除redis中的记录
        this.redisTemplate.delete(KEY_PREFIX + user.getPhone());
    &#125;
    return b;
&#125;
</code></pre>
<p>此处使用了课前资料中的CodeUtils：</p>
<p><img src="1533023141026.png" alt="1533023141026"></p>
<p>该工具类需要apache加密工具包：</p>
<pre><code class="xml">&lt;dependency&gt;
    &lt;groupId&gt;commons-codec&lt;/groupId&gt;
    &lt;artifactId&gt;commons-codec&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
<h2 id="6-4-测试"><a href="#6-4-测试" class="headerlink" title="6.4.测试"></a>6.4.测试</h2><p>我们通过RestClient测试：</p>
<p><img src="1533024221725.png" alt="1533024221725"></p>
<p>查看数据库：</p>
<p><img src="1533024241233.png" alt="1533024241233"></p>
<p>查看redis中的信息也被删除</p>
<h2 id="6-5-hibernate-validate"><a href="#6-5-hibernate-validate" class="headerlink" title="6.5.hibernate-validate"></a>6.5.hibernate-validate</h2><p>刚才虽然实现了注册，但是服务端并没有进行数据校验，而前端的校验是很容易被有心人绕过的。所以我们必须在后台添加数据校验功能：</p>
<p>我们这里会使用Hibernate-Validator框架完成数据校验：</p>
<p>而SpringBoot的web启动器中已经集成了相关依赖：</p>
<p> <img src="1527244265451.png" alt="1527244265451"></p>
<h3 id="6-5-1-什么是Hibernate-Validator"><a href="#6-5-1-什么是Hibernate-Validator" class="headerlink" title="6.5.1.什么是Hibernate Validator"></a>6.5.1.什么是Hibernate Validator</h3><p>Hibernate Validator是Hibernate提供的一个开源框架，使用注解方式非常方便的实现服务端的数据校验。</p>
<p>官网：<a target="_blank" rel="noopener" href="http://hibernate.org/validator/">http://hibernate.org/validator/</a></p>
<p><img src="1527244393041.png" alt="1527244393041"></p>
<p><strong>hibernate Validator</strong> 是 Bean Validation 的参考实现 。</p>
<p>Hibernate Validator 提供了 JSR 303 规范中所有内置 constraint（约束） 的实现，除此之外还有一些附加的 constraint。</p>
<p>在日常开发中，Hibernate Validator经常用来验证bean的字段，基于注解，方便快捷高效。</p>
<h3 id="6-5-2-Bean校验的注解"><a href="#6-5-2-Bean校验的注解" class="headerlink" title="6.5.2.Bean校验的注解"></a>6.5.2.Bean校验的注解</h3><p>常用注解如下：</p>
<table>
<thead>
<tr>
<th><strong>Constraint</strong></th>
<th><strong>详细信息</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>@Valid</strong></td>
<td>被注释的元素是一个对象，需要检查此对象的所有字段值</td>
</tr>
<tr>
<td><strong>@Null</strong></td>
<td>被注释的元素必须为 null</td>
</tr>
<tr>
<td><strong>@NotNull</strong></td>
<td>被注释的元素必须不为 null</td>
</tr>
<tr>
<td><strong>@AssertTrue</strong></td>
<td>被注释的元素必须为 true</td>
</tr>
<tr>
<td><strong>@AssertFalse</strong></td>
<td>被注释的元素必须为 false</td>
</tr>
<tr>
<td><strong>@Min(value)</strong></td>
<td>被注释的元素必须是一个数字，其值必须大于等于指定的最小值</td>
</tr>
<tr>
<td><strong>@Max(value)</strong></td>
<td>被注释的元素必须是一个数字，其值必须小于等于指定的最大值</td>
</tr>
<tr>
<td><strong>@DecimalMin(value)</strong></td>
<td>被注释的元素必须是一个数字，其值必须大于等于指定的最小值</td>
</tr>
<tr>
<td><strong>@DecimalMax(value)</strong></td>
<td>被注释的元素必须是一个数字，其值必须小于等于指定的最大值</td>
</tr>
<tr>
<td><strong>@Size(max,   min)</strong></td>
<td>被注释的元素的大小必须在指定的范围内</td>
</tr>
<tr>
<td><strong>@Digits   (integer, fraction)</strong></td>
<td>被注释的元素必须是一个数字，其值必须在可接受的范围内</td>
</tr>
<tr>
<td><strong>@Past</strong></td>
<td>被注释的元素必须是一个过去的日期</td>
</tr>
<tr>
<td><strong>@Future</strong></td>
<td>被注释的元素必须是一个将来的日期</td>
</tr>
<tr>
<td><strong>@Pattern(value)</strong></td>
<td>被注释的元素必须符合指定的正则表达式</td>
</tr>
<tr>
<td><strong>@Email</strong></td>
<td>被注释的元素必须是电子邮箱地址</td>
</tr>
<tr>
<td><strong>@Length</strong></td>
<td>被注释的字符串的大小必须在指定的范围内</td>
</tr>
<tr>
<td><strong>@NotEmpty</strong></td>
<td>被注释的字符串的必须非空</td>
</tr>
<tr>
<td><strong>@Range</strong></td>
<td>被注释的元素必须在合适的范围内</td>
</tr>
<tr>
<td><strong>@NotBlank</strong></td>
<td>被注释的字符串的必须非空</td>
</tr>
<tr>
<td><strong>@URL(protocol=,host=,   port=,regexp=, flags=)</strong></td>
<td>被注释的字符串必须是一个有效的url</td>
</tr>
<tr>
<td><strong>@CreditCardNumber</strong></td>
<td>被注释的字符串必须通过Luhn校验算法，银行卡，信用卡等号码一般都用Luhn计算合法性</td>
</tr>
</tbody></table>
<h3 id="6-5-3-给User添加校验"><a href="#6-5-3-给User添加校验" class="headerlink" title="6.5.3.给User添加校验"></a>6.5.3.给User添加校验</h3><p>我们在<code>leyou-user-interface</code>中添加Hibernate-Validator依赖：</p>
<pre><code class="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.hibernate.validator&lt;/groupId&gt;
    &lt;artifactId&gt;hibernate-validator&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
<p>我们在User对象的部分属性上添加注解：</p>
<pre><code class="java">@Table(name = &quot;tb_user&quot;)
public class User &#123;
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    @Length(min = 4, max = 30, message = &quot;用户名只能在4~30位之间&quot;)
    private String username;// 用户名

    @JsonIgnore
    @Length(min = 4, max = 30, message = &quot;密码只能在4~30位之间&quot;)
    private String password;// 密码

    @Pattern(regexp = &quot;^1[35678]\\d&#123;9&#125;$&quot;, message = &quot;手机号格式不正确&quot;)
    private String phone;// 电话

    private Date created;// 创建时间

    @JsonIgnore
    private String salt;// 密码的盐值
&#125;
</code></pre>
<h3 id="6-5-4-在controller上进行控制"><a href="#6-5-4-在controller上进行控制" class="headerlink" title="6.5.4.在controller上进行控制"></a>6.5.4.在controller上进行控制</h3><p>在controller中改造register方法，只需要给User添加 @Valid注解即可。</p>
<p><img src="1533030001081.png" alt="1533030001081"></p>
<h3 id="6-5-5-测试"><a href="#6-5-5-测试" class="headerlink" title="6.5.5.测试"></a>6.5.5.测试</h3><p>我们故意填错：</p>
<p><img src="1533029312208.png" alt="1533029312208"></p>
<p>然后SpringMVC会自动返回错误信息：</p>
<p><img src="1533029343713.png" alt="1533029343713"></p>
<h1 id="7-根据用户名和密码查询用户"><a href="#7-根据用户名和密码查询用户" class="headerlink" title="7.根据用户名和密码查询用户"></a>7.根据用户名和密码查询用户</h1><p><strong>功能说明</strong></p>
<p>查询功能，根据参数中的用户名和密码查询指定用户</p>
<p><strong>接口路径</strong></p>
<pre><code>GET /query
</code></pre>
<p><strong>参数说明</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>是否必须</th>
<th>数据类型</th>
<th>默认值</th>
</tr>
</thead>
<tbody><tr>
<td>username</td>
<td>用户名，格式为4~30位字母、数字、下划线</td>
<td>是</td>
<td>String</td>
<td>无</td>
</tr>
<tr>
<td>password</td>
<td>用户密码，格式为4~30位字母、数字、下划线</td>
<td>是</td>
<td>String</td>
<td>无</td>
</tr>
</tbody></table>
<p><strong>返回结果</strong></p>
<p>用户的json格式数据</p>
<pre><code class="json">&#123;
    &quot;id&quot;: 6572312,
    &quot;username&quot;:&quot;test&quot;,
    &quot;phone&quot;:&quot;13688886666&quot;,
    &quot;created&quot;: 1342432424
&#125;
</code></pre>
<p><strong>状态码</strong></p>
<ul>
<li>200：注册成功</li>
<li>400：用户名或密码错误</li>
<li>500：服务器内部异常，注册失败</li>
</ul>
<h2 id="7-1-controller"><a href="#7-1-controller" class="headerlink" title="7.1.controller"></a>7.1.controller</h2><pre><code class="java">/**
 * 根据用户名和密码查询用户
 * @param username
 * @param password
 * @return
 */
@GetMapping(&quot;query&quot;)
public ResponseEntity&lt;User&gt; queryUser(
    @RequestParam(&quot;username&quot;) String username,
    @RequestParam(&quot;password&quot;) String password
    ) &#123;
        User user = this.userService.queryUser(username, password);
        if (user == null) &#123;
            return ResponseEntity.status(HttpStatus.BAD_REQUEST).build();
        &#125;
        return ResponseEntity.ok(user);
    &#125;
</code></pre>
<h2 id="7-2-service"><a href="#7-2-service" class="headerlink" title="7.2.service"></a>7.2.service</h2><pre><code class="java">public User queryUser(String username, String password) &#123;
    // 查询
    User record = new User();
    record.setUsername(username);
    User user = this.userMapper.selectOne(record);
    // 校验用户名
    if (user == null) &#123;
        return null;
    &#125;
    // 校验密码
    if (!user.getPassword().equals(CodecUtils.md5Hex(password, user.getSalt()))) &#123;
        return null;
    &#125;
    // 用户名密码都正确
    return user;
&#125;
</code></pre>
<p>要注意，查询时也要对密码进行加密后判断是否一致。</p>
<h2 id="7-3-测试"><a href="#7-3-测试" class="headerlink" title="7.3.测试"></a>7.3.测试</h2><p><img src="1533030961886.png" alt="1533030961886"></p>
<h1 id="8-在注册页进行测试"><a href="#8-在注册页进行测试" class="headerlink" title="8.在注册页进行测试"></a>8.在注册页进行测试</h1><p>在注册页填写信息：</p>
<p><img src="1533031066018.png" alt="1533031066018"></p>
<p>提交发现页面自动跳转到了登录页，查看数据库：</p>
<p><img src="1533031705871.png" alt="1533031705871"></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/dayu/" rel="tag"># dayu</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/06/02/leyou%E9%97%A8%E6%88%B7-4-rabbitMQ%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/" rel="prev" title="leyou门户#4-rabbitMQ数据同步">
      <i class="fa fa-chevron-left"></i> leyou门户#4-rabbitMQ数据同步
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/06/04/leyou%E9%97%A8%E6%88%B7-6-JWT%E6%8E%88%E6%9D%83%E4%B8%AD%E5%BF%83/" rel="next" title="leyou门户#6-JWT授权中心">
      leyou门户#6-JWT授权中心 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E4%B8%AD%E5%BF%83"><span class="nav-text">1.创建用户中心</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-%E5%88%9B%E5%BB%BA%E7%88%B6module"><span class="nav-text">1.1.创建父module</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-%E5%88%9B%E5%BB%BAleyou-user-interface"><span class="nav-text">1.2.创建leyou-user-interface</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-%E5%88%9B%E5%BB%BAleyou-user-service"><span class="nav-text">1.3.创建leyou-user-service</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-4-%E6%B7%BB%E5%8A%A0%E7%BD%91%E5%85%B3%E8%B7%AF%E7%94%B1"><span class="nav-text">1.4.添加网关路由</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-%E5%90%8E%E5%8F%B0%E5%8A%9F%E8%83%BD%E5%87%86%E5%A4%87"><span class="nav-text">2.后台功能准备</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3"><span class="nav-text">2.1.接口文档</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="nav-text">2.2.数据结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3-%E5%9F%BA%E6%9C%AC%E4%BB%A3%E7%A0%81"><span class="nav-text">2.3.基本代码</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-1-%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="nav-text">2.3.1.实体类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-2-mapper"><span class="nav-text">2.3.2.mapper</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-3-Service"><span class="nav-text">2.3.3.Service</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-4-controller"><span class="nav-text">2.3.4.controller</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-%E6%95%B0%E6%8D%AE%E9%AA%8C%E8%AF%81%E5%8A%9F%E8%83%BD"><span class="nav-text">3.数据验证功能</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-%E6%8E%A5%E5%8F%A3%E8%AF%B4%E6%98%8E"><span class="nav-text">3.1.接口说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-controller"><span class="nav-text">3.2.controller</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-Service"><span class="nav-text">3.3.Service</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-4-%E6%B5%8B%E8%AF%95"><span class="nav-text">3.4.测试</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-%E9%98%BF%E9%87%8C%E5%A4%A7%E4%BA%8E%E7%9F%AD%E4%BF%A1%E6%9C%8D%E5%8A%A1"><span class="nav-text">4.阿里大于短信服务</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-demo"><span class="nav-text">4.1.demo</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-%E5%88%9B%E5%BB%BA%E7%9F%AD%E4%BF%A1%E5%BE%AE%E6%9C%8D%E5%8A%A1"><span class="nav-text">4.2.创建短信微服务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-1-%E5%88%9B%E5%BB%BAmodule"><span class="nav-text">4.2.1.创建module</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-2-pom"><span class="nav-text">4.2.2.pom</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-3-%E7%BC%96%E5%86%99%E5%90%AF%E5%8A%A8%E7%B1%BB"><span class="nav-text">4.2.3.编写启动类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-4-%E7%BC%96%E5%86%99application-yml"><span class="nav-text">4.2.4.编写application.yml</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-3-%E7%BC%96%E5%86%99%E7%9F%AD%E4%BF%A1%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="nav-text">4.3.编写短信工具类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-1-%E5%B1%9E%E6%80%A7%E6%8A%BD%E5%8F%96"><span class="nav-text">4.3.1.属性抽取</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-2-%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="nav-text">4.3.2.工具类</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-4-%E7%BC%96%E5%86%99%E6%B6%88%E6%81%AF%E7%9B%91%E5%90%AC%E5%99%A8"><span class="nav-text">4.4.编写消息监听器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-5-%E5%90%AF%E5%8A%A8"><span class="nav-text">4.5.启动</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-%E5%8F%91%E9%80%81%E7%9F%AD%E4%BF%A1%E5%8A%9F%E8%83%BD"><span class="nav-text">5.发送短信功能</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#5-1-%E6%8E%A5%E5%8F%A3%E8%AF%B4%E6%98%8E"><span class="nav-text">5.1.接口说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-2-Redis"><span class="nav-text">5.2.Redis</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-1-%E5%AE%89%E8%A3%85"><span class="nav-text">5.2.1.安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-2-Spring-Data-Redis"><span class="nav-text">5.2.2.Spring Data Redis</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-3-RedisTemplate%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="nav-text">5.2.3.RedisTemplate基本操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-4-StringRedisTemplate"><span class="nav-text">5.2.4.StringRedisTemplate</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-5-%E6%B5%8B%E8%AF%95"><span class="nav-text">5.2.5.测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-3-%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%AE%9E%E7%8E%B0"><span class="nav-text">5.3.在项目中实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-1-UserController"><span class="nav-text">5.3.1.UserController</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-2-UserService"><span class="nav-text">5.3.2.UserService</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-3-%E6%B5%8B%E8%AF%95"><span class="nav-text">5.3.3.测试</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-%E6%B3%A8%E5%86%8C%E5%8A%9F%E8%83%BD"><span class="nav-text">6.注册功能</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#6-1-%E6%8E%A5%E5%8F%A3%E8%AF%B4%E6%98%8E"><span class="nav-text">6.1.接口说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-2-UserController"><span class="nav-text">6.2.UserController</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-3-UserService"><span class="nav-text">6.3.UserService</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-4-%E6%B5%8B%E8%AF%95"><span class="nav-text">6.4.测试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-5-hibernate-validate"><span class="nav-text">6.5.hibernate-validate</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-5-1-%E4%BB%80%E4%B9%88%E6%98%AFHibernate-Validator"><span class="nav-text">6.5.1.什么是Hibernate Validator</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-5-2-Bean%E6%A0%A1%E9%AA%8C%E7%9A%84%E6%B3%A8%E8%A7%A3"><span class="nav-text">6.5.2.Bean校验的注解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-5-3-%E7%BB%99User%E6%B7%BB%E5%8A%A0%E6%A0%A1%E9%AA%8C"><span class="nav-text">6.5.3.给User添加校验</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-5-4-%E5%9C%A8controller%E4%B8%8A%E8%BF%9B%E8%A1%8C%E6%8E%A7%E5%88%B6"><span class="nav-text">6.5.4.在controller上进行控制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-5-5-%E6%B5%8B%E8%AF%95"><span class="nav-text">6.5.5.测试</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#7-%E6%A0%B9%E6%8D%AE%E7%94%A8%E6%88%B7%E5%90%8D%E5%92%8C%E5%AF%86%E7%A0%81%E6%9F%A5%E8%AF%A2%E7%94%A8%E6%88%B7"><span class="nav-text">7.根据用户名和密码查询用户</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#7-1-controller"><span class="nav-text">7.1.controller</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-2-service"><span class="nav-text">7.2.service</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-3-%E6%B5%8B%E8%AF%95"><span class="nav-text">7.3.测试</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#8-%E5%9C%A8%E6%B3%A8%E5%86%8C%E9%A1%B5%E8%BF%9B%E8%A1%8C%E6%B5%8B%E8%AF%95"><span class="nav-text">8.在注册页进行测试</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="摘星"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">摘星</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">241</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">24</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">139</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/zhangkexuan" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zhangkexuan" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/kexuan_zhang@qq.com" title="E-Mail → kexuan_zhang@qq.com"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2019 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">摘星</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>

<!-- ҳ����С���� -->
<script type="text/javascript" src="/js/clicklove.js"></script>
