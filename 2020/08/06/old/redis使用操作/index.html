<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="之前已经介绍过redis，本文细致的讲解一下redis实战，如何使用redis。">
<meta property="og:type" content="article">
<meta property="og:title" content="redis使用操作">
<meta property="og:url" content="http://yoursite.com/2020/08/06/old/redis%E4%BD%BF%E7%94%A8%E6%93%8D%E4%BD%9C/index.html">
<meta property="og:site_name" content="摘星">
<meta property="og:description" content="之前已经介绍过redis，本文细致的讲解一下redis实战，如何使用redis。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://yoursite.com/2020/08/06/old/redis%E4%BD%BF%E7%94%A8%E6%93%8D%E4%BD%9C/image-20200906232200972.png">
<meta property="article:published_time" content="2020-08-06T01:34:33.000Z">
<meta property="article:modified_time" content="2020-08-06T01:34:33.000Z">
<meta property="article:author" content="摘星">
<meta property="article:tag" content="redis">
<meta property="article:tag" content="中间件">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/2020/08/06/old/redis%E4%BD%BF%E7%94%A8%E6%93%8D%E4%BD%9C/image-20200906232200972.png">

<link rel="canonical" href="http://yoursite.com/2020/08/06/old/redis%E4%BD%BF%E7%94%A8%E6%93%8D%E4%BD%9C/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>redis使用操作 | 摘星</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">摘星</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/08/06/old/redis%E4%BD%BF%E7%94%A8%E6%93%8D%E4%BD%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="摘星">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="摘星">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          redis使用操作
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-08-06 09:34:33" itemprop="dateCreated datePublished" datetime="2020-08-06T09:34:33+08:00">2020-08-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/" itemprop="url" rel="index"><span itemprop="name">中间件</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>之前已经介绍过redis，本文细致的讲解一下redis实战，如何使用redis。</p>
<a id="more"></a>


<h1 id="Windows-Redis"><a href="#Windows-Redis" class="headerlink" title="Windows Redis"></a>Windows Redis</h1><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>链接: <a href="https://pan.baidu.com/s/1MJnzX_qRuNXJI09euzkPGA" target="_blank" rel="noopener">https://pan.baidu.com/s/1MJnzX_qRuNXJI09euzkPGA</a> 提取码: 2c6w 复制这段内容后打开百度网盘手机App，操作更方便哦</p>
<p>无脑下一步即可</p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>出现错误：</p>
<p>creating server tcp listening socket 127.0.0.1:6379: bind No error</p>
<p>解决方案：</p>
<ol>
<li>redis-cli.exe</li>
<li>shutdown</li>
<li>exit</li>
<li>redis-server.exe redis.windows.conf</li>
</ol>
<p>启动：redis-server.exe redis.windows.conf</p>
<p>客户端启动：redis-cli.exe  (不修改配置的话默认即可)</p>
<p>redis-cli.exe -h 127.0.0.1 -p 6379 -a password</p>
<h2 id="基本文件说明"><a href="#基本文件说明" class="headerlink" title="基本文件说明"></a>基本文件说明</h2><table>
<thead>
<tr>
<th align="left">可执行文件</th>
<th align="left">作用说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">redis-server</td>
<td align="left">redis服务</td>
</tr>
<tr>
<td align="left">redis-cli</td>
<td align="left">redis命令行工具</td>
</tr>
<tr>
<td align="left">redis-benchmark</td>
<td align="left">基准性能测试工具</td>
</tr>
<tr>
<td align="left">redis-check-aof</td>
<td align="left">AOF持久化文件检测和修复工具</td>
</tr>
<tr>
<td align="left">redis-check-dump</td>
<td align="left">RDB持久化文件检测和修复工具</td>
</tr>
<tr>
<td align="left">redis-sentinel</td>
<td align="left">启动哨兵</td>
</tr>
<tr>
<td align="left">redis-trib</td>
<td align="left">cluster集群构建工具</td>
</tr>
</tbody></table>
<h1 id="基础命令"><a href="#基础命令" class="headerlink" title="基础命令"></a>基础命令</h1><table>
<thead>
<tr>
<th align="left">命令</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">keys  *</td>
<td align="left">redis允许模糊查询key　　有3个通配符  *、?、[]</td>
</tr>
<tr>
<td align="left">del    key</td>
<td align="left">删除key</td>
</tr>
<tr>
<td align="left">exists kxm</td>
<td align="left">判断是否存在</td>
</tr>
<tr>
<td align="left">expire key 20</td>
<td align="left">设置过期时间 - 秒</td>
</tr>
<tr>
<td align="left">pexpire key 20000</td>
<td align="left">设置过期时间 - 毫秒</td>
</tr>
<tr>
<td align="left">move kxm 2</td>
<td align="left">移动key到指定位置库中  2号库</td>
</tr>
<tr>
<td align="left">persist key</td>
<td align="left">移除过期时间，key将会永久存在  成功设置返回1  否则返回0</td>
</tr>
<tr>
<td align="left">pttl key</td>
<td align="left">以毫秒为单位返回 key 的剩余的过期时间</td>
</tr>
<tr>
<td align="left">ttl key</td>
<td align="left">以秒为单位，返回给定 key 的剩余生存时间</td>
</tr>
<tr>
<td align="left">randomkey</td>
<td align="left">从当前数据库中随机返回一个 key</td>
</tr>
<tr>
<td align="left">rename key newkxy</td>
<td align="left">更改key的名字，如果重复了会覆盖</td>
</tr>
<tr>
<td align="left">renamenx kxm key</td>
<td align="left">仅当 newkey 不存在时，将 key 改名为 newkey</td>
</tr>
<tr>
<td align="left">type key</td>
<td align="left">返回 key 所储存的值的类型</td>
</tr>
<tr>
<td align="left">select 0</td>
<td align="left">选择第一个库</td>
</tr>
<tr>
<td align="left">ping</td>
<td align="left">返回PONG 表示连接正常</td>
</tr>
<tr>
<td align="left">quit</td>
<td align="left">关闭当前连接</td>
</tr>
</tbody></table>
<h2 id="字符串命令"><a href="#字符串命令" class="headerlink" title="字符串命令"></a>字符串命令</h2><table>
<thead>
<tr>
<th align="left">命令</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">set key aaa</td>
<td align="left">设置指定 key 的值</td>
</tr>
<tr>
<td align="left">get key</td>
<td align="left">获取指定 key 的值</td>
</tr>
<tr>
<td align="left">getrange key 0 1</td>
<td align="left">返回 key 中字符串值的子字符  包含 0 和 1 包含关系</td>
</tr>
<tr>
<td align="left">getset key aaaaaaaa</td>
<td align="left">将给定 key 的值设为 value ，并返回 key 的旧值(old value)</td>
</tr>
<tr>
<td align="left">mget key kxm</td>
<td align="left">获取所有(一个或多个)给定 key 的值</td>
</tr>
<tr>
<td align="left">setex test 5 “this is my test”</td>
<td align="left">将值 value 关联到 key ，并将 key 的过期时间设为 seconds (以秒为单位)</td>
</tr>
<tr>
<td align="left">setnx test test</td>
<td align="left">只有在 key 不存在时设置 key 的值 （用于分布式锁）</td>
</tr>
<tr>
<td align="left">strlen test</td>
<td align="left">返回 key 所储存的字符串值的长度</td>
</tr>
<tr>
<td align="left">mset key1 “1” key2 “2”</td>
<td align="left">同时设置一个或多个 key-value 对</td>
</tr>
<tr>
<td align="left">msetnx key3 “a” key2 “b”</td>
<td align="left">同时设置一个或多个 key-value 对，当且仅当所有给定 key 都不存在  其中一个失败则全部失败</td>
</tr>
<tr>
<td align="left">incr key</td>
<td align="left">将 key 中储存的数字值增一 -&gt;  key的值 比如为 数字类型字符串  返回增加后的结果</td>
</tr>
<tr>
<td align="left">incrby num 1000</td>
<td align="left">将 key 中储存的数字值增指定的值 -&gt;  key的值 比如为 数字类型字符串  返回增加后的结果</td>
</tr>
<tr>
<td align="left">decr key</td>
<td align="left">同 -&gt; 减一</td>
</tr>
<tr>
<td align="left">decrby num 500</td>
<td align="left">同 -&gt; 减指定值</td>
</tr>
<tr>
<td align="left">append key 1123123</td>
<td align="left">如果 key 已经存在并且是一个字符串， APPEND 命令将指定的 value 追加到该 key 原来值（value）的末尾  返回字符串长度</td>
</tr>
</tbody></table>
<h2 id="哈希-Hash-命令"><a href="#哈希-Hash-命令" class="headerlink" title="哈希(Hash)命令"></a>哈希(Hash)命令</h2><table>
<thead>
<tr>
<th align="left">命令</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">hdel key field1 [field2]</td>
<td align="left">删除一个或多个哈希表字段</td>
</tr>
<tr>
<td align="left">hexistskey field</td>
<td align="left">查看哈希表 key 中，指定的字段是否存在</td>
</tr>
<tr>
<td align="left">hget key field</td>
<td align="left">获取存储在哈希表中指定字段的值</td>
</tr>
<tr>
<td align="left">hgetall key</td>
<td align="left">获取在哈希表中指定 key 的所有字段和值</td>
</tr>
<tr>
<td align="left">hincrby hash yeary 1</td>
<td align="left">为哈希表 key 中的指定字段的整数值加上增量 increment</td>
</tr>
<tr>
<td align="left">hkeys hash</td>
<td align="left">获取所有哈希表中的字段</td>
</tr>
<tr>
<td align="left">hlen hash</td>
<td align="left">获取哈希表中字段的数量</td>
</tr>
<tr>
<td align="left">hmget hash name year</td>
<td align="left">获取所有给定字段的值</td>
</tr>
<tr>
<td align="left">hmset hash name “i am kxm” year 24</td>
<td align="left">同时将多个 field-value (域-值)对设置到哈希表 key 中</td>
</tr>
<tr>
<td align="left">hset hash name kxm</td>
<td align="left">将哈希表 key 中的字段 field 的值设为 value</td>
</tr>
<tr>
<td align="left">hsetnx key field value</td>
<td align="left">只有在字段 field 不存在时，设置哈希表字段的值</td>
</tr>
<tr>
<td align="left">hvals hash</td>
<td align="left">获取哈希表中所有值</td>
</tr>
<tr>
<td align="left">hexists hash name</td>
<td align="left">是否存在</td>
</tr>
</tbody></table>
<blockquote>
<p>编码:  field value 值由 ziplist 及 hashtable 两种编码格式</p>
<p>字段较少的时候采用ziplist，字段较多的时候会变成hashtable编码</p>
</blockquote>
<h2 id="列表-List-命令"><a href="#列表-List-命令" class="headerlink" title="列表(List)命令"></a>列表(List)命令</h2><p>Redis列表是简单的字符串列表，按照插入顺序排序。你可以添加一个元素到列表的头部（左边）或者尾部（右边）</p>
<p>一个列表最多可以包含 232 - 1 个元素 (4294967295, 每个列表超过40亿个元素)</p>
<p>容量 -&gt; 集合,有序集合也是如此</p>
<table>
<thead>
<tr>
<th align="left">命令</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">lpush list php</td>
<td align="left">将一个值插入到列表头部  返回列表长度</td>
</tr>
<tr>
<td align="left">lindex list 0</td>
<td align="left">通过索引获取列表中的元素</td>
</tr>
<tr>
<td align="left">blpop  key1 [key2 ] timeout</td>
<td align="left">移出并获取列表的第一个元素， 如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止</td>
</tr>
<tr>
<td align="left">brpop  key1 [key2 ] timeout</td>
<td align="left">移出并获取列表的最后一个元素， 如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止</td>
</tr>
<tr>
<td align="left">linsert list before 3 4</td>
<td align="left">在值 3 前插入 4  前即为顶</td>
</tr>
<tr>
<td align="left">linsert list after 4 5</td>
<td align="left">在值4 后插入5</td>
</tr>
<tr>
<td align="left">llen list</td>
<td align="left">获取列表长度</td>
</tr>
<tr>
<td align="left">lpop list</td>
<td align="left">移出并获取列表的第一个元素</td>
</tr>
<tr>
<td align="left">lpush list c++ c</td>
<td align="left">将一个或多个值插入到列表头部</td>
</tr>
<tr>
<td align="left">lrange list 0 1</td>
<td align="left">获取列表指定范围内的元素  包含0和1  -1 代表所有 （lrange list 0 -1）</td>
</tr>
<tr>
<td align="left">lrem list 1 c</td>
<td align="left">移除list 集合中 值为 c 的  一个元素，  1 代表count 即移除几个</td>
</tr>
<tr>
<td align="left">lset list 0 “this is update”</td>
<td align="left">通过索引设置列表元素的值</td>
</tr>
<tr>
<td align="left">ltrim list 1 5</td>
<td align="left">对一个列表进行修剪(trim)，就是说，让列表只保留指定区间内的元素，不在指定区间之内的元素都将被删除</td>
</tr>
<tr>
<td align="left">rpop list</td>
<td align="left">移除列表的最后一个元素，返回值为移除的元素</td>
</tr>
<tr>
<td align="left">rpush list newvalue3</td>
<td align="left">从底部添加新值</td>
</tr>
<tr>
<td align="left">rpoplpush list list2</td>
<td align="left">转移列表的数据</td>
</tr>
</tbody></table>
<h2 id="集合-Set-命令"><a href="#集合-Set-命令" class="headerlink" title="集合(Set)命令"></a>集合(Set)命令</h2><p>Set 是 String 类型的无序集合。集合成员是唯一的，这就意味着集合中不能出现重复的数据</p>
<table>
<thead>
<tr>
<th align="left">命令</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">sadd set java php c c++ python</td>
<td align="left">向集合添加一个或多个成员</td>
</tr>
<tr>
<td align="left">scard set</td>
<td align="left">获取集合的成员数</td>
</tr>
<tr>
<td align="left">sdiff key1 [key2]</td>
<td align="left">返回给定所有集合的差集  数学含义差集</td>
</tr>
<tr>
<td align="left">sdiffstore curr set newset  （sdiffstore destination key1 [key2]）</td>
<td align="left">把set和 newset的差值存储到curr中</td>
</tr>
<tr>
<td align="left">sinter set newset</td>
<td align="left">返回给定所有集合的交集</td>
</tr>
<tr>
<td align="left">sinterstore curr set newset  （sinterstoredestination key1 [key2]）</td>
<td align="left">同</td>
</tr>
<tr>
<td align="left">sismember set c#</td>
<td align="left">判断 member 元素是否是集合 key 的成员</td>
</tr>
<tr>
<td align="left">smembers set</td>
<td align="left">返回集合中的所有成员</td>
</tr>
<tr>
<td align="left">srandmember set 2</td>
<td align="left">随机抽取两个key (抽奖实现美滋滋)</td>
</tr>
<tr>
<td align="left">smove set newtest java （smove source destination member）</td>
<td align="left">将 member 元素从 source 集合移动到 destination 集合</td>
</tr>
<tr>
<td align="left">sunion set newset</td>
<td align="left">返回所有给定集合的并集</td>
</tr>
<tr>
<td align="left">srem set java</td>
<td align="left">删除</td>
</tr>
<tr>
<td align="left">spop set</td>
<td align="left">从集合中弹出一个元素</td>
</tr>
<tr>
<td align="left">sdiff | sinter | sunion</td>
<td align="left">操作：集合间运算：差集</td>
</tr>
</tbody></table>
<h2 id="有序集合-sorted-set-命令"><a href="#有序集合-sorted-set-命令" class="headerlink" title="有序集合(sorted set)命令"></a>有序集合(sorted set)命令</h2><p>Redis 有序集合和集合一样也是string类型元素的集合,且不允许重复的成员。</p>
<p>不同的是每个元素都会关联一个double类型的分数。redis正是通过分数来为集合中的成员进行从小到大的排序。</p>
<p>有序集合的成员是唯一的,但分数(score)却可以重复。</p>
<table>
<thead>
<tr>
<th align="left">命令</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">zadd sort 1 java 2 python</td>
<td align="left">向有序集合添加一个或多个成员，或者更新已存在成员的分数</td>
</tr>
<tr>
<td align="left">zcard sort</td>
<td align="left">获取有序集合的成员数</td>
</tr>
<tr>
<td align="left">zcount sort 0 1</td>
<td align="left">计算在有序集合中指定区间分数的成员数</td>
</tr>
<tr>
<td align="left">zincrby sort 500 java</td>
<td align="left">有序集合中对指定成员的分数加上增量 increment</td>
</tr>
<tr>
<td align="left">zscore sort java</td>
<td align="left">返回有序集中，成员的分数值</td>
</tr>
<tr>
<td align="left">zrange sort 0 -1</td>
<td align="left">获取指定序号的值，-1代表全部</td>
</tr>
<tr>
<td align="left">zrangebyscore sort 0 5</td>
<td align="left">分数符合范围的值</td>
</tr>
<tr>
<td align="left">zrangebyscore sort 0 5 limit 0 1</td>
<td align="left">分页 limit  0代表页码，1代表每页显示数量</td>
</tr>
<tr>
<td align="left">zrem sort java</td>
<td align="left">移除元素</td>
</tr>
<tr>
<td align="left">zremrangebyrank sort 0 1</td>
<td align="left">按照排名范围删除元素</td>
</tr>
<tr>
<td align="left">zremrangebyscore sort 0 1</td>
<td align="left">按照分数范围删除元素</td>
</tr>
<tr>
<td align="left">zrevrank sort c#</td>
<td align="left">返回有序集合中指定成员的排名，有序集成员按分数值递减(从大到小)排序</td>
</tr>
</tbody></table>
<h1 id="发布订阅"><a href="#发布订阅" class="headerlink" title="发布订阅"></a>发布订阅</h1><p>开启两个客户端</p>
<p>A客户端订阅频道：subscribe redisChat                    （频道名字为 redisChat）</p>
<p>B客户端发布内容：publish redisChat “Hello, this is my wor”  （内容是 hello….）</p>
<p>A客户端即为自动收到内容， 原理图如下:</p>
<p><img src="image-20200906232200972.png" alt="img"></p>
<table>
<thead>
<tr>
<th align="left">命令</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">pubsub channels</td>
<td align="left">查看当前redis  有多少个频道</td>
</tr>
<tr>
<td align="left">pubsub numsub chat1</td>
<td align="left">查看某个频道的订阅者数量</td>
</tr>
<tr>
<td align="left">unsubscrible chat1</td>
<td align="left">退订指定频道</td>
</tr>
<tr>
<td align="left">psubscribe java.*</td>
<td align="left">订阅一组频道</td>
</tr>
</tbody></table>
<h1 id="Redis-事务"><a href="#Redis-事务" class="headerlink" title="Redis 事务"></a>Redis 事务</h1><p>Redis 事务可以一次执行多个命令， 并且带有以下三个重要的保证：</p>
<ul>
<li>批量操作在发送 EXEC 命令前被放入队列缓存</li>
<li>收到 EXEC 命令后进入事务执行，事务中任意命令执行失败，其余的命令依然被执行</li>
<li>在事务执行过程，其他客户端提交的命令请求不会插入到事务执行命令序列中</li>
</ul>
<p>一个事务从开始到执行会经历以下三个阶段：</p>
<ul>
<li>开始事务</li>
<li>命令入队</li>
<li>执行事务</li>
</ul>
<pre><code>注意：redis事务和数据库事务不同，redis事务出错后最大的特点是，一剩下的命令会继续执行，二出错的数据不会回滚</code></pre><table>
<thead>
<tr>
<th align="left">命令</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">multi</td>
<td align="left">标记一个事务开始</td>
</tr>
<tr>
<td align="left">exec</td>
<td align="left">执行事务</td>
</tr>
<tr>
<td align="left">discard</td>
<td align="left">事务开始后输入命令入队过程中，中止事务</td>
</tr>
<tr>
<td align="left">watch key</td>
<td align="left">监视一个(或多个) key ，如果在事务执行之前这个(或这些) key 被其他命令所改动，那么事务将被打断</td>
</tr>
<tr>
<td align="left">unwatch</td>
<td align="left">取消 WATCH 命令对所有 key 的监视</td>
</tr>
</tbody></table>
<h1 id="Redis-服务器命令"><a href="#Redis-服务器命令" class="headerlink" title="Redis 服务器命令"></a>Redis 服务器命令</h1><table>
<thead>
<tr>
<th align="left">命令</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">flushall</td>
<td align="left">删除所有数据库的所有key</td>
</tr>
<tr>
<td align="left">flushdb</td>
<td align="left">删除当前数据库的所有key</td>
</tr>
<tr>
<td align="left">save</td>
<td align="left">同步保存数据到硬盘</td>
</tr>
</tbody></table>
<h1 id="Redis-数据备份与恢复"><a href="#Redis-数据备份与恢复" class="headerlink" title="Redis 数据备份与恢复"></a>Redis 数据备份与恢复</h1><p>Redis <strong>SAVE</strong> 命令用于创建当前数据库的备份</p>
<p>如果需要恢复数据，只需将备份文件 (dump.rdb) 移动到 redis 安装目录并启动服务即可。获取 redis 目录可以使用 <strong>CONFIG</strong> 命令</p>
<h1 id="Redis-性能测试"><a href="#Redis-性能测试" class="headerlink" title="Redis 性能测试"></a>Redis 性能测试</h1><p>redis 性能测试的基本命令如下：</p>
<pre><code>redis目录执行：redis-benchmark [option] [option value]

// 会返回各种操作的性能报告（100连接，10000请求）
redis-benchmark -h 127.0.0.1 -p 6379 -c 100 -n 10000

// 100个字节作为value值进行压测
redis-benchmark -h 127.0.0.1 -p 6379 -q -d 100</code></pre><h1 id="Java-Redis"><a href="#Java-Redis" class="headerlink" title="Java Redis"></a>Java Redis</h1><h2 id="Jedis"><a href="#Jedis" class="headerlink" title="Jedis"></a>Jedis</h2><pre class="line-numbers language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!-- jedis --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>redis.clients<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jedis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.8.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>Jedis配置</strong></p>
<pre class="line-numbers language-properties"><code class="language-properties"><span class="token comment" spellcheck="true">############# redis Config #############</span>
<span class="token comment" spellcheck="true"># Redis数据库索引（默认为0）</span>
<span class="token attr-name">spring.redis.database</span><span class="token punctuation">=</span><span class="token attr-value">0</span>
<span class="token comment" spellcheck="true"># Redis服务器地址</span>
<span class="token attr-name">spring.redis.host</span><span class="token punctuation">=</span><span class="token attr-value">120.79.88.17</span>
<span class="token comment" spellcheck="true"># Redis服务器连接端口</span>
<span class="token attr-name">spring.redis.port</span><span class="token punctuation">=</span><span class="token attr-value">6379</span>
<span class="token comment" spellcheck="true"># Redis服务器连接密码（默认为空）</span>
<span class="token attr-name">spring.redis.password</span><span class="token punctuation">=</span><span class="token attr-value">123456</span>
<span class="token comment" spellcheck="true"># 连接池中的最大空闲连接</span>
<span class="token attr-name">spring.redis.jedis.pool.max-idle</span><span class="token punctuation">=</span><span class="token attr-value">8</span>
<span class="token comment" spellcheck="true"># 连接池中的最小空闲连接</span>
<span class="token attr-name">spring.redis.jedis.pool.min-idle</span><span class="token punctuation">=</span><span class="token attr-value">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>JedisConfig</strong></p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JedisConfig</span> <span class="token keyword">extends</span> <span class="token class-name">CachingConfigurerSupport</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis.host}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> String host<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis.port}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> port<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis.password}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> String password<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis.max-idle}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> Integer maxIdle<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis.min-idle}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> Integer minIdle<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> JedisPool <span class="token function">redisPoolFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        JedisPoolConfig jedisPoolConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JedisPoolConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedisPoolConfig<span class="token punctuation">.</span><span class="token function">setMaxIdle</span><span class="token punctuation">(</span>maxIdle<span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedisPoolConfig<span class="token punctuation">.</span><span class="token function">setMinIdle</span><span class="token punctuation">(</span>minIdle<span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedisPoolConfig<span class="token punctuation">.</span><span class="token function">setMaxWaitMillis</span><span class="token punctuation">(</span>3000L<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> timeOut <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span>  <span class="token keyword">new</span> <span class="token class-name">JedisPool</span><span class="token punctuation">(</span>jedisPoolConfig<span class="token punctuation">,</span> host<span class="token punctuation">,</span> port<span class="token punctuation">,</span> timeOut<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>基础使用</strong></p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span>SpringRunner<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootTest</span><span class="token punctuation">(</span>classes <span class="token operator">=</span> KerwinBootsApplication<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationTests</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Resource</span>
    JedisPool jedisPool<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testJedis</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Jedis jedis <span class="token operator">=</span> jedisPool<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"year"</span><span class="token punctuation">,</span> String<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="SpringBoot-redis-staeter-RedisTemplate"><a href="#SpringBoot-redis-staeter-RedisTemplate" class="headerlink" title="SpringBoot redis staeter RedisTemplate"></a>SpringBoot redis staeter RedisTemplate</h2><pre class="line-numbers language-java"><code class="language-java"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> redis <span class="token operator">--</span><span class="token operator">></span>
<span class="token operator">&lt;</span>dependency<span class="token operator">></span>
    <span class="token operator">&lt;</span>groupId<span class="token operator">></span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span>
    <span class="token operator">&lt;</span>artifactId<span class="token operator">></span>spring<span class="token operator">-</span>boot<span class="token operator">-</span>starter<span class="token operator">-</span>data<span class="token operator">-</span>redis<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> redis <span class="token number">2</span><span class="token punctuation">.</span>X 更换为commons<span class="token operator">-</span>pool2 连接池 <span class="token operator">--</span><span class="token operator">></span>
<span class="token operator">&lt;</span>dependency<span class="token operator">></span>
    <span class="token operator">&lt;</span>groupId<span class="token operator">></span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span>
    <span class="token operator">&lt;</span>artifactId<span class="token operator">></span>commons<span class="token operator">-</span>pool2<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span>
############# redis Config #############
# Redis数据库索引（默认为<span class="token number">0</span>）
spring<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>database<span class="token operator">=</span><span class="token number">0</span>
# Redis服务器地址
spring<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>host<span class="token operator">=</span><span class="token number">120.79</span><span class="token punctuation">.</span><span class="token number">88.17</span>
# Redis服务器连接端口
spring<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>port<span class="token operator">=</span><span class="token number">6379</span>
# Redis服务器连接密码（默认为空）
spring<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>password<span class="token operator">=</span><span class="token number">123456</span>
# 连接池最大连接数（使用负值表示没有限制）
spring<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span>pool<span class="token punctuation">.</span>max<span class="token operator">-</span>active<span class="token operator">=</span><span class="token number">200</span>
# 连接池最大阻塞等待时间（使用负值表示没有限制）
spring<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span>pool<span class="token punctuation">.</span>max<span class="token operator">-</span>wait<span class="token operator">=</span>1000ms
# 连接池中的最大空闲连接
spring<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span>pool<span class="token punctuation">.</span>max<span class="token operator">-</span>idle<span class="token operator">=</span><span class="token number">8</span>
# 连接池中的最小空闲连接
spring<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span>pool<span class="token punctuation">.</span>min<span class="token operator">-</span>idle<span class="token operator">=</span><span class="token number">0</span>
# 连接超时时间（毫秒）
spring<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>timeout<span class="token operator">=</span>1000ms
<span class="token comment" spellcheck="true">//  Cache注解配置类</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisCacheConfig</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> KeyGenerator <span class="token function">simpleKeyGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>o<span class="token punctuation">,</span> method<span class="token punctuation">,</span> objects<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>
            StringBuilder stringBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            stringBuilder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            stringBuilder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            stringBuilder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            stringBuilder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"["</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>Object obj <span class="token operator">:</span> objects<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                stringBuilder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            stringBuilder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> stringBuilder<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> CacheManager <span class="token function">cacheManager</span><span class="token punctuation">(</span>RedisConnectionFactory redisConnectionFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RedisCacheManager</span><span class="token punctuation">(</span>
                RedisCacheWriter<span class="token punctuation">.</span><span class="token function">nonLockingRedisCacheWriter</span><span class="token punctuation">(</span>redisConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">,</span>

                <span class="token comment" spellcheck="true">// 默认策略，未配置的 key 会使用这个</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getRedisCacheConfigurationWithTtl</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

                <span class="token comment" spellcheck="true">// 指定 key 策略</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getRedisCacheConfigurationMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> RedisCacheConfiguration<span class="token operator">></span> <span class="token function">getRedisCacheConfigurationMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> RedisCacheConfiguration<span class="token operator">></span> redisCacheConfigurationMap  <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        redisCacheConfigurationMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"redisTest"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getRedisCacheConfigurationWithTtl</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> redisCacheConfigurationMap<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> RedisCacheConfiguration <span class="token function">getRedisCacheConfigurationWithTtl</span><span class="token punctuation">(</span>Integer seconds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Jackson2JsonRedisSerializer<span class="token operator">&lt;</span>Object<span class="token operator">></span> jackson2JsonRedisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jackson2JsonRedisSerializer</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ObjectMapper om <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        om<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span>PropertyAccessor<span class="token punctuation">.</span>ALL<span class="token punctuation">,</span> JsonAutoDetect<span class="token punctuation">.</span>Visibility<span class="token punctuation">.</span>ANY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        om<span class="token punctuation">.</span><span class="token function">enableDefaultTyping</span><span class="token punctuation">(</span>ObjectMapper<span class="token punctuation">.</span>DefaultTyping<span class="token punctuation">.</span>NON_FINAL<span class="token punctuation">)</span><span class="token punctuation">;</span>
        jackson2JsonRedisSerializer<span class="token punctuation">.</span><span class="token function">setObjectMapper</span><span class="token punctuation">(</span>om<span class="token punctuation">)</span><span class="token punctuation">;</span>

        RedisCacheConfiguration redisCacheConfiguration <span class="token operator">=</span> RedisCacheConfiguration<span class="token punctuation">.</span><span class="token function">defaultCacheConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        redisCacheConfiguration <span class="token operator">=</span> redisCacheConfiguration<span class="token punctuation">.</span><span class="token function">serializeValuesWith</span><span class="token punctuation">(</span>
                RedisSerializationContext
                        <span class="token punctuation">.</span>SerializationPair
                        <span class="token punctuation">.</span><span class="token function">fromSerializer</span><span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">entryTtl</span><span class="token punctuation">(</span>Duration<span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span>seconds<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> redisCacheConfiguration<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">// RedisAutoConfiguration</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableCaching</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisConfig</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"all"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> RedisTemplate<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span>RedisConnectionFactory factory<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        RedisTemplate<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        template<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>factory<span class="token punctuation">)</span><span class="token punctuation">;</span>

        Jackson2JsonRedisSerializer jackson2JsonRedisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jackson2JsonRedisSerializer</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        ObjectMapper om <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        om<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span>PropertyAccessor<span class="token punctuation">.</span>ALL<span class="token punctuation">,</span> JsonAutoDetect<span class="token punctuation">.</span>Visibility<span class="token punctuation">.</span>ANY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        om<span class="token punctuation">.</span><span class="token function">enableDefaultTyping</span><span class="token punctuation">(</span>ObjectMapper<span class="token punctuation">.</span>DefaultTyping<span class="token punctuation">.</span>NON_FINAL<span class="token punctuation">)</span><span class="token punctuation">;</span>
        jackson2JsonRedisSerializer<span class="token punctuation">.</span><span class="token function">setObjectMapper</span><span class="token punctuation">(</span>om<span class="token punctuation">)</span><span class="token punctuation">;</span>

        StringRedisSerializer stringRedisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// key采用String的序列化方式</span>
        template<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span>stringRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// hash的key也采用String的序列化方式</span>
        template<span class="token punctuation">.</span><span class="token function">setHashKeySerializer</span><span class="token punctuation">(</span>stringRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// value序列化方式采用jackson</span>
        template<span class="token punctuation">.</span><span class="token function">setValueSerializer</span><span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// hash的value序列化方式采用jackson</span>
        template<span class="token punctuation">.</span><span class="token function">setHashValueSerializer</span><span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        template<span class="token punctuation">.</span><span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> template<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">// 基础使用</span>
<span class="token annotation punctuation">@Resource</span>
RedisTemplate<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">></span> redisTemplate<span class="token punctuation">;</span>
redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rightPush</span><span class="token punctuation">(</span><span class="token string">"user:1:order"</span><span class="token punctuation">,</span> dataList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"key"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 注解使用</span>
<span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"redisTest"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> TestBean <span class="token function">testBeanAnnotation</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="Redis使用场景"><a href="#Redis使用场景" class="headerlink" title="Redis使用场景"></a>Redis使用场景</h1><table>
<thead>
<tr>
<th align="left">类型</th>
<th align="left">适用场景</th>
</tr>
</thead>
<tbody><tr>
<td align="left">String</td>
<td align="left">缓存，限流，计数器，分布式锁，分布式session</td>
</tr>
<tr>
<td align="left">Hash</td>
<td align="left">存储用户信息，用户主页访问量，组合查询</td>
</tr>
<tr>
<td align="left">List</td>
<td align="left">微博关注人时间轴列表，简单队列</td>
</tr>
<tr>
<td align="left">Set</td>
<td align="left">赞，踩，标签，好友关系</td>
</tr>
<tr>
<td align="left">Zset</td>
<td align="left">排行榜</td>
</tr>
</tbody></table>
<p>或者简单消息队列，发布订阅实施消息系统等等</p>
<h3 id="String-缓存"><a href="#String-缓存" class="headerlink" title="String - 缓存"></a>String - 缓存</h3><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 1.Cacheable 注解</span>
<span class="token comment" spellcheck="true">// controller 调用 service 时自动判断有没有缓存，如果有就走redis缓存直接返回，如果没有则数据库然后自动放入redis中</span>
<span class="token comment" spellcheck="true">// 可以设置过期时间，KEY生成规则 （KEY生成规则基于 参数的toString方法）</span>
<span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"yearScore"</span><span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token string">"#yearScore"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> List<span class="token operator">&lt;</span>YearScore<span class="token operator">></span> <span class="token function">findBy</span> <span class="token punctuation">(</span>YearScore yearScore<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 2.手动用缓存</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>redis<span class="token punctuation">.</span><span class="token function">hasKey</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span> 

redis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>find from DB<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="String-限流-计数器"><a href="#String-限流-计数器" class="headerlink" title="String - 限流 | 计数器"></a>String - 限流 | 计数器</h3><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 注：这只是一个最简单的Demo 效率低，耗时旧，但核心就是这个意思</span>
<span class="token comment" spellcheck="true">// 计数器也是利用单线程incr...等等</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/redisLimit"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> String <span class="token function">testRedisLimit</span><span class="token punctuation">(</span>String uuid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>uuid<span class="token punctuation">)</span> <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Long incr <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">incr</span><span class="token punctuation">(</span>uuid<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>incr <span class="token operator">></span> MAX_LIMITTIME<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">"Failure Request"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">"Success Request"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// 设置Key 起始请求为1，10秒过期  ->  实际写法肯定封装过,这里就是随便一写</span>
    jedis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>uuid<span class="token punctuation">,</span> <span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    jedis<span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span>uuid<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">"Success Request"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="String-分布式锁-重点"><a href="#String-分布式锁-重点" class="headerlink" title="String - 分布式锁 (重点)"></a>String - 分布式锁 (重点)</h3><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/***
 * 核心思路：
 *     分布式服务调用时setnx,返回1证明拿到，用完了删除，返回0就证明被锁，等...
 *     SET KEY value [EX seconds] [PX milliseconds] [NX|XX]
 *     EX second:设置键的过期时间为second秒
 *     PX millisecond:设置键的过期时间为millisecond毫秒
 *     NX：只在键不存在时，才对键进行设置操作
 *     XX:只在键已经存在时，才对键进行设置操作
 *
 * 1.设置锁
 *     A. 分布式业务统一Key
 *     B. 设置Key过期时间
 *     C. 设置随机value,利用ThreadLocal 线程私有存储随机value
 *
 * 2.业务处理
 *     ...
 *
 * 3.解锁
 *     A. 无论如何必须解锁 - finally (超时时间和finally 双保证)
 *     B. 要对比是否是本线程上的锁，所以要对比线程私有value和存储的value是否一致(避免把别人加锁的东西删除了)
 */</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/redisLock"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> String <span class="token function">testRedisLock</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            RedisContextHolder<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            String uuid <span class="token operator">=</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            String set <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>KEY<span class="token punctuation">,</span> uuid<span class="token punctuation">,</span> <span class="token string">"NX"</span><span class="token punctuation">,</span> <span class="token string">"EX"</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            RedisContextHolder<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>uuid<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token string">"OK"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>set<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// 进入循环-可以短时间休眠</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// 获取锁成功 Do Somethings....</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 解锁 -> 保证获取数据，判断一致以及删除数据三个操作是原子的， 因此如下写法是不符合的</span>
        <span class="token comment" spellcheck="true">/*if (RedisContextHolder.getValue() != null &amp;&amp; jedis.get(KEY) != null &amp;&amp; RedisContextHolder.getValue().equals(jedis.get(KEY))) {
                jedis.del(KEY);
            }*/</span>

        <span class="token comment" spellcheck="true">// 正确姿势 -> 使用Lua脚本,保证原子性</span>
        String luaScript <span class="token operator">=</span> <span class="token string">"if redis.call('get', KEYS[1]) == ARGV[1] then return redis.call('del',KEYS[1]) else return 0 end"</span><span class="token punctuation">;</span>
        Object eval <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">eval</span><span class="token punctuation">(</span>luaScript<span class="token punctuation">,</span> Collections<span class="token punctuation">.</span><span class="token function">singletonList</span><span class="token punctuation">(</span>KEY<span class="token punctuation">)</span><span class="token punctuation">,</span> Collections<span class="token punctuation">.</span><span class="token function">singletonList</span><span class="token punctuation">(</span>RedisContextHolder<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token string">"锁创建成功-业务处理成功"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="String-分布式Session（重点）"><a href="#String-分布式Session（重点）" class="headerlink" title="String - 分布式Session（重点）"></a>String - 分布式Session（重点）</h3><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 1.首先明白为什么需要分布式session -> nginx负载均衡 分发到不同的Tomcat，即使利用IP分发，可以利用request获取session，但是其中一个挂了，怎么办？？ 所以需要分布式session</span>

注意理解其中的区别  A服务<span class="token operator">-</span>用户校验服务  B服务<span class="token operator">-</span>业务层

情况A：
A<span class="token punctuation">,</span>B 服务单机部署：
cookie：登录成功后，存储信息到cookie，A服务自身通过request设置session，获取session，B服务通过唯一key或者userid 查询数据库获取用户信息

cookie<span class="token operator">+</span>redis：登录成功后，存储信息到cookie，A服务自身通过request设置session，获取session，B服务通过唯一key或者userid 查询redis获取用户信息


情况B：
A服务多节点部署，B服务多节点部署
B服务获取用户信息的方式其实是不重要的，必然要查，要么从数据库，要么从cookie

A服务：登录成功后，存储唯一key到cookie， 与此同时，A服务需要把session（KEY<span class="token operator">-</span>UserInfo）同步到redis中，不能存在单纯的request（否则nginx分发到另一个服务器就完犊子了）

官方实现：
spring<span class="token operator">-</span>session<span class="token operator">-</span>data<span class="token operator">-</span>redis
有一个内置拦截器，拦截request，session通过redis交互，普通使用代码依然是request<span class="token punctuation">.</span>getSession<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>  但是实际上这个session的值已经被该组件拦截，通过redis进行同步了<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="List-简单队列-栈"><a href="#List-简单队列-栈" class="headerlink" title="List 简单队列-栈"></a>List 简单队列-栈</h3><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 说白了利用redis - list数据结构 支持从左从右push，从左从右pop</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisStack</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Resource</span>
    Jedis jedis<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> String KEY <span class="token operator">=</span> <span class="token string">"Stack"</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/** push **/</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">push</span> <span class="token punctuation">(</span>String value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        jedis<span class="token punctuation">.</span><span class="token function">lpush</span><span class="token punctuation">(</span>KEY<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">/** pop **/</span>
    <span class="token keyword">public</span> String <span class="token function">pop</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> jedis<span class="token punctuation">.</span><span class="token function">lpop</span><span class="token punctuation">(</span>KEY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisQueue</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Resource</span>
    JedisPool jedisPool<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> String KEY <span class="token operator">=</span> <span class="token string">"Queue"</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/** push **/</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">push</span> <span class="token punctuation">(</span>String value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Jedis jedis <span class="token operator">=</span> jedisPool<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">lpush</span><span class="token punctuation">(</span>KEY<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">/** pop **/</span>
    <span class="token keyword">public</span> String <span class="token function">pop</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Jedis jedis <span class="token operator">=</span> jedisPool<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> jedis<span class="token punctuation">.</span><span class="token function">rpop</span><span class="token punctuation">(</span>KEY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="List-社交类APP-好友列表"><a href="#List-社交类APP-好友列表" class="headerlink" title="List 社交类APP - 好友列表"></a>List 社交类APP - 好友列表</h3><pre><code>根据时间显示好友，多个好友列表，求交集，并集  显示共同好友等等...
疑问：难道大厂真的用redis存这些数据吗？？？多大的量啊... 我个人认为实际是数据库存用户id，然后用算法去处理，更省空间</code></pre><h3 id="Set-抽奖-好友关系（合，并，交集）"><a href="#Set-抽奖-好友关系（合，并，交集）" class="headerlink" title="Set 抽奖 | 好友关系（合，并，交集）"></a>Set 抽奖 | 好友关系（合，并，交集）</h3><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 插入key 及用户id</span>
sadd cat<span class="token operator">:</span><span class="token number">1</span> <span class="token number">001</span> <span class="token number">002</span> <span class="token number">003</span> <span class="token number">004</span> <span class="token number">005</span> <span class="token number">006</span>

<span class="token comment" spellcheck="true">// 返回抽奖参与人数</span>
scard cat<span class="token operator">:</span><span class="token number">1</span>

<span class="token comment" spellcheck="true">// 随机抽取一个</span>
srandmember cat<span class="token operator">:</span><span class="token number">1</span>

<span class="token comment" spellcheck="true">// 随机抽取一人，并移除</span>
spop cat<span class="token operator">:</span><span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="Zset-排行榜"><a href="#Zset-排行榜" class="headerlink" title="Zset 排行榜"></a>Zset 排行榜</h3><pre class="line-numbers language-java"><code class="language-java">根据分数实现有序列表
微博热搜：每点击一次 分数<span class="token operator">+</span><span class="token number">1</span> 即可

<span class="token operator">--</span><span class="token operator">-</span> 不用数据库目的是因为避免order by 进行全表扫描<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/redis/" rel="tag"># redis</a>
              <a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" rel="tag"># 中间件</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/08/05/old/redis%E5%9F%BA%E7%A1%80/" rel="prev" title="redis基础">
      <i class="fa fa-chevron-left"></i> redis基础
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/08/07/old/redis%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98/" rel="next" title="redis相关问题">
      redis相关问题 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Windows-Redis"><span class="nav-text">Windows Redis</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#安装"><span class="nav-text">安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用"><span class="nav-text">使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#基本文件说明"><span class="nav-text">基本文件说明</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#基础命令"><span class="nav-text">基础命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#字符串命令"><span class="nav-text">字符串命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#哈希-Hash-命令"><span class="nav-text">哈希(Hash)命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#列表-List-命令"><span class="nav-text">列表(List)命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#集合-Set-命令"><span class="nav-text">集合(Set)命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#有序集合-sorted-set-命令"><span class="nav-text">有序集合(sorted set)命令</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#发布订阅"><span class="nav-text">发布订阅</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Redis-事务"><span class="nav-text">Redis 事务</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Redis-服务器命令"><span class="nav-text">Redis 服务器命令</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Redis-数据备份与恢复"><span class="nav-text">Redis 数据备份与恢复</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Redis-性能测试"><span class="nav-text">Redis 性能测试</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Java-Redis"><span class="nav-text">Java Redis</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Jedis"><span class="nav-text">Jedis</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SpringBoot-redis-staeter-RedisTemplate"><span class="nav-text">SpringBoot redis staeter RedisTemplate</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Redis使用场景"><span class="nav-text">Redis使用场景</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#String-缓存"><span class="nav-text">String - 缓存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#String-限流-计数器"><span class="nav-text">String - 限流 | 计数器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#String-分布式锁-重点"><span class="nav-text">String - 分布式锁 (重点)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#String-分布式Session（重点）"><span class="nav-text">String - 分布式Session（重点）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#List-简单队列-栈"><span class="nav-text">List 简单队列-栈</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#List-社交类APP-好友列表"><span class="nav-text">List 社交类APP - 好友列表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Set-抽奖-好友关系（合，并，交集）"><span class="nav-text">Set 抽奖 | 好友关系（合，并，交集）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Zset-排行榜"><span class="nav-text">Zset 排行榜</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="摘星"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">摘星</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">261</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">142</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/zhangkexuan" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zhangkexuan" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/kexuan_zhang@qq.com" title="E-Mail → kexuan_zhang@qq.com"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2019 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">摘星</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>

<!-- ҳ����С���� -->
<script type="text/javascript" src="/js/clicklove.js"></script>
