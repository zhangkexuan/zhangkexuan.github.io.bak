<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="上文中解决了域名和环境问题，本文先实现查询功能，主要涉及到：  vue的axios请求 跨域问题 后端的mvc模型 通用mapper">
<meta property="og:type" content="article">
<meta property="og:title" content="leyou后台#3-分类查询和品牌查询">
<meta property="og:url" content="http://yoursite.com/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/index.html">
<meta property="og:site_name" content="摘星">
<meta property="og:description" content="上文中解决了域名和环境问题，本文先实现查询功能，主要涉及到：  vue的axios请求 跨域问题 后端的mvc模型 通用mapper">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://yoursite.com/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/%E6%8D%95%E8%8E%B7.PNG">
<meta property="og:image" content="http://yoursite.com/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/1530556389224.png">
<meta property="og:image" content="http://yoursite.com/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/1525999774439.png">
<meta property="og:image" content="http://yoursite.com/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/1545220121941.png">
<meta property="og:image" content="http://yoursite.com/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/1545220316442.png">
<meta property="og:image" content="http://yoursite.com/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/1545220394460.png">
<meta property="og:image" content="http://yoursite.com/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/1545219777406.png">
<meta property="og:image" content="http://yoursite.com/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/1530427294644.png">
<meta property="og:image" content="http://yoursite.com/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/1530427514123.png">
<meta property="og:image" content="http://yoursite.com/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/1530444682670.png">
<meta property="og:image" content="http://yoursite.com/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/1530445885707.png">
<meta property="og:image" content="http://yoursite.com/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/1530450599897.png">
<meta property="og:image" content="http://yoursite.com/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/1530450744567.png">
<meta property="og:image" content="http://yoursite.com/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/1530455133230.png">
<meta property="og:image" content="http://yoursite.com/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/1530455291468.png">
<meta property="og:image" content="http://yoursite.com/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/1530455437899.png">
<meta property="og:image" content="http://yoursite.com/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/1530460311064.png">
<meta property="og:image" content="http://yoursite.com/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/1530462650711.png">
<meta property="og:image" content="http://yoursite.com/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/1530463010927.png">
<meta property="og:image" content="http://yoursite.com/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/1526021968036.png">
<meta property="og:image" content="http://yoursite.com/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/1545221218980.png">
<meta property="og:image" content="http://yoursite.com/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/1543066995215.png">
<meta property="og:image" content="http://yoursite.com/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/1530541070271.png">
<meta property="og:image" content="http://yoursite.com/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/1530541222679.png">
<meta property="og:image" content="http://yoursite.com/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/1530543778541.png">
<meta property="og:image" content="http://yoursite.com/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/1530549253999.png">
<meta property="og:image" content="http://yoursite.com/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/1530549095150.png">
<meta property="og:image" content="http://yoursite.com/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/1526033988251.png">
<meta property="og:image" content="http://yoursite.com/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/1526034150067.png">
<meta property="og:image" content="http://yoursite.com/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/1526041205846.png">
<meta property="og:image" content="http://yoursite.com/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/1543067111272.png">
<meta property="og:image" content="http://yoursite.com/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/1526048143014.png">
<meta property="og:image" content="http://yoursite.com/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/1526048275064.png">
<meta property="og:image" content="http://yoursite.com/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/9.gif">
<meta property="og:image" content="http://yoursite.com/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/1526049643506.png">
<meta property="og:image" content="http://yoursite.com/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/22.gif">
<meta property="og:image" content="http://yoursite.com/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/1526049939985.png">
<meta property="og:image" content="http://yoursite.com/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/1526050032436.png">
<meta property="og:image" content="http://yoursite.com/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/1530555740595.png">
<meta property="article:published_time" content="2020-05-20T18:20:44.000Z">
<meta property="article:modified_time" content="2020-05-20T18:20:44.000Z">
<meta property="article:author" content="摘星">
<meta property="article:tag" content="vue.js">
<meta property="article:tag" content="nginx">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/%E6%8D%95%E8%8E%B7.PNG">

<link rel="canonical" href="http://yoursite.com/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>leyou后台#3-分类查询和品牌查询 | 摘星</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">摘星</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="摘星">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="摘星">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          leyou后台#3-分类查询和品牌查询
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-05-21 02:20:44" itemprop="dateCreated datePublished" datetime="2020-05-21T02:20:44+08:00">2020-05-21</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/leyou/" itemprop="url" rel="index"><span itemprop="name">leyou</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>上文中解决了域名和环境问题，本文先实现查询功能，主要涉及到：</p>
<ul>
<li>vue的axios请求</li>
<li>跨域问题</li>
<li>后端的mvc模型</li>
<li>通用mapper</li>
</ul>
<a id="more"></a>

<h1 id="1-开发API文档"><a href="#1-开发API文档" class="headerlink" title="1.开发API文档"></a>1.开发API文档</h1><p>一般而言都是api先行，再前端后台分离开发。api文档大致内容如下：</p>
<p><img src="%E6%8D%95%E8%8E%B7.PNG" alt="捕获"></p>
<h1 id="2-实现商品分类查询"><a href="#2-实现商品分类查询" class="headerlink" title="2.实现商品分类查询"></a>2.实现商品分类查询</h1><p>商城的核心自然是商品，而商品多了以后，肯定要进行分类，并且不同的商品会有不同的品牌信息，我们需要依次去完成：商品分类、品牌、商品的开发。</p>
<h2 id="2-1-导入数据"><a href="#2-1-导入数据" class="headerlink" title="2.1.导入数据"></a>2.1.导入数据</h2><p>首先导入课前资料提供的sql：</p>
<p><img src="1530556389224.png" alt="1530556389224"></p>
<p>我们先看商品分类表：</p>
<p> <img src="1525999774439.png" alt="1525999774439"></p>
<pre class="line-numbers language-mysql"><code class="language-mysql">CREATE TABLE `tb_category` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '类目id',
  `name` varchar(20) NOT NULL COMMENT '类目名称',
  `parent_id` bigint(20) NOT NULL COMMENT '父类目id,顶级类目填0',
  `is_parent` tinyint(1) NOT NULL COMMENT '是否为父节点，0为否，1为是',
  `sort` int(4) NOT NULL COMMENT '排序指数，越小越靠前',
  PRIMARY KEY (`id`),
  KEY `key_parent_id` (`parent_id`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=1424 DEFAULT CHARSET=utf8 COMMENT='商品类目表，类目和商品(spu)是一对多关系，类目与品牌是多对多关系';<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>因为商品分类会有层级关系，因此这里我们加入了<code>parent_id</code>字段，对本表中的其它分类进行自关联。</p>
<h2 id="2-2-实现功能"><a href="#2-2-实现功能" class="headerlink" title="2.2.实现功能"></a>2.2.实现功能</h2><p>在浏览器页面点击“分类管理”菜单：</p>
<p><img src="1545220121941.png" alt="1545220121941"></p>
<p>根据这个路由路径到路由文件（src/route/index.js），可以定位到分类管理页面：</p>
<p><img src="1545220316442.png" alt="1545220316442"></p>
<p>由路由文件知，页面是src/pages/item/Category.vue</p>
<p><img src="1545220394460.png" alt="1545220394460"></p>
<p>商品分类使用了树状结构，而这种结构的组件vuetify并没有为我们提供，这里自定义了一个树状组件。不要求实现或者查询组件的实现，只要求可以参照文档使用该组件即可：</p>
<p><img src="1545219777406.png" alt="1545219777406"></p>
<h3 id="2-2-1-url异步请求"><a href="#2-2-1-url异步请求" class="headerlink" title="2.2.1.url异步请求"></a>2.2.1.url异步请求</h3><p>点击商品管理下的分类管理子菜单，在浏览器控制台可以看到：</p>
<p><img src="1530427294644.png" alt="1530427294644"></p>
<p>页面中没有，只是发起了一条请求：<a href="http://api.leyou.com/api/item/category/list?pid=0" target="_blank" rel="noopener">http://api.leyou.com/api/item/category/list?pid=0</a> </p>
<p>大家可能会觉得很奇怪，我们明明是使用的相对路径：/item/category/list，讲道理发起的请求地址应该是：</p>
<p><a href="http://manage.leyou.com/item/category/list" target="_blank" rel="noopener">http://manage.leyou.com/item/category/list</a></p>
<p>但实际却是：</p>
<p><a href="http://api.leyou.com/api/item/category/list?pid=0" target="_blank" rel="noopener">http://api.leyou.com/api/item/category/list?pid=0</a> </p>
<p>这是因为，我们有一个全局的配置文件，对所有的请求路径进行了约定：</p>
<p><img src="1530427514123.png" alt="1530427514123"></p>
<p>路径是<a href="http://api.leyou.com，并且默认加上了/api的前缀，这恰好与我们的网关设置匹配，我们只需要把地址改成网关的地址即可,因为我们使用了nginx反向代理，这里可以写域名。" target="_blank" rel="noopener">http://api.leyou.com，并且默认加上了/api的前缀，这恰好与我们的网关设置匹配，我们只需要把地址改成网关的地址即可,因为我们使用了nginx反向代理，这里可以写域名。</a></p>
<p>接下来，我们要做的事情就是编写后台接口，返回对应的数据即可。</p>
<h3 id="2-2-2-实体类"><a href="#2-2-2-实体类" class="headerlink" title="2.2.2.实体类"></a>2.2.2.实体类</h3><p>在<code>leyou-item-interface</code>中添加category实体类：</p>
<p> <img src="1530444682670.png" alt="1530444682670"></p>
<p>内容：</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"tb_category"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Category</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy<span class="token operator">=</span>GenerationType<span class="token punctuation">.</span>IDENTITY<span class="token punctuation">)</span>
    <span class="token keyword">private</span> Long id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> Long parentId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> Boolean isParent<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 注意isParent生成的getter和setter方法需要手动加上Is</span>
    <span class="token keyword">private</span> Integer sort<span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// getter和setter略</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>需要注意的是，这里要用到jpa的注解，因此我们在<code>leyou-item-iterface</code>中添加jpa依赖</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>javax.persistence<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>persistence-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="2-2-3-controller"><a href="#2-2-3-controller" class="headerlink" title="2.2.3.controller"></a>2.2.3.controller</h3><p>编写一个controller一般需要知道四个内容：</p>
<ul>
<li>请求方式：决定我们用GetMapping还是PostMapping</li>
<li>请求路径：决定映射路径</li>
<li>请求参数：决定方法的参数</li>
<li>返回值结果：决定方法的返回值</li>
</ul>
<p>在刚才页面发起的请求中，我们就能得到绝大多数信息：</p>
<p><img src="1530445885707.png" alt="1530445885707"></p>
<ul>
<li><p>请求方式：Get，插叙肯定是get请求</p>
</li>
<li><p>请求路径：/api/item/category/list。其中/api是网关前缀，/item是网关的路由映射，真实的路径应该是/category/list</p>
</li>
<li><p>请求参数：pid=0，根据tree组件的说明，应该是父节点的id，第一次查询为0，那就是查询一级类目</p>
</li>
<li><p>返回结果：？？</p>
<p>根据前面tree组件的用法我们知道，返回的应该是json数组：</p>
<pre class="line-numbers language-json"><code class="language-json"><span class="token punctuation">[</span>
    <span class="token punctuation">{</span> 
        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">74</span><span class="token punctuation">,</span>
        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"手机"</span><span class="token punctuation">,</span>
        <span class="token property">"parentId"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">"isParent"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"sort"</span><span class="token operator">:</span> <span class="token number">2</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
     <span class="token punctuation">{</span> 
        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">75</span><span class="token punctuation">,</span>
        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"家用电器"</span><span class="token punctuation">,</span>
        <span class="token property">"parentId"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">"isParent"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"sort"</span><span class="token operator">:</span> <span class="token number">3</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>对应的java类型可以是List集合，里面的元素就是类目对象了。也就是<code>List&lt;Category&gt;</code></p>
</li>
</ul>
<p>添加Controller：</p>
<p> <img src="1530450599897.png" alt="1530450599897"></p>
<p>controller代码：</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Controller</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"category"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CategoryController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> CategoryService categoryService<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * 根据父id查询子节点
     * @param pid
     * @return
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"list"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> ResponseEntity<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>Category<span class="token operator">>></span> <span class="token function">queryCategoriesByPid</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"pid"</span><span class="token punctuation">)</span> Long pid<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>pid <span class="token operator">==</span> null <span class="token operator">||</span> pid<span class="token punctuation">.</span><span class="token function">longValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 响应400，相当于ResponseEntity.status(HttpStatus.BAD_REQUEST).build();</span>
            <span class="token keyword">return</span> ResponseEntity<span class="token punctuation">.</span><span class="token function">badRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        List<span class="token operator">&lt;</span>Category<span class="token operator">></span> categories <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>categoryService<span class="token punctuation">.</span><span class="token function">queryCategoriesByPid</span><span class="token punctuation">(</span>pid<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>CollectionUtils<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>categories<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 响应404</span>
            <span class="token keyword">return</span> ResponseEntity<span class="token punctuation">.</span><span class="token function">notFound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> ResponseEntity<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>categories<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="2-2-4-service"><a href="#2-2-4-service" class="headerlink" title="2.2.4.service"></a>2.2.4.service</h3><p>一般service层我们会定义接口和实现类，不过这里我们就偷懒一下，直接写实现类了：</p>
<p> <img src="1530450744567.png" alt="1530450744567"></p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CategoryService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> CategoryMapper categoryMapper<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * 根据parentId查询子类目
     * @param pid
     * @return
     */</span>
    <span class="token keyword">public</span> List<span class="token operator">&lt;</span>Category<span class="token operator">></span> <span class="token function">queryCategoriesByPid</span><span class="token punctuation">(</span>Long pid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Category record <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Category</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        record<span class="token punctuation">.</span><span class="token function">setParentId</span><span class="token punctuation">(</span>pid<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>categoryMapper<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="2-2-5-mapper"><a href="#2-2-5-mapper" class="headerlink" title="2.2.5.mapper"></a>2.2.5.mapper</h3><p>我们使用通用mapper来简化开发：</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CategoryMapper</span> <span class="token keyword">extends</span> <span class="token class-name">Mapper</span><span class="token operator">&lt;</span>Category<span class="token operator">></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>要注意，我们并没有在mapper接口上声明@Mapper注解，那么mybatis如何才能找到接口呢？</p>
<p>我们在启动类上添加一个扫描包功能：</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableDiscoveryClient</span>
<span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span><span class="token string">"com.leyou.item.mapper"</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// mapper接口的包扫描</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LeyouItemServiceApplication</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>LeyouItemServiceApplication<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="2-2-6-启动并测试"><a href="#2-2-6-启动并测试" class="headerlink" title="2.2.6.启动并测试"></a>2.2.6.启动并测试</h3><p>我们不经过网关，直接访问：<a href="http://localhost:8081/category/list" target="_blank" rel="noopener">http://localhost:8081/category/list</a></p>
<p><img src="1530455133230.png" alt="1530455133230"></p>
<p>然后试试网关是否畅通：<a href="http://api.leyou.com/api/item/category/list" target="_blank" rel="noopener">http://api.leyou.com/api/item/category/list</a></p>
<p><img src="1530455291468.png" alt="1530455291468"></p>
<p>一切OK！</p>
<p>然后刷新后台管理页面查看：</p>
<p><img src="1530455437899.png" alt="1530455437899"></p>
<p>发现报错了！</p>
<p>浏览器直接访问没事，但是这里却报错，什么原因？</p>
<p>这其实是浏览器的同源策略造成的跨域问题。</p>
<h1 id="3-跨域问题"><a href="#3-跨域问题" class="headerlink" title="3.跨域问题"></a>3.跨域问题</h1><p>跨域：浏览器对于javascript的同源策略的限制 。</p>
<p>以下情况都属于跨域：</p>
<table>
<thead>
<tr>
<th>跨域原因说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>域名不同</td>
<td><code>www.jd.com</code> 与 <code>www.taobao.com</code></td>
</tr>
<tr>
<td>域名相同，端口不同</td>
<td><code>www.jd.com:8080</code> 与 <code>www.jd.com:8081</code></td>
</tr>
<tr>
<td>二级域名不同</td>
<td><code>item.jd.com</code> 与 <code>miaosha.jd.com</code></td>
</tr>
</tbody></table>
<p>如果<strong>域名和端口都相同，但是请求路径不同</strong>，不属于跨域，如：</p>
<p><code>www.jd.com/item</code> </p>
<p><code>www.jd.com/goods</code></p>
<p>http和https也属于跨域</p>
<p>而我们刚才是从<code>manage.leyou.com</code>去访问<code>api.leyou.com</code>，这属于二级域名不同，跨域了。</p>
<h2 id="3-1-为什么有跨域问题？"><a href="#3-1-为什么有跨域问题？" class="headerlink" title="3.1.为什么有跨域问题？"></a>3.1.为什么有跨域问题？</h2><p>跨域不一定都会有跨域问题。</p>
<p>因为跨域问题是浏览器对于ajax请求的一种安全限制：<strong>一个页面发起的ajax请求，只能是与当前页域名相同的路径</strong>，这能有效的阻止跨站攻击。</p>
<p>因此：<strong>跨域问题 是针对ajax的一种限制</strong>。</p>
<p>但是这却给我们的开发带来了不便，而且在实际生产环境中，肯定会有很多台服务器之间交互，地址和端口都可能不同，怎么办？</p>
<h2 id="3-2-解决跨域问题的方案"><a href="#3-2-解决跨域问题的方案" class="headerlink" title="3.2.解决跨域问题的方案"></a>3.2.解决跨域问题的方案</h2><p>目前比较常用的跨域解决方案有3种：</p>
<ul>
<li><p>Jsonp</p>
<p>最早的解决方案，利用script标签可以跨域的原理实现。</p>
<p>限制：</p>
<ul>
<li>需要服务的支持</li>
<li>只能发起GET请求</li>
</ul>
</li>
<li><p>nginx反向代理</p>
<p>思路是：利用nginx把跨域反向代理为不跨域，支持各种请求方式</p>
<p>缺点：需要在nginx进行额外配置，语义不清晰 </p>
</li>
<li><p>CORS</p>
<p>规范化的跨域请求解决方案，安全可靠。</p>
<p>优势：</p>
<ul>
<li>在服务端进行控制是否允许跨域，可自定义规则</li>
<li>支持各种请求方式</li>
</ul>
<p>缺点：</p>
<ul>
<li>会产生额外的请求</li>
</ul>
</li>
</ul>
<p>我们这里会采用cors的跨域方案。</p>
<h2 id="3-3-cors解决跨域"><a href="#3-3-cors解决跨域" class="headerlink" title="3.3.cors解决跨域"></a>3.3.cors解决跨域</h2><h3 id="5-3-1-什么是cors"><a href="#5-3-1-什么是cors" class="headerlink" title="5.3.1.什么是cors"></a>5.3.1.什么是cors</h3><p>CORS是一个W3C标准，全称是”跨域资源共享”（Cross-origin resource sharing）。</p>
<p>它允许浏览器向跨源服务器，发出<a href="http://www.ruanyifeng.com/blog/2012/09/xmlhttprequest_level_2.html" target="_blank" rel="noopener"><code>XMLHttpRequest</code></a>请求，从而克服了AJAX只能<a href="http://www.ruanyifeng.com/blog/2016/04/same-origin-policy.html" target="_blank" rel="noopener">同源</a>使用的限制。</p>
<p>CORS需要浏览器和服务器同时支持。目前，所有浏览器都支持该功能，IE浏览器不能低于IE10。</p>
<ul>
<li><p>浏览器端：</p>
<p>目前，所有浏览器都支持该功能（IE10以下不行）。整个CORS通信过程，都是浏览器自动完成，不需要用户参与。</p>
</li>
<li><p>服务端：</p>
<p>CORS通信与AJAX没有任何差别，因此你不需要改变以前的业务逻辑。只不过，浏览器会在请求中携带一些头信息，我们需要以此判断是否允许其跨域，然后在响应头中加入一些信息即可。这一般通过过滤器完成即可。</p>
</li>
</ul>
<h3 id="3-3-2-原理有点复杂"><a href="#3-3-2-原理有点复杂" class="headerlink" title="3.3.2.原理有点复杂"></a>3.3.2.原理有点复杂</h3><p>浏览器会将ajax请求分为两类，其处理方案略有差异：简单请求、特殊请求。</p>
<h4 id="3-3-2-1-简单请求"><a href="#3-3-2-1-简单请求" class="headerlink" title="3.3.2.1.简单请求"></a>3.3.2.1.简单请求</h4><p>只要同时满足以下两大条件，就属于简单请求。：</p>
<p>（1) 请求方法是以下三种方法之一：</p>
<ul>
<li>HEAD</li>
<li>GET</li>
<li>POST</li>
</ul>
<p>（2）HTTP的头信息不超出以下几种字段：</p>
<ul>
<li>Accept</li>
<li>Accept-Language</li>
<li>Content-Language</li>
<li>Last-Event-ID</li>
<li>Content-Type：只限于三个值<code>application/x-www-form-urlencoded</code>、<code>multipart/form-data</code>、<code>text/plain</code></li>
</ul>
<p>当浏览器发现发起的ajax请求是简单请求时，会在请求头中携带一个字段：<code>Origin</code>.</p>
<p><img src="1530460311064.png" alt="1530460311064"></p>
<p>Origin中会指出当前请求属于哪个域（协议+域名+端口）。服务会根据这个值决定是否允许其跨域。</p>
<p>如果服务器允许跨域，需要在返回的响应头中携带下面信息：</p>
<pre class="line-numbers language-http"><code class="language-http"><span class="token header-name keyword">Access-Control-Allow-Origin:</span> http://manage.leyou.com
<span class="token header-name keyword">Access-Control-Allow-Credentials:</span> true
<span class="token header-name keyword">Content-Type:</span> text/html; charset=utf-8<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ul>
<li>Access-Control-Allow-Origin：可接受的域，是一个具体域名或者*（代表任意域名）</li>
<li>Access-Control-Allow-Credentials：是否允许携带cookie，默认情况下，cors不会携带cookie，除非这个值是true</li>
</ul>
<blockquote>
<p>有关cookie：</p>
</blockquote>
<p>要想操作cookie，需要满足3个条件：</p>
<ul>
<li>服务的响应头中需要携带Access-Control-Allow-Credentials并且为true。</li>
<li>浏览器发起ajax需要指定withCredentials 为true</li>
<li>响应头中的Access-Control-Allow-Origin一定不能为*，必须是指定的域名</li>
</ul>
<h4 id="3-3-2-2-特殊请求"><a href="#3-3-2-2-特殊请求" class="headerlink" title="3.3.2.2.特殊请求"></a>3.3.2.2.特殊请求</h4><p>不符合简单请求的条件，会被浏览器判定为特殊请求,，例如请求方式为PUT。</p>
<blockquote>
<p>预检请求</p>
</blockquote>
<p>特殊请求会在正式通信之前，增加一次HTTP查询请求，称为”预检”请求（preflight）。</p>
<p>浏览器先询问服务器，当前网页所在的域名是否在服务器的许可名单之中，以及可以使用哪些HTTP动词和头信息字段。只有得到肯定答复，浏览器才会发出正式的<code>XMLHttpRequest</code>请求，否则就报错。</p>
<p>一个“预检”请求的样板：</p>
<pre class="line-numbers language-http"><code class="language-http">OPTIONS /cors HTTP/1.1
<span class="token header-name keyword">Origin:</span> http://manage.leyou.com
<span class="token header-name keyword">Access-Control-Request-Method:</span> PUT
<span class="token header-name keyword">Access-Control-Request-Headers:</span> X-Custom-Header
<span class="token header-name keyword">Host:</span> api.leyou.com
<span class="token header-name keyword">Accept-Language:</span> en-US
<span class="token header-name keyword">Connection:</span> keep-alive
<span class="token header-name keyword">User-Agent:</span> Mozilla/5.0...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>与简单请求相比，除了Origin以外，多了两个头：</p>
<ul>
<li>Access-Control-Request-Method：接下来会用到的请求方式，比如PUT</li>
<li>Access-Control-Request-Headers：会额外用到的头信息</li>
</ul>
<blockquote>
<p>预检请求的响应</p>
</blockquote>
<p>服务的收到预检请求，如果许可跨域，会发出响应：</p>
<pre class="line-numbers language-http"><code class="language-http"><span class="token response-status">HTTP/1.1 <span class="token property">200 OK</span></span>
<span class="token header-name keyword">Date:</span> Mon, 01 Dec 2008 01:15:39 GMT
<span class="token header-name keyword">Server:</span> Apache/2.0.61 (Unix)
<span class="token header-name keyword">Access-Control-Allow-Origin:</span> http://manage.leyou.com
<span class="token header-name keyword">Access-Control-Allow-Credentials:</span> true
<span class="token header-name keyword">Access-Control-Allow-Methods:</span> GET, POST, PUT
<span class="token header-name keyword">Access-Control-Allow-Headers:</span> X-Custom-Header
<span class="token header-name keyword">Access-Control-Max-Age:</span> 1728000
<span class="token header-name keyword">Content-Type:</span> text/html; charset=utf-8
<span class="token header-name keyword">Content-Encoding:</span> gzip
<span class="token header-name keyword">Content-Length:</span> 0
<span class="token header-name keyword">Keep-Alive:</span> timeout=2, max=100
<span class="token header-name keyword">Connection:</span> Keep-Alive
<span class="token header-name keyword">Content-Type:</span> text/plain<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>除了<code>Access-Control-Allow-Origin</code>和<code>Access-Control-Allow-Credentials</code>以外，这里又额外多出3个头：</p>
<ul>
<li>Access-Control-Allow-Methods：允许访问的方式</li>
<li>Access-Control-Allow-Headers：允许携带的头</li>
<li>Access-Control-Max-Age：本次许可的有效时长，单位是秒，<strong>过期之前的ajax请求就无需再次进行预检了</strong></li>
</ul>
<p>如果浏览器得到上述响应，则认定为可以跨域，后续就跟简单请求的处理是一样的了。</p>
<h3 id="3-3-3-实现非常简单"><a href="#3-3-3-实现非常简单" class="headerlink" title="3.3.3.实现非常简单"></a>3.3.3.实现非常简单</h3><p>虽然原理比较复杂，但是前面说过：</p>
<ul>
<li>浏览器端都有浏览器自动完成，我们无需操心</li>
<li>服务端可以通过拦截器统一实现，不必每次都去进行跨域判定的编写。</li>
</ul>
<p>事实上，SpringMVC已经帮我们写好了CORS的跨域过滤器：CorsFilter ,内部已经实现了刚才所讲的判定逻辑，我们直接用就好了。</p>
<p>在<code>leyou-gateway</code>中编写一个配置类，并且注册CorsFilter：</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Bean<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Configuration<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>cors<span class="token punctuation">.</span>CorsConfiguration<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>cors<span class="token punctuation">.</span>UrlBasedCorsConfigurationSource<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>filter<span class="token punctuation">.</span>CorsFilter<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LeyouCorsConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> CorsFilter <span class="token function">corsFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//1.添加CORS配置信息</span>
        CorsConfiguration config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CorsConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//1) 允许的域,不要写*，否则cookie就无法使用了</span>
        config<span class="token punctuation">.</span><span class="token function">addAllowedOrigin</span><span class="token punctuation">(</span><span class="token string">"http://manage.leyou.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//2) 是否发送Cookie信息</span>
        config<span class="token punctuation">.</span><span class="token function">setAllowCredentials</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//3) 允许的请求方式</span>
        config<span class="token punctuation">.</span><span class="token function">addAllowedMethod</span><span class="token punctuation">(</span><span class="token string">"OPTIONS"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">addAllowedMethod</span><span class="token punctuation">(</span><span class="token string">"HEAD"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">addAllowedMethod</span><span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">addAllowedMethod</span><span class="token punctuation">(</span><span class="token string">"PUT"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">addAllowedMethod</span><span class="token punctuation">(</span><span class="token string">"POST"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">addAllowedMethod</span><span class="token punctuation">(</span><span class="token string">"DELETE"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">addAllowedMethod</span><span class="token punctuation">(</span><span class="token string">"PATCH"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 4）允许的头信息</span>
        config<span class="token punctuation">.</span><span class="token function">addAllowedHeader</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//2.添加映射路径，我们拦截一切请求</span>
        UrlBasedCorsConfigurationSource configSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UrlBasedCorsConfigurationSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        configSource<span class="token punctuation">.</span><span class="token function">registerCorsConfiguration</span><span class="token punctuation">(</span><span class="token string">"/**"</span><span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//3.返回新的CorsFilter.</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CorsFilter</span><span class="token punctuation">(</span>configSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>结构：</p>
<p> <img src="1530462650711.png" alt="1530462650711"></p>
<p>重启测试，访问正常：</p>
<p><img src="1530463010927.png" alt="1530463010927"></p>
<p>分类的增删改功能暂时就不做了，页面已经预留好了事件接口，有兴趣的同学可以完成一下。</p>
<h1 id="4-品牌的查询"><a href="#4-品牌的查询" class="headerlink" title="4.品牌的查询"></a>4.品牌的查询</h1><p>商品分类完成以后，自然轮到了品牌功能了。</p>
<p>先看看我们要实现的效果：</p>
<p><img src="1526021968036.png" alt="1526021968036"></p>
<p>点击“品牌管理”菜单：</p>
<p><img src="1545221218980.png" alt="1545221218980"></p>
<p>路由路径：/item/brand</p>
<p>根据路由文件知，对应的页面是：src/pages/item/Brand.vue</p>
<p>页面会发送如下请求：</p>
<p><img src="1543066995215.png" alt="1543066995215"></p>
<h2 id="4-1-后台提供查询接口"><a href="#4-1-后台提供查询接口" class="headerlink" title="4.1.后台提供查询接口"></a>4.1.后台提供查询接口</h2><p>前台页面已经准备好，接下来就是后台提供数据接口了。</p>
<h3 id="4-1-1-数据库表"><a href="#4-1-1-数据库表" class="headerlink" title="4.1.1.数据库表"></a>4.1.1.数据库表</h3><pre class="line-numbers language-mysql"><code class="language-mysql">CREATE TABLE `tb_brand` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '品牌id',
  `name` varchar(50) NOT NULL COMMENT '品牌名称',
  `image` varchar(200) DEFAULT '' COMMENT '品牌图片地址',
  `letter` char(1) DEFAULT '' COMMENT '品牌的首字母',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=325400 DEFAULT CHARSET=utf8 COMMENT='品牌表，一个品牌下有多个商品（spu），一对多关系';<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>简单的四个字段，不多解释。</p>
<p>这里需要注意的是，品牌和商品分类之间是多对多关系。因此我们有一张中间表，来维护两者间关系：</p>
<pre class="line-numbers language-mysql"><code class="language-mysql">CREATE TABLE `tb_category_brand` (
  `category_id` bigint(20) NOT NULL COMMENT '商品类目id',
  `brand_id` bigint(20) NOT NULL COMMENT '品牌id',
  PRIMARY KEY (`category_id`,`brand_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='商品分类和品牌的中间表，两者是多对多关系';
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>但是，你可能会发现，这张表中并<strong>没有设置外键约束</strong>，似乎与数据库的设计范式不符。为什么这么做？</p>
<ul>
<li>外键会严重影响数据库读写的效率</li>
<li>数据删除时会比较麻烦</li>
</ul>
<p>在电商行业，性能是非常重要的。我们宁可在代码中通过逻辑来维护表关系，也不设置外键。</p>
<h3 id="4-1-2-实体类"><a href="#4-1-2-实体类" class="headerlink" title="4.1.2.实体类"></a>4.1.2.实体类</h3><p> <img src="1530541070271.png" alt="1530541070271"></p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"tb_brand"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Brand</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> GenerationType<span class="token punctuation">.</span>IDENTITY<span class="token punctuation">)</span>
    <span class="token keyword">private</span> Long id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> String name<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 品牌名称</span>
    <span class="token keyword">private</span> String image<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 品牌图片</span>
    <span class="token keyword">private</span> Character letter<span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// getter setter 略</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="4-1-3-mapper"><a href="#4-1-3-mapper" class="headerlink" title="4.1.3.mapper"></a>4.1.3.mapper</h3><p> <img src="1530541222679.png" alt="1530541222679"></p>
<p>通用mapper来简化开发：</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BrandMapper</span> <span class="token keyword">extends</span> <span class="token class-name">Mapper</span><span class="token operator">&lt;</span>Brand<span class="token operator">></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="4-1-4-controller"><a href="#4-1-4-controller" class="headerlink" title="4.1.4.controller"></a>4.1.4.controller</h3><p>编写controller先思考四个问题，参照前端页面的控制台</p>
<ul>
<li>请求方式：查询，肯定是Get</li>
<li>请求路径：分页查询，/brand/page</li>
<li>请求参数：根据我们刚才编写的页面，有分页功能，有排序功能，有搜索过滤功能，因此至少要有5个参数：<ul>
<li>page：当前页，int</li>
<li>rows：每页大小，int</li>
<li>sortBy：排序字段，String</li>
<li>desc：是否为降序，boolean</li>
<li>key：搜索关键词，String</li>
</ul>
</li>
<li>响应结果：分页结果一般至少需要两个数据<ul>
<li>total：总条数</li>
<li>items：当前页数据</li>
<li>totalPage：有些还需要总页数</li>
</ul>
</li>
</ul>
<p>这里我们封装一个类，来表示分页结果：</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PageResult</span><span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> Long total<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 总条数</span>
    <span class="token keyword">private</span> Integer totalPage<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 总页数</span>
    <span class="token keyword">private</span> List<span class="token operator">&lt;</span>T<span class="token operator">></span> items<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 当前页数据</span>

    <span class="token keyword">public</span> <span class="token function">PageResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token function">PageResult</span><span class="token punctuation">(</span>Long total<span class="token punctuation">,</span> List<span class="token operator">&lt;</span>T<span class="token operator">></span> items<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>total <span class="token operator">=</span> total<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>items <span class="token operator">=</span> items<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token function">PageResult</span><span class="token punctuation">(</span>Long total<span class="token punctuation">,</span> Long totalPage<span class="token punctuation">,</span> List<span class="token operator">&lt;</span>T<span class="token operator">></span> items<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>total <span class="token operator">=</span> total<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>totalPage <span class="token operator">=</span> totalPage<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>items <span class="token operator">=</span> items<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> Long <span class="token function">getTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> total<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTotal</span><span class="token punctuation">(</span>Long total<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>total <span class="token operator">=</span> total<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> List<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token function">getItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> items<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setItems</span><span class="token punctuation">(</span>List<span class="token operator">&lt;</span>T<span class="token operator">></span> items<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>items <span class="token operator">=</span> items<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> Long <span class="token function">getTotalPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> totalPage<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTotalPage</span><span class="token punctuation">(</span>Long totalPage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>totalPage <span class="token operator">=</span> totalPage<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>另外，这个PageResult以后可能在其它项目中也有需求，因此我们将其抽取到<code>leyou-common</code>中，提高复用性：</p>
<p> <img src="1530543778541.png" alt="1530543778541"></p>
<p><strong>不要忘记在leyou-item-service工程的pom.xml中引入leyou-common的依赖</strong>：</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.leyou.common<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>leyou-common<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.0.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>接下来，我们编写Controller</p>
<p> <img src="1530549253999.png" alt="1530549253999"></p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"brand"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BrandController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> BrandService brandService<span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">/**
     * 根据查询条件分页并排序查询品牌信息
     * @param key
     * @param page
     * @param rows
     * @param sortBy
     * @param desc
     * @return
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"page"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> ResponseEntity<span class="token operator">&lt;</span>PageResult<span class="token operator">&lt;</span>Brand<span class="token operator">>></span> <span class="token function">queryBrandsByPage</span><span class="token punctuation">(</span>
            <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"key"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>String key<span class="token punctuation">,</span>
            <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"page"</span><span class="token punctuation">,</span> defaultValue <span class="token operator">=</span> <span class="token string">"1"</span><span class="token punctuation">)</span>Integer page<span class="token punctuation">,</span>
            <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"rows"</span><span class="token punctuation">,</span> defaultValue <span class="token operator">=</span> <span class="token string">"5"</span><span class="token punctuation">)</span>Integer rows<span class="token punctuation">,</span>
            <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"sortBy"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>String sortBy<span class="token punctuation">,</span>
            <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"desc"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>Boolean desc
    <span class="token punctuation">)</span><span class="token punctuation">{</span>
        PageResult<span class="token operator">&lt;</span>Brand<span class="token operator">></span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>brandService<span class="token punctuation">.</span><span class="token function">queryBrandsByPage</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> page<span class="token punctuation">,</span> rows<span class="token punctuation">,</span> sortBy<span class="token punctuation">,</span> desc<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>CollectionUtils<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">getItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> ResponseEntity<span class="token punctuation">.</span><span class="token function">notFound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> ResponseEntity<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="4-1-5-Service"><a href="#4-1-5-Service" class="headerlink" title="4.1.5.Service"></a>4.1.5.Service</h3><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BrandService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> BrandMapper brandMapper<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * 根据查询条件分页并排序查询品牌信息
     *
     * @param key
     * @param page
     * @param rows
     * @param sortBy
     * @param desc
     * @return
     */</span>
    <span class="token keyword">public</span> PageResult<span class="token operator">&lt;</span>Brand<span class="token operator">></span> <span class="token function">queryBrandsByPage</span><span class="token punctuation">(</span>String key<span class="token punctuation">,</span> Integer page<span class="token punctuation">,</span> Integer rows<span class="token punctuation">,</span> String sortBy<span class="token punctuation">,</span> Boolean desc<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment" spellcheck="true">// 初始化example对象</span>
        Example example <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Example</span><span class="token punctuation">(</span>Brand<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Example<span class="token punctuation">.</span>Criteria criteria <span class="token operator">=</span> example<span class="token punctuation">.</span><span class="token function">createCriteria</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// 根据name模糊查询，或者根据首字母查询</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            criteria<span class="token punctuation">.</span><span class="token function">andLike</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"%"</span> <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">"%"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orEqualTo</span><span class="token punctuation">(</span><span class="token string">"letter"</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">// 添加分页条件</span>
        PageHelper<span class="token punctuation">.</span><span class="token function">startPage</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> rows<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// 添加排序条件</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>sortBy<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            example<span class="token punctuation">.</span><span class="token function">setOrderByClause</span><span class="token punctuation">(</span>sortBy <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> <span class="token punctuation">(</span>desc <span class="token operator">?</span> <span class="token string">"desc"</span> <span class="token operator">:</span> <span class="token string">"asc"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        List<span class="token operator">&lt;</span>Brand<span class="token operator">></span> brands <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>brandMapper<span class="token punctuation">.</span><span class="token function">selectByExample</span><span class="token punctuation">(</span>example<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 包装成pageInfo</span>
        PageInfo<span class="token operator">&lt;</span>Brand<span class="token operator">></span> pageInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PageInfo</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span>brands<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 包装成分页结果集返回</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PageResult</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span>pageInfo<span class="token punctuation">.</span><span class="token function">getTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pageInfo<span class="token punctuation">.</span><span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="4-1-6-测试"><a href="#4-1-6-测试" class="headerlink" title="4.1.6.测试"></a>4.1.6.测试</h3><p>通过浏览器访问试试：<a href="http://api.leyou.com/api/item/brand/page" target="_blank" rel="noopener">http://api.leyou.com/api/item/brand/page</a></p>
<p><img src="1530549095150.png" alt="1530549095150"></p>
<p>接下来，去页面请求数据并渲染</p>
<h2 id="4-2-异步查询工具axios"><a href="#4-2-异步查询工具axios" class="headerlink" title="4.2.异步查询工具axios"></a>4.2.异步查询工具axios</h2><p>异步查询数据，自然是通过ajax查询，大家首先想起的肯定是jQuery。但jQuery与MVVM的思想不吻合，而且ajax只是jQuery的一小部分。因此不可能为了发起ajax请求而去引用这么大的一个库。</p>
<h3 id="4-2-1-axios入门"><a href="#4-2-1-axios入门" class="headerlink" title="4.2.1.axios入门"></a>4.2.1.axios入门</h3><p>Vue官方推荐的ajax请求框架叫做：axios，看下demo：</p>
<p> <img src="1526033988251.png" alt="1526033988251"></p>
<p>axios的Get请求语法：</p>
<pre class="line-numbers language-js"><code class="language-js">axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"/item/category/list?pid=0"</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 请求路径和请求参数拼接</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resp<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 成功回调函数</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 失败回调函数</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">// 参数较多时，可以通过params来传递参数</span>
axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"/item/category/list"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        params<span class="token punctuation">:</span><span class="token punctuation">{</span>
            pid<span class="token punctuation">:</span><span class="token number">0</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resp<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 成功时的回调</span>
    <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 失败时的回调</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>axios的POST请求语法：</p>
<p>比如新增一个用户</p>
<pre class="line-numbers language-js"><code class="language-js">axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/user"</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
        name<span class="token punctuation">:</span><span class="token string">"Jack"</span><span class="token punctuation">,</span>
        age<span class="token punctuation">:</span><span class="token number">21</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resp<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>注意，POST请求传参，不需要像GET请求那样定义一个对象，在对象的params参数中传参。post()方法的第二个参数对象，就是将来要传递的参数</p>
<p>PUT和DELETE请求与POST请求类似</p>
<h3 id="4-2-2-axios的全局配置"><a href="#4-2-2-axios的全局配置" class="headerlink" title="4.2.2.axios的全局配置"></a>4.2.2.axios的全局配置</h3><p>而在我们的项目中，已经引入了axios，并且进行了简单的封装，在src下的http.js中：</p>
<p> <img src="1526034150067.png" alt="1526034150067"></p>
<p>http.js中对axios进行了一些默认配置：</p>
<pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span>
<span class="token keyword">import</span> config <span class="token keyword">from</span> <span class="token string">'./config'</span>
<span class="token comment" spellcheck="true">// config中定义的基础路径是：http://api.leyou.com/api</span>
axios<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>baseURL <span class="token operator">=</span> config<span class="token punctuation">.</span>api<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 设置axios的基础请求路径</span>
axios<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>timeout <span class="token operator">=</span> <span class="token number">2000</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 设置axios的请求时间</span>

Vue<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$http <span class="token operator">=</span> axios<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 将axios赋值给Vue原型的$http属性，这样所有vue实例都可使用该对象</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><p>http.js中导入了config的配置，还记得吗？</p>
<p><img src="1526041205846.png" alt="1526041205846"></p>
</li>
<li><p>http.js对axios进行了全局配置：<code>baseURL=config.api</code>，即<code>http://api.leyou.com/api</code>。因此以后所有用axios发起的请求，都会以这个地址作为前缀。</p>
</li>
<li><p>通过<code>Vue.property.$http = axios</code>，将<code>axios</code>赋值给了 Vue原型中的<code>$http</code>。这样以后所有的Vue实例都可以访问到$http，也就是访问到了axios了。</p>
</li>
</ul>
<h3 id="4-2-3-项目中使用"><a href="#4-2-3-项目中使用" class="headerlink" title="4.2.3.项目中使用"></a>4.2.3.项目中使用</h3><p>我们在组件<code>Brand.vue</code>的getDataFromServer方法，通过$http发起get请求，测试查询品牌的接口，看是否能获取到数据：</p>
<p><img src="1543067111272.png" alt="1543067111272"></p>
<p>网络监视：</p>
<p> <img src="1526048143014.png" alt="1526048143014"></p>
<p>resp到底都有那些数据，查看控制台结果：</p>
<p><img src="1526048275064.png" alt="1526048275064"></p>
<p>可以看到，在请求成功的返回结果response中，有一个data属性，里面就是真正的响应数据。</p>
<p>响应结果中与我们设计的一致，包含3个内容：</p>
<ul>
<li>total：总条数，目前是165</li>
<li>items：当前页数据</li>
<li>totalPage：总页数，我们没有返回</li>
</ul>
<h2 id="4-3-完成分页和过滤"><a href="#4-3-完成分页和过滤" class="headerlink" title="4.3.完成分页和过滤"></a>4.3.完成分页和过滤</h2><h3 id="4-3-1-分页"><a href="#4-3-1-分页" class="headerlink" title="4.3.1.分页"></a>4.3.1.分页</h3><p>点击分页，会发起请求，通过浏览器工具查看，会发现pagination对象的属性一直在变化：</p>
<p> <img src="9.gif" alt=""></p>
<p>我们可以利用Vue的监视功能：watch，当pagination发生改变时，会调用我们的回调函数，我们在回调函数中进行数据的查询！</p>
<p>具体实现：</p>
<p><img src="1526049643506.png" alt="1526049643506"></p>
<p>成功实现分页功能：</p>
<p><img src="22.gif" alt="1526049720200"></p>
<h3 id="4-3-2-过滤"><a href="#4-3-2-过滤" class="headerlink" title="4.3.2.过滤"></a>4.3.2.过滤</h3><p>过滤字段对应的是search属性，我们只要监视这个属性即可:</p>
<p> <img src="1526049939985.png" alt="1526049939985"></p>
<p>查看网络请求：</p>
<p> <img src="1526050032436.png" alt="1526050032436"></p>
<p>页面结果：</p>
<p><img src="1530555740595.png" alt="1530555740595"></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/vue-js/" rel="tag"># vue.js</a>
              <a href="/tags/nginx/" rel="tag"># nginx</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/05/20/old/leyou%E5%90%8E%E5%8F%B0-2-%E5%9F%9F%E5%90%8D%E9%97%AE%E9%A2%98/" rel="prev" title="leyou后台#2-域名问题">
      <i class="fa fa-chevron-left"></i> leyou后台#2-域名问题
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/" rel="next" title="leyou后台#4-品牌增加">
      leyou后台#4-品牌增加 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-开发API文档"><span class="nav-text">1.开发API文档</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-实现商品分类查询"><span class="nav-text">2.实现商品分类查询</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-导入数据"><span class="nav-text">2.1.导入数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-实现功能"><span class="nav-text">2.2.实现功能</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-1-url异步请求"><span class="nav-text">2.2.1.url异步请求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-2-实体类"><span class="nav-text">2.2.2.实体类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-3-controller"><span class="nav-text">2.2.3.controller</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-4-service"><span class="nav-text">2.2.4.service</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-5-mapper"><span class="nav-text">2.2.5.mapper</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-6-启动并测试"><span class="nav-text">2.2.6.启动并测试</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-跨域问题"><span class="nav-text">3.跨域问题</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-为什么有跨域问题？"><span class="nav-text">3.1.为什么有跨域问题？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-解决跨域问题的方案"><span class="nav-text">3.2.解决跨域问题的方案</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-cors解决跨域"><span class="nav-text">3.3.cors解决跨域</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-1-什么是cors"><span class="nav-text">5.3.1.什么是cors</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-2-原理有点复杂"><span class="nav-text">3.3.2.原理有点复杂</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-2-1-简单请求"><span class="nav-text">3.3.2.1.简单请求</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-2-2-特殊请求"><span class="nav-text">3.3.2.2.特殊请求</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-3-实现非常简单"><span class="nav-text">3.3.3.实现非常简单</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-品牌的查询"><span class="nav-text">4.品牌的查询</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-后台提供查询接口"><span class="nav-text">4.1.后台提供查询接口</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-1-数据库表"><span class="nav-text">4.1.1.数据库表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-2-实体类"><span class="nav-text">4.1.2.实体类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-3-mapper"><span class="nav-text">4.1.3.mapper</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-4-controller"><span class="nav-text">4.1.4.controller</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-5-Service"><span class="nav-text">4.1.5.Service</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-6-测试"><span class="nav-text">4.1.6.测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-异步查询工具axios"><span class="nav-text">4.2.异步查询工具axios</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-1-axios入门"><span class="nav-text">4.2.1.axios入门</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-2-axios的全局配置"><span class="nav-text">4.2.2.axios的全局配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-3-项目中使用"><span class="nav-text">4.2.3.项目中使用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-3-完成分页和过滤"><span class="nav-text">4.3.完成分页和过滤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-1-分页"><span class="nav-text">4.3.1.分页</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-2-过滤"><span class="nav-text">4.3.2.过滤</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="摘星"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">摘星</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">261</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">142</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/zhangkexuan" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zhangkexuan" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/kexuan_zhang@qq.com" title="E-Mail → kexuan_zhang@qq.com"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2019 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">摘星</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>

<!-- ҳ����С���� -->
<script type="text/javascript" src="/js/clicklove.js"></script>
