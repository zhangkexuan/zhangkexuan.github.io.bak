<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="后台的开发，主要就是对数据库的增删改查，上文我们细谈了查询，本文重点谈如何增加，其实删除和更改也差不多，主要变动在mapper上：  新增操作 QS工具 图片上传 FastDFS">
<meta property="og:type" content="article">
<meta property="og:title" content="leyou后台#4-品牌增加">
<meta property="og:url" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/index.html">
<meta property="og:site_name" content="摘星">
<meta property="og:description" content="后台的开发，主要就是对数据库的增删改查，上文我们细谈了查询，本文重点谈如何增加，其实删除和更改也差不多，主要变动在mapper上：  新增操作 QS工具 图片上传 FastDFS">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1545222288968.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1545222410267.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1545222464105.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1545222628405.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1545222756536.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1530674011487.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1530674402709.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1545221936052.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1530687657711.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1530688192442.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1545221873038.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1530690428352.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1526140298249.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1532827997361.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1530696121642.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1530696509189.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1539821449329.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1532850873556.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/qs-2.gif">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1545223244002.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1530698685973.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1545223341933.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1530713222558.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1530715294772.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1530715390747.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1530715447962.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1530715487863.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1530717442747.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1545223629762.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1545223731347.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1530720235186.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1530720263937.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1530720298725.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1530722029884.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1530722280952.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1530722617437.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1530722674897.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1530722728379.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1526205318630.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1526205664373.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1526205705687.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1528196441781.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1526206304954.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1528206263148.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1543400932873.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1528207829275.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1532920403019.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1532920492769.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1528208647458.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1528208592430.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1528210076570.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1528210349042.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1532923048027.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1528210800331.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1528210594296.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1528211066645.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1528211235872.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1526222999115.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1526224372366.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1526224447288.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1526224495244.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1526224563838.png">
<meta property="og:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1526224628514.png">
<meta property="article:published_time" content="2020-05-21T18:20:44.000Z">
<meta property="article:modified_time" content="2020-05-21T18:20:44.000Z">
<meta property="article:author" content="摘星">
<meta property="article:tag" content="FastDFS">
<meta property="article:tag" content="nginx">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/1545222288968.png">

<link rel="canonical" href="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>leyou后台#4-品牌增加 | 摘星</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">摘星</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/22/old/leyou%E5%90%8E%E5%8F%B0-4-%E5%93%81%E7%89%8C%E5%A2%9E%E5%8A%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="摘星">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="摘星">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          leyou后台#4-品牌增加
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-05-22 02:20:44" itemprop="dateCreated datePublished" datetime="2020-05-22T02:20:44+08:00">2020-05-22</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/leyou/" itemprop="url" rel="index"><span itemprop="name">leyou</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>后台的开发，主要就是对数据库的增删改查，上文我们细谈了查询，本文重点谈如何增加，其实删除和更改也差不多，主要变动在mapper上：</p>
<ul>
<li>新增操作</li>
<li>QS工具</li>
<li>图片上传</li>
<li>FastDFS</li>
</ul>
<a id="more"></a>

<h1 id="1-品牌的新增"><a href="#1-品牌的新增" class="headerlink" title="1.品牌的新增"></a>1.品牌的新增</h1><p>昨天我们完成了品牌的查询，接下来就是新增功能。点击新增品牌按钮</p>
<p><img src="1545222288968.png" alt="1545222288968"></p>
<p>Brand.vue页面有一个提交按钮：</p>
<p><img src="1545222410267.png" alt="1545222410267"></p>
<p>点击触发addBrand方法：</p>
<p><img src="1545222464105.png" alt="1545222464105"></p>
<p>把数据模型之的show置为true，而页面中有一个弹窗与show绑定：</p>
<p><img src="1545222628405.png" alt="1545222628405"></p>
<p>弹窗中有一个表单子组件，并且是一个局部子组件，有页面可以找到该组件：</p>
<p><img src="1545222756536.png" alt="1545222756536"></p>
<h2 id="1-1-页面实现"><a href="#1-1-页面实现" class="headerlink" title="1.1.页面实现"></a>1.1.页面实现</h2><h3 id="1-1-1-重置表单"><a href="#1-1-1-重置表单" class="headerlink" title="1.1.1.重置表单"></a>1.1.1.重置表单</h3><p>重置表单相对简单，因为v-form组件已经提供了reset方法，用来清空表单数据。只要我们拿到表单组件对象，就可以调用方法了。</p>
<p>我们可以通过<code>$refs</code>内置对象来获取表单组件。</p>
<p>首先，在表单上定义<code>ref</code>属性：</p>
<p><img src="1530674011487.png" alt="1530674011487"></p>
<p>然后，在页面查看<code>this.$refs</code>属性：</p>
<pre class="line-numbers language-js"><code class="language-js">      <span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 重置表单</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>查看如下：</p>
<p><img src="1530674402709.png" alt="1530674402709"></p>
<p>看到<code>this.$refs</code>中只有一个属性，就是<code>myBrandForm</code></p>
<p>我们在clear中来获取表单对象并调用reset方法：</p>
<p><img src="1545221936052.png" alt="1545221936052"></p>
<p>要注意的是，这里我们还手动把this.categories清空了，因为我写的级联选择组件并没有跟表单结合起来。需要手动清空。</p>
<h3 id="1-1-2-表单校验"><a href="#1-1-2-表单校验" class="headerlink" title="1.1.2.表单校验"></a>1.1.2.表单校验</h3><h4 id="1-1-2-1-校验规则"><a href="#1-1-2-1-校验规则" class="headerlink" title="1.1.2.1.校验规则"></a>1.1.2.1.校验规则</h4><p>Vuetify的表单校验，是通过rules属性来指定的：</p>
<p><img src="1530687657711.png" alt="1530687657711"></p>
<p>校验规则的写法：</p>
<p><img src="1530688192442.png" alt="1530688192442"></p>
<p>说明：</p>
<ul>
<li>规则是一个数组</li>
<li>数组中的元素是一个函数，该函数接收表单项的值作为参数，函数返回值两种情况：<ul>
<li>返回true，代表成功，</li>
<li>返回错误提示信息，代表失败</li>
</ul>
</li>
</ul>
<h4 id="1-1-2-2-编写校验"><a href="#1-1-2-2-编写校验" class="headerlink" title="1.1.2.2.编写校验"></a>1.1.2.2.编写校验</h4><p>我们有四个字段：</p>
<ul>
<li>name：做非空校验和长度校验，长度必须大于1</li>
<li>letter：首字母，校验长度为1，非空。</li>
<li>image：图片，不做校验，图片可以为空</li>
<li>categories：非空校验，自定义组件已经帮我们完成，不用写了</li>
</ul>
<p>首先，我们定义规则：</p>
<p><img src="1545221873038.png" alt="1545221873038"></p>
<p>然后，在页面标签中指定：</p>
<pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-text-field</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>brand.name<span class="token punctuation">"</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>请输入品牌名称<span class="token punctuation">"</span></span> <span class="token attr-name">hint</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>例如：oppo<span class="token punctuation">"</span></span> <span class="token attr-name">:rules</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>[rules.required, rules.nameLength]<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-text-field</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-text-field</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>brand.letter<span class="token punctuation">"</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>请输入品牌首字母<span class="token punctuation">"</span></span> <span class="token attr-name">hint</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>例如：O<span class="token punctuation">"</span></span> <span class="token attr-name">:rules</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>[rules.letter]<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-text-field</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>效果：</p>
<p> <img src="1530690428352.png" alt="1530690428352"></p>
<h3 id="1-1-3-表单提交"><a href="#1-1-3-表单提交" class="headerlink" title="1.1.3.表单提交"></a>1.1.3.表单提交</h3><p>在submit方法中添加表单提交的逻辑：</p>
<pre class="line-numbers language-js"><code class="language-js"><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$qs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 表单校验</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>myBrandForm<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 定义一个请求参数对象，通过解构表达式来获取brand中的属性{categories letter name image}</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span>categories<span class="token punctuation">,</span> letter<span class="token punctuation">,</span> <span class="token operator">...</span>params<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>brand<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// params:{name, image, cids, letter}</span>
        <span class="token comment" spellcheck="true">// 数据库中只要保存分类的id即可，因此我们对categories的值进行处理,只保留id，并转为字符串</span>
        params<span class="token punctuation">.</span>cids <span class="token operator">=</span> categories<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>c <span class="token operator">=</span><span class="token operator">></span> c<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 将字母都处理为大写</span>
        params<span class="token punctuation">.</span>letter <span class="token operator">=</span> letter<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 将数据提交到后台</span>
        <span class="token comment" spellcheck="true">// this.$http.post('/item/brand', this.$qs.stringify(params))</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$http</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            method<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>isEdit <span class="token operator">?</span> <span class="token string">'put'</span> <span class="token punctuation">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span>
            url<span class="token punctuation">:</span> <span class="token string">'/item/brand'</span><span class="token punctuation">,</span>
            data<span class="token punctuation">:</span> params
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 关闭窗口</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">"close"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">"保存成功！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"保存失败！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol>
<li><p>通过<code>this.$refs.myBrandForm</code>选中表单，然后调用表单的<code>validate</code>方法，进行表单校验。返回boolean值，true代表校验通过</p>
</li>
<li><p>通过解构表达式来获取brand中的值，categories需要处理，单独获取。其它的存入params对象中</p>
</li>
<li><p>品牌和商品分类的中间表只保存两者的id，而brand.categories中保存的是对象数组，里面有id和name属性，因此这里通过数组的map功能转为id数组，然后通过join方法拼接为字符串</p>
</li>
<li><p>发起请求</p>
</li>
<li><p>弹窗提示成功还是失败，这里用到的是我们的自定义组件功能message组件：</p>
<p><img src="1526140298249.png" alt="1526140298249"></p>
<p>这个插件把<code>$message</code>对象绑定到了Vue的原型上，因此我们可以通过<code>this.$message</code>来直接调用。</p>
<p>包含以下常用方法：</p>
</li>
</ol>
<ul>
<li>info、error、success、warning等，弹出一个带有提示信息的窗口，色调与为普通（灰）、错误（红色）、成功（绿色）和警告（黄色）。使用方法：this.$message.info(“msg”)</li>
<li>confirm：确认框。用法：<code>this.$message.confirm(&quot;确认框的提示信息&quot;)</code>，返回一个Promise。</li>
</ul>
<h2 id="1-2-后台实现新增"><a href="#1-2-后台实现新增" class="headerlink" title="1.2.后台实现新增"></a>1.2.后台实现新增</h2><h3 id="1-2-1-controller"><a href="#1-2-1-controller" class="headerlink" title="1.2.1.controller"></a>1.2.1.controller</h3><p>还是一样，先分析四个内容：</p>
<ul>
<li>请求方式：POST</li>
<li>请求路径：/brand</li>
<li>请求参数：brand对象，外加商品分类的id数组cids</li>
<li>返回值：无，只需要响应状态码</li>
</ul>
<p>代码：</p>
<pre class="line-numbers language-java"><code class="language-java">    <span class="token comment" spellcheck="true">/**
     * 新增品牌
     * @param brand
     * @param cids
     */</span>
    <span class="token annotation punctuation">@PostMapping</span>
    <span class="token keyword">public</span> ResponseEntity<span class="token operator">&lt;</span>Void<span class="token operator">></span> <span class="token function">saveBrand</span><span class="token punctuation">(</span>Brand brand<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"cids"</span><span class="token punctuation">)</span> List<span class="token operator">&lt;</span>Long<span class="token operator">></span> cids<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>brandService<span class="token punctuation">.</span><span class="token function">saveBrand</span><span class="token punctuation">(</span>brand<span class="token punctuation">,</span> cids<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> ResponseEntity<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>HttpStatus<span class="token punctuation">.</span>CREATED<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="1-2-2-Service"><a href="#1-2-2-Service" class="headerlink" title="1.2.2.Service"></a>1.2.2.Service</h3><p>这里要注意，我们不仅要新增品牌，还要维护品牌和商品分类的中间表。</p>
<pre class="line-numbers language-java"><code class="language-java">    <span class="token comment" spellcheck="true">/**
     * 新增品牌
     *
     * @param brand
     * @param cids
     */</span>
    <span class="token annotation punctuation">@Transactional</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">saveBrand</span><span class="token punctuation">(</span>Brand brand<span class="token punctuation">,</span> List<span class="token operator">&lt;</span>Long<span class="token operator">></span> cids<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment" spellcheck="true">// 先新增brand</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>brandMapper<span class="token punctuation">.</span><span class="token function">insertSelective</span><span class="token punctuation">(</span>brand<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// 在新增中间表</span>
        cids<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>cid <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>brandMapper<span class="token punctuation">.</span><span class="token function">insertCategoryAndBrand</span><span class="token punctuation">(</span>cid<span class="token punctuation">,</span> brand<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里调用了brandMapper中的一个自定义方法，来实现中间表的数据新增</p>
<h3 id="1-2-3-Mapper"><a href="#1-2-3-Mapper" class="headerlink" title="1.2.3.Mapper"></a>1.2.3.Mapper</h3><p>通用Mapper只能处理单表，也就是Brand的数据，因此我们手动编写一个方法及sql，实现中间表的新增：</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BrandMapper</span> <span class="token keyword">extends</span> <span class="token class-name">Mapper</span><span class="token operator">&lt;</span>Brand<span class="token operator">></span> <span class="token punctuation">{</span>

    <span class="token comment" spellcheck="true">/**
     * 新增商品分类和品牌中间表数据
     * @param cid 商品分类id
     * @param bid 品牌id
     * @return
     */</span>
    <span class="token annotation punctuation">@Insert</span><span class="token punctuation">(</span><span class="token string">"INSERT INTO tb_category_brand(category_id, brand_id) VALUES (#{cid},#{bid})"</span><span class="token punctuation">)</span>
    <span class="token keyword">int</span> <span class="token function">insertBrandAndCategory</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"cid"</span><span class="token punctuation">)</span> Long cid<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"bid"</span><span class="token punctuation">)</span> Long bid<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="1-2-4-测试"><a href="#1-2-4-测试" class="headerlink" title="1.2.4.测试"></a>1.2.4.测试</h3><p><img src="1532827997361.png" alt="1532827997361"></p>
<p>400：请求参数不合法</p>
<h2 id="1-3-解决400"><a href="#1-3-解决400" class="headerlink" title="1.3.解决400"></a>1.3.解决400</h2><h3 id="1-3-1-原因分析"><a href="#1-3-1-原因分析" class="headerlink" title="1.3.1.原因分析"></a>1.3.1.原因分析</h3><p>我们填写表单并提交，发现报错了。查看控制台的请求详情：</p>
<p><img src="1530696121642.png" alt="1530696121642"></p>
<p>发现请求的数据格式是JSON格式。</p>
<blockquote>
<p>原因分析：</p>
</blockquote>
<p>axios处理请求体的原则会根据请求数据的格式来定：</p>
<ul>
<li><p>如果请求体是对象：会转为json发送</p>
</li>
<li><p>如果请求体是String：会作为普通表单请求发送，但需要我们自己保证String的格式是键值对。</p>
<p>如：name=jack&amp;age=12</p>
</li>
</ul>
<h3 id="1-3-2-QS工具"><a href="#1-3-2-QS工具" class="headerlink" title="1.3.2.QS工具"></a>1.3.2.QS工具</h3><p>QS是一个第三方库，我们可以用<code>npm install qs --save</code>来安装。不过我们在项目中已经集成了，大家无需安装：</p>
<p><img src="1530696509189.png" alt="1530696509189"></p>
<p>这个工具的名字：QS，即Query String，请求参数字符串。</p>
<p>什么是请求参数字符串？例如： name=jack&amp;age=21</p>
<p>QS工具可以便捷的实现 JS的Object与QueryString的转换。</p>
<p>在我们的项目中，将QS注入到了Vue的原型对象中，我们可以通过<code>this.$qs</code>来获取这个工具：</p>
<p><img src="1539821449329.png" alt="1539821449329"></p>
<p>我们将<code>this.$qs</code>对象打印到控制台：</p>
<pre class="line-numbers language-js"><code class="language-js"><span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$qs<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>发现其中有3个方法：</p>
<p><img src="1532850873556.png" alt="1532850873556"></p>
<p>这里我们要使用的方法是stringify，它可以把Object转为QueryString。</p>
<p>测试一下，使用浏览器工具，把qs对象保存为一个临时变量temp1，然后调用stringify方法：</p>
<p><img src="qs-2.gif" alt="1526182230872"></p>
<p>成功将person对象变成了 name=zhangsan&amp;age=30的字符串了</p>
<h3 id="1-3-3-解决问题"><a href="#1-3-3-解决问题" class="headerlink" title="1.3.3.解决问题"></a>1.3.3.解决问题</h3><p>修改页面，对参数处理后发送：</p>
<p><img src="1545223244002.png" alt="1545223244002"></p>
<p>然后再次发起请求，发现请求成功：</p>
<p><img src="1530698685973.png" alt="1530698685973"></p>
<h2 id="1-4-新增完成后关闭窗口"><a href="#1-4-新增完成后关闭窗口" class="headerlink" title="1.4.新增完成后关闭窗口"></a>1.4.新增完成后关闭窗口</h2><p>我们发现有一个问题：新增不管成功还是失败，窗口都一致在这里，不会关闭。</p>
<p>这样很不友好，我们希望如果新增失败，窗口保持；但是新增成功，窗口关闭才对。</p>
<p>因此，我们需要<strong>在新增的ajax请求完成以后，关闭窗口</strong></p>
<p>但问题在于，控制窗口是否显示的标记在父组件：MyBrand.vue中。子组件如何才能操作父组件的属性？或者告诉父组件该关闭窗口了？</p>
<p>之前我们讲过一个父子组件的通信，有印象吗？</p>
<ul>
<li>第一步：在父组件中定义一个函数，用来关闭窗口，不过之前已经定义过了。父组件在使用子组件时，绑定事件，关联到这个函数：Brand.vue</li>
</ul>
<pre class="line-numbers language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!--对话框的内容，表单--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-card-text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>px-5<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">height</span><span class="token punctuation">:</span><span class="token number">400</span>px</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>brand-form</span> <span class="token attr-name">@close</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>closeWindow<span class="token punctuation">"</span></span> <span class="token attr-name">:oldBrand</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>oldBrand<span class="token punctuation">"</span></span> <span class="token attr-name">:isEdit</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>isEdit<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-card-text</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>第二步，子组件通过<code>this.$emit</code>调用父组件的函数：BrandForm.vue</li>
</ul>
<p><img src="1545223341933.png" alt="1545223341933"></p>
<p>测试一下，保存成功：</p>
<p><img src="1530713222558.png" alt="1530713222558"></p>
<p>我们优化一下，关闭的同时重新加载数据：</p>
<pre class="line-numbers language-js"><code class="language-js"><span class="token function">closeWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 关闭窗口</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>show <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 重新加载数据</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getDataFromServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="2-实现图片上传"><a href="#2-实现图片上传" class="headerlink" title="2.实现图片上传"></a>2.实现图片上传</h1><p>刚才的新增实现中，我们并没有上传图片，接下来我们一起完成图片上传逻辑。</p>
<p>文件的上传并不只是在品牌管理中有需求，以后的其它服务也可能需要，因此我们创建一个独立的微服务，专门处理各种上传。</p>
<h2 id="2-1-搭建项目"><a href="#2-1-搭建项目" class="headerlink" title="2.1.搭建项目"></a>2.1.搭建项目</h2><h3 id="2-1-1-创建module"><a href="#2-1-1-创建module" class="headerlink" title="2.1.1.创建module"></a>2.1.1.创建module</h3><p><img src="1530715294772.png" alt="1530715294772"></p>
<p><img src="1530715390747.png" alt="1530715390747"></p>
<p><img src="1530715447962.png" alt="1530715447962"></p>
<p><img src="1530715487863.png" alt="1530715487863"></p>
<h3 id="2-1-2-依赖"><a href="#2-1-2-依赖" class="headerlink" title="2.1.2.依赖"></a>2.1.2.依赖</h3><p>我们需要EurekaClient和web依赖：</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">"</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>leyou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.leyou.parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.0.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">></span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.leyou.upload<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>leyou-upload<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.0.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-netflix-eureka-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="2-1-3-编写配置"><a href="#2-1-3-编写配置" class="headerlink" title="2.1.3.编写配置"></a>2.1.3.编写配置</h3><pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8082</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> upload<span class="token punctuation">-</span>service
  <span class="token key atrule">servlet</span><span class="token punctuation">:</span>
    <span class="token key atrule">multipart</span><span class="token punctuation">:</span>
      <span class="token key atrule">max-file-size</span><span class="token punctuation">:</span> 5MB <span class="token comment" spellcheck="true"># 限制文件上传的大小</span>
<span class="token comment" spellcheck="true"># Eureka</span>
<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>10086/eureka
  <span class="token key atrule">instance</span><span class="token punctuation">:</span>
    <span class="token key atrule">lease-renewal-interval-in-seconds</span><span class="token punctuation">:</span> <span class="token number">5 </span><span class="token comment" spellcheck="true"># 每隔5秒发送一次心跳</span>
    <span class="token key atrule">lease-expiration-duration-in-seconds</span><span class="token punctuation">:</span> <span class="token number">10 </span><span class="token comment" spellcheck="true"># 10秒不发送就过期</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>需要注意的是，我们应该添加了限制文件大小的配置</p>
<h3 id="2-1-4-引导类"><a href="#2-1-4-引导类" class="headerlink" title="2.1.4.引导类"></a>2.1.4.引导类</h3><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableDiscoveryClient</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LeyouUploadApplication</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>LeyouUploadApplication<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>结构：</p>
<p> <img src="1530717442747.png" alt="1530717442747"></p>
<h2 id="2-2-编写上传功能"><a href="#2-2-编写上传功能" class="headerlink" title="2.2.编写上传功能"></a>2.2.编写上传功能</h2><p>文件上传功能，也是自定义组件完成的，参照自定义组件用法指南：</p>
<p><img src="1545223629762.png" alt="1545223629762"></p>
<p>在页面中的使用：</p>
<p><img src="1545223731347.png" alt="1545223731347"></p>
<h3 id="2-2-1-controller"><a href="#2-2-1-controller" class="headerlink" title="2.2.1.controller"></a>2.2.1.controller</h3><p>编写controller需要知道4个内容：结合用法指南</p>
<ul>
<li>请求方式：上传肯定是POST</li>
<li>请求路径：/upload/image</li>
<li>请求参数：文件，参数名是file，SpringMVC会封装为一个接口：MultipartFile</li>
<li>返回结果：上传成功后得到的文件的url路径，也就是返回String</li>
</ul>
<p>代码如下：</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Controller</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"upload"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UploadController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> UploadService uploadService<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * 图片上传
     * @param file
     * @return
     */</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"image"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> ResponseEntity<span class="token operator">&lt;</span>String<span class="token operator">></span> <span class="token function">uploadImage</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"file"</span><span class="token punctuation">)</span> MultipartFile file<span class="token punctuation">)</span><span class="token punctuation">{</span>
        String url <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>uploadService<span class="token punctuation">.</span><span class="token function">upload</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> ResponseEntity<span class="token punctuation">.</span><span class="token function">badRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> ResponseEntity<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>HttpStatus<span class="token punctuation">.</span>CREATED<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="2-2-2-service"><a href="#2-2-2-service" class="headerlink" title="2.2.2.service"></a>2.2.2.service</h3><p>在上传文件过程中，我们需要对上传的内容进行校验：</p>
<ol>
<li>校验文件大小</li>
<li>校验文件的媒体类型</li>
<li>校验文件的内容</li>
</ol>
<p>文件大小在Spring的配置文件中设置，因此已经会被校验，我们不用管。</p>
<p>具体代码：</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UploadService</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> List<span class="token operator">&lt;</span>String<span class="token operator">></span> CONTENT_TYPES <span class="token operator">=</span> Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">"image/jpeg"</span><span class="token punctuation">,</span> <span class="token string">"image/gif"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> Logger LOGGER <span class="token operator">=</span> LoggerFactory<span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span>UploadService<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> String <span class="token function">upload</span><span class="token punctuation">(</span>MultipartFile file<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        String originalFilename <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 校验文件的类型</span>
        String contentType <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">getContentType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>CONTENT_TYPES<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>contentType<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 文件类型不合法，直接返回null</span>
            LOGGER<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"文件类型不合法：{}"</span><span class="token punctuation">,</span> originalFilename<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> null<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 校验文件的内容</span>
            BufferedImage bufferedImage <span class="token operator">=</span> ImageIO<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>bufferedImage <span class="token operator">==</span> null<span class="token punctuation">)</span><span class="token punctuation">{</span>
                LOGGER<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"文件内容不合法：{}"</span><span class="token punctuation">,</span> originalFilename<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> null<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment" spellcheck="true">// 保存到服务器</span>
            file<span class="token punctuation">.</span><span class="token function">transferTo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"C:\\leyou\\images\\"</span> <span class="token operator">+</span> originalFilename<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment" spellcheck="true">// 生成url地址，返回</span>
            <span class="token keyword">return</span> <span class="token string">"http://image.leyou.com/"</span> <span class="token operator">+</span> originalFilename<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            LOGGER<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"服务器内部错误：{}"</span><span class="token punctuation">,</span> originalFilename<span class="token punctuation">)</span><span class="token punctuation">;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> null<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里有一个问题：为什么图片地址需要使用另外的url？</p>
<ul>
<li>图片不能保存在服务器内部，这样会对服务器产生额外的加载负担</li>
<li>一般静态资源都应该使用独立域名，这样访问静态资源时不会携带一些不必要的cookie，减小请求的数据量</li>
</ul>
<h3 id="2-2-3-测试上传"><a href="#2-2-3-测试上传" class="headerlink" title="2.2.3.测试上传"></a>2.2.3.测试上传</h3><p>我们通过RestClient工具来测试：</p>
<p><img src="1530720235186.png" alt="1530720235186"></p>
<p>结果：</p>
<p><img src="1530720263937.png" alt="1530720263937"></p>
<p>去目录下查看：</p>
<p><img src="1530720298725.png" alt="1530720298725"></p>
<p>上传成功！</p>
<h2 id="2-3-绕过网关"><a href="#2-3-绕过网关" class="headerlink" title="2.3.绕过网关"></a>2.3.绕过网关</h2><p>图片上传是文件的传输，如果也经过Zuul网关的代理，文件就会经过多次网路传输，造成不必要的网络负担。在高并发时，可能导致网络阻塞，Zuul网关不可用。这样我们的整个系统就瘫痪了。</p>
<p>所以，我们上传文件的请求就不经过网关来处理了。</p>
<h3 id="2-3-1-Zuul的路由过滤"><a href="#2-3-1-Zuul的路由过滤" class="headerlink" title="2.3.1.Zuul的路由过滤"></a>2.3.1.Zuul的路由过滤</h3><p>Zuul中提供了一个ignored-patterns属性，用来忽略不希望路由的URL路径，示例：</p>
<pre class="line-numbers language-properties"><code class="language-properties"><span class="token attr-name">zuul.ignored-patterns</span><span class="token punctuation">:</span> <span class="token attr-value">/upload/**</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>路径过滤会对一切微服务进行判定。</p>
<p>Zuul还提供了<code>ignored-services</code>属性，进行服务过滤：</p>
<pre class="line-numbers language-properties"><code class="language-properties"><span class="token attr-name">zuul.ignored-services</span><span class="token punctuation">:</span> <span class="token attr-value">upload-servie</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>我们这里采用忽略服务：</p>
<pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">zuul</span><span class="token punctuation">:</span>
  <span class="token key atrule">ignored-services</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> upload<span class="token punctuation">-</span>service <span class="token comment" spellcheck="true"># 忽略upload-service服务</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>上面的配置采用了集合语法，代表可以配置多个。</p>
<h3 id="2-3-2-Nginx的rewrite指令"><a href="#2-3-2-Nginx的rewrite指令" class="headerlink" title="2.3.2.Nginx的rewrite指令"></a>2.3.2.Nginx的rewrite指令</h3><p>现在，我们修改页面的访问路径：</p>
<pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-upload</span>
      <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>brand.image<span class="token punctuation">"</span></span> 
      <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/upload/image<span class="token punctuation">"</span></span> 
      <span class="token attr-name">:multiple</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span> 
      <span class="token attr-name">:pic-width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>250<span class="token punctuation">"</span></span> <span class="token attr-name">:pic-height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>90<span class="token punctuation">"</span></span>
      <span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>查看页面的请求路径：</p>
<p><img src="1530722029884.png" alt="1530722029884"></p>
<p>可以看到这个地址不对，依然是去找Zuul网关，因为我们的系统全局配置了URL地址。怎么办？</p>
<p>有同学会想：修改页面请求地址不就好了。</p>
<p>注意：原则上，我们是不能把除了网关以外的服务对外暴露的，不安全。</p>
<p>既然不能修改页面请求，那么就只能在Nginx反向代理上做文章了。</p>
<p>我们修改nginx配置，将以/api/upload开头的请求拦截下来，转交到真实的服务地址:</p>
<pre class="line-numbers language-nginx"><code class="language-nginx"><span class="token keyword">location</span> <span class="token operator">/</span>api<span class="token operator">/</span>upload <span class="token punctuation">{</span>
    <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token punctuation">:</span><span class="token number">8082</span><span class="token punctuation">;</span>
    <span class="token keyword">proxy_connect_timeout</span> <span class="token number">600</span><span class="token punctuation">;</span>
    <span class="token keyword">proxy_read_timeout</span> <span class="token number">600</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这样写大家觉得对不对呢？</p>
<p>显然是不对的，因为ip和端口虽然对了，但是路径没变，依然是：<a href="http://127.0.0.1:8002/api/upload/image" target="_blank" rel="noopener">http://127.0.0.1:8002/api/upload/image</a></p>
<p>前面多了一个/api</p>
<p>Nginx提供了rewrite指令，用于对地址进行重写，语法规则：</p>
<pre class="line-numbers language-nginx"><code class="language-nginx"><span class="token keyword">rewrite</span> <span class="token string">"用来匹配路径的正则"</span> 重写后的路径 <span class="token punctuation">[</span>指令<span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>我们的案例：</p>
<pre class="line-numbers language-nginx"><code class="language-nginx">    <span class="token keyword">server</span> <span class="token punctuation">{</span>
        <span class="token keyword">listen</span>       <span class="token number">80</span><span class="token punctuation">;</span>
        <span class="token keyword">server_name</span>  api<span class="token punctuation">.</span>leyou<span class="token punctuation">.</span>com<span class="token punctuation">;</span>

        <span class="token keyword">proxy_set_header</span> X<span class="token operator">-</span>Forwarded<span class="token operator">-</span>Host <span class="token variable">$host</span><span class="token punctuation">;</span>
        <span class="token keyword">proxy_set_header</span> X<span class="token operator">-</span>Forwarded<span class="token operator">-</span><span class="token keyword">Server</span> <span class="token variable">$host</span><span class="token punctuation">;</span>
        <span class="token keyword">proxy_set_header</span> X<span class="token operator">-</span>Forwarded<span class="token operator">-</span>For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true"># 上传路径的映射</span>
        <span class="token keyword">location</span> <span class="token operator">/</span>api<span class="token operator">/</span>upload <span class="token punctuation">{</span>    
            <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token punctuation">:</span><span class="token number">8082</span><span class="token punctuation">;</span>
            <span class="token keyword">proxy_connect_timeout</span> <span class="token number">600</span><span class="token punctuation">;</span>
            <span class="token keyword">proxy_read_timeout</span> <span class="token number">600</span><span class="token punctuation">;</span>

            <span class="token keyword">rewrite</span> <span class="token string">"^/api/(.*)$"</span> <span class="token operator">/</span>$<span class="token number">1</span> <span class="token keyword">break</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span>

        <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
            <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token punctuation">:</span><span class="token number">10010</span><span class="token punctuation">;</span>
            <span class="token keyword">proxy_connect_timeout</span> <span class="token number">600</span><span class="token punctuation">;</span>
            <span class="token keyword">proxy_read_timeout</span> <span class="token number">600</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><p>首先，我们映射路径是/api/upload，而下面一个映射路径是 / ，根据最长路径匹配原则，/api/upload优先级更高。也就是说，凡是以/api/upload开头的路径，都会被第一个配置处理</p>
</li>
<li><p><code>proxy_pass</code>：反向代理，这次我们代理到8082端口，也就是upload-service服务</p>
</li>
<li><p><code>rewrite &quot;^/api/(.*)$&quot; /$1 break</code>，路径重写：</p>
<ul>
<li><p><code>&quot;^/api/(.*)$&quot;</code>：匹配路径的正则表达式，用了分组语法，把<code>/api/</code>以后的所有部分当做1组</p>
</li>
<li><p><code>/$1</code>：重写的目标路径，这里用$1引用前面正则表达式匹配到的分组（组编号从1开始），即<code>/api/</code>后面的所有。这样新的路径就是除去<code>/api/</code>以外的所有，就达到了去除<code>/api</code>前缀的目的</p>
</li>
<li><p><code>break</code>：指令，常用的有2个，分别是：last、break</p>
<ul>
<li>last：重写路径结束后，将得到的路径重新进行一次路径匹配</li>
<li>break：重写路径结束后，不再重新匹配路径。</li>
</ul>
<p>我们这里不能选择last，否则以新的路径/upload/image来匹配，就不会被正确的匹配到8082端口了</p>
</li>
</ul>
</li>
</ul>
<p>修改完成，输入<code>nginx -s reload</code>命令重新加载配置。然后再次上传试试。</p>
<h2 id="2-4-跨域问题"><a href="#2-4-跨域问题" class="headerlink" title="2.4.跨域问题"></a>2.4.跨域问题</h2><p>重启nginx，再次上传，发现跟上次的状态码已经不一样了，但是依然报错：</p>
<p><img src="1530722280952.png" alt="1526200471676"></p>
<p>不过庆幸的是，这个错误已经不是第一次见了，跨域问题。</p>
<p>我们在upload-service中添加一个CorsFilter即可：</p>
<p> <img src="1530722617437.png" alt="1530722617437"></p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LeyouCorsConfiguration</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> CorsFilter <span class="token function">corsFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//1.添加CORS配置信息</span>
        CorsConfiguration config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CorsConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//1) 允许的域,不要写*，否则cookie就无法使用了</span>
        config<span class="token punctuation">.</span><span class="token function">addAllowedOrigin</span><span class="token punctuation">(</span><span class="token string">"http://manage.leyou.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//3) 允许的请求方式</span>
        config<span class="token punctuation">.</span><span class="token function">addAllowedMethod</span><span class="token punctuation">(</span><span class="token string">"OPTIONS"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">addAllowedMethod</span><span class="token punctuation">(</span><span class="token string">"POST"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 4）允许的头信息</span>
        config<span class="token punctuation">.</span><span class="token function">addAllowedHeader</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//2.添加映射路径，我们拦截一切请求</span>
        UrlBasedCorsConfigurationSource configSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UrlBasedCorsConfigurationSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        configSource<span class="token punctuation">.</span><span class="token function">registerCorsConfiguration</span><span class="token punctuation">(</span><span class="token string">"/**"</span><span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//3.返回新的CorsFilter.</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CorsFilter</span><span class="token punctuation">(</span>configSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>再次测试：</p>
<p><img src="1530722674897.png" alt="1530722674897"></p>
<p>不过，非常遗憾的是，访问图片地址，却没有响应。</p>
<p><img src="1530722728379.png" alt="1530722728379"></p>
<p>这是因为我们并没有任何服务器对应image.leyou.com这个域名。。</p>
<p>这个问题，我们暂时放下，回头再来解决。</p>
<h2 id="2-5-文件上传的缺陷"><a href="#2-5-文件上传的缺陷" class="headerlink" title="2.5.文件上传的缺陷"></a>2.5.文件上传的缺陷</h2><p>先思考一下，现在上传的功能，有没有什么问题？</p>
<p>上传本身没有任何问题，问题出在保存文件的方式，我们是保存在服务器机器，就会有下面的问题：</p>
<ul>
<li>单机器存储，存储能力有限</li>
<li>无法进行水平扩展，因为多台机器的文件无法共享,会出现访问不到的情况</li>
<li>数据没有备份，有单点故障风险</li>
<li>并发能力差</li>
</ul>
<p>这个时候，最好使用分布式文件存储来代替本地文件存储。</p>
<h1 id="3-FastDFS"><a href="#3-FastDFS" class="headerlink" title="3.FastDFS"></a>3.FastDFS</h1><h2 id="3-1-什么是分布式文件系统"><a href="#3-1-什么是分布式文件系统" class="headerlink" title="3.1.什么是分布式文件系统"></a>3.1.什么是分布式文件系统</h2><p>分布式文件系统（Distributed File System）是指文件系统管理的物理存储资源不一定直接连接在本地节点上，而是通过计算机网络与节点相连。 </p>
<p>通俗来讲：</p>
<ul>
<li>传统文件系统管理的文件就存储在本机。</li>
<li>分布式文件系统管理的文件存储在很多机器，这些机器通过网络连接，要被统一管理。无论是上传或者访问文件，都需要通过管理中心来访问</li>
</ul>
<h2 id="3-2-什么是FastDFS"><a href="#3-2-什么是FastDFS" class="headerlink" title="3.2.什么是FastDFS"></a>3.2.什么是FastDFS</h2><p>FastDFS是由淘宝的余庆先生所开发的一个轻量级、高性能的开源分布式文件系统。用纯C语言开发，功能丰富：</p>
<ul>
<li>文件存储</li>
<li>文件同步</li>
<li>文件访问（上传、下载）</li>
<li>存取负载均衡</li>
<li>在线扩容</li>
</ul>
<p>适合有大容量存储需求的应用或系统。同类的分布式文件系统有谷歌的GFS、HDFS（Hadoop）、TFS（淘宝）等。</p>
<h2 id="3-3-FastDFS的架构"><a href="#3-3-FastDFS的架构" class="headerlink" title="3.3.FastDFS的架构"></a>3.3.FastDFS的架构</h2><h3 id="3-3-1-架构图"><a href="#3-3-1-架构图" class="headerlink" title="3.3.1.架构图"></a>3.3.1.架构图</h3><p>先上图：</p>
<p> <img src="1526205318630.png" alt="1526205318630"></p>
<p>FastDFS两个主要的角色：Tracker Server 和 Storage Server 。</p>
<ul>
<li>Tracker Server：跟踪服务器，主要负责调度storage节点与client通信，在访问上起负载均衡的作用，和记录storage节点的运行状态，是连接client和storage节点的枢纽。 </li>
<li>Storage Server：存储服务器，保存文件和文件的meta data（元数据），每个storage server会启动一个单独的线程主动向Tracker cluster中每个tracker server报告其状态信息，包括磁盘使用情况，文件同步情况及文件上传下载次数统计等信息</li>
<li>Group：文件组，多台Storage Server的集群。上传一个文件到同组内的一台机器上后，FastDFS会将该文件即时同步到同组内的其它所有机器上，起到备份的作用。不同组的服务器，保存的数据不同，而且相互独立，不进行通信。 </li>
<li>Tracker Cluster：跟踪服务器的集群，有一组Tracker Server（跟踪服务器）组成。</li>
<li>Storage Cluster ：存储集群，有多个Group组成。</li>
</ul>
<h3 id="3-3-2-上传和下载流程"><a href="#3-3-2-上传和下载流程" class="headerlink" title="3.3.2.上传和下载流程"></a>3.3.2.上传和下载流程</h3><blockquote>
<p>上传</p>
</blockquote>
<p> <img src="1526205664373.png" alt="1526205664373"></p>
<ol>
<li>Client通过Tracker server查找可用的Storage server。</li>
<li>Tracker server向Client返回一台可用的Storage server的IP地址和端口号。</li>
<li>Client直接通过Tracker server返回的IP地址和端口与其中一台Storage server建立连接并进行文件上传。</li>
<li>上传完成，Storage server返回Client一个文件ID，文件上传结束。</li>
</ol>
<blockquote>
<p>下载</p>
</blockquote>
<p> <img src="1526205705687.png" alt="1526205705687"></p>
<ol>
<li>Client通过Tracker server查找要下载文件所在的的Storage server。</li>
<li>Tracker server向Client返回包含指定文件的某个Storage server的IP地址和端口号。</li>
<li>Client直接通过Tracker server返回的IP地址和端口与其中一台Storage server建立连接并指定要下载文件。</li>
<li>下载文件成功。</li>
</ol>
<h2 id="3-4-安装和使用"><a href="#3-4-安装和使用" class="headerlink" title="3.4.安装和使用"></a>3.4.安装和使用</h2><p>参考课前资料的：</p>
<p><img src="1528196441781.png" alt="1528196441781"></p>
<h2 id="3-5-java客户端"><a href="#3-5-java客户端" class="headerlink" title="3.5.java客户端"></a>3.5.java客户端</h2><p>余庆先生提供了一个Java客户端，但是作为一个C程序员，写的java代码可想而知。而且已经很久不维护了。</p>
<p>这里推荐一个开源的FastDFS客户端，支持最新的SpringBoot2.0。 </p>
<p>配置使用极为简单，支持连接池，支持自动生成缩略图，狂拽酷炫吊炸天啊，有木有。</p>
<p>地址：<a href="https://github.com/tobato/FastDFS_Client" target="_blank" rel="noopener">tobato/FastDFS_client</a></p>
<p> <img src="1526206304954.png" alt="1526206304954"></p>
<p>接下来，我们就用FastDFS改造<strong>leyou-upload</strong>工程。</p>
<h3 id="3-5-1-引入依赖"><a href="#3-5-1-引入依赖" class="headerlink" title="3.5.1.引入依赖"></a>3.5.1.引入依赖</h3><p>在父工程中，我们已经管理了依赖，版本为：</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fastDFS.client.version</span><span class="token punctuation">></span></span>1.26.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fastDFS.client.version</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>因此，这里我们直接在taotao-upload工程的pom.xml中引入坐标即可：</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.github.tobato<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>fastdfs-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="3-5-2-引入配置类"><a href="#3-5-2-引入配置类" class="headerlink" title="3.5.2.引入配置类"></a>3.5.2.引入配置类</h3><p> <img src="1528206263148.png" alt="1528206263148"></p>
<p>纯java配置：</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span>FdfsClientConfig<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">// 解决jmx重复注册bean的问题</span>
<span class="token annotation punctuation">@EnableMBeanExport</span><span class="token punctuation">(</span>registration <span class="token operator">=</span> RegistrationPolicy<span class="token punctuation">.</span>IGNORE_EXISTING<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FastClientImporter</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="3-5-3-编写FastDFS属性"><a href="#3-5-3-编写FastDFS属性" class="headerlink" title="3.5.3.编写FastDFS属性"></a>3.5.3.编写FastDFS属性</h3><p>在application.yml配置文件中追加如下内容：</p>
<pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">fdfs</span><span class="token punctuation">:</span>
  <span class="token key atrule">so-timeout</span><span class="token punctuation">:</span> <span class="token number">1501 </span><span class="token comment" spellcheck="true"># 超时时间</span>
  <span class="token key atrule">connect-timeout</span><span class="token punctuation">:</span> <span class="token number">601 </span><span class="token comment" spellcheck="true"># 连接超时时间</span>
  <span class="token key atrule">thumb-image</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true"># 缩略图</span>
    <span class="token key atrule">width</span><span class="token punctuation">:</span> <span class="token number">60</span>
    <span class="token key atrule">height</span><span class="token punctuation">:</span> <span class="token number">60</span>
  <span class="token key atrule">tracker-list</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true"># tracker地址：你的虚拟机服务器地址+端口（默认是22122）</span>
    <span class="token punctuation">-</span> 192.168.56.101<span class="token punctuation">:</span><span class="token number">22122</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="3-5-4-配置hosts"><a href="#3-5-4-配置hosts" class="headerlink" title="3.5.4.配置hosts"></a>3.5.4.配置hosts</h3><p>将来通过域名：image.leyou.com这个域名访问fastDFS服务器上的图片资源。所以，需要代理到虚拟机地址：</p>
<p>配置hosts文件，使image.leyou.com可以访问fastDFS服务器</p>
<p> <img src="1543400932873.png" alt="1543400932873"></p>
<h3 id="3-5-5-测试"><a href="#3-5-5-测试" class="headerlink" title="3.5.5.测试"></a>3.5.5.测试</h3><p>创建测试类：</p>
<p> <img src="1528207829275.png" alt="1528207829275"></p>
<p>把以下内容copy进去：</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span>SpringRunner<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FastDFSTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> FastFileStorageClient storageClient<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> ThumbImageConfig thumbImageConfig<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testUpload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> FileNotFoundException <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 要上传的文件</span>
        File file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"C:\\Users\\joedy\\Pictures\\xbx1.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 上传并保存图片，参数：1-上传的文件流 2-文件的大小 3-文件的后缀 4-可以不管他</span>
        StorePath storePath <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>storageClient<span class="token punctuation">.</span><span class="token function">uploadFile</span><span class="token punctuation">(</span>
                <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">,</span> file<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"jpg"</span><span class="token punctuation">,</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 带分组的路径</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>storePath<span class="token punctuation">.</span><span class="token function">getFullPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 不带分组的路径</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>storePath<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testUploadAndCreateThumb</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> FileNotFoundException <span class="token punctuation">{</span>
        File file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"C:\\Users\\joedy\\Pictures\\xbx1.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 上传并且生成缩略图</span>
        StorePath storePath <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>storageClient<span class="token punctuation">.</span><span class="token function">uploadImageAndCrtThumbImage</span><span class="token punctuation">(</span>
                <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">,</span> file<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"png"</span><span class="token punctuation">,</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 带分组的路径</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>storePath<span class="token punctuation">.</span><span class="token function">getFullPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 不带分组的路径</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>storePath<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 获取缩略图路径</span>
        String path <span class="token operator">=</span> thumbImageConfig<span class="token punctuation">.</span><span class="token function">getThumbImagePath</span><span class="token punctuation">(</span>storePath<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>结果：</p>
<pre><code>group1/M00/00/00/wKg4ZVsWl5eAdLNZAABAhya2V0c424.jpg
M00/00/00/wKg4ZVsWl5eAdLNZAABAhya2V0c424.jpg</code></pre><pre><code>group1/M00/00/00/wKg4ZVsWmD-ARnWiAABAhya2V0c772.png
M00/00/00/wKg4ZVsWmD-ARnWiAABAhya2V0c772.png
M00/00/00/wKg4ZVsWmD-ARnWiAABAhya2V0c772_60x60.png</code></pre><p>访问第二组第一个路径：</p>
<p><img src="1532920403019.png" alt="1532920403019"></p>
<p>访问最后一个路径（缩略图路径），<strong>注意加组名（group1）</strong>：</p>
<p><img src="1532920492769.png" alt="1532920492769"></p>
<h3 id="3-5-6-改造上传逻辑"><a href="#3-5-6-改造上传逻辑" class="headerlink" title="3.5.6.改造上传逻辑"></a>3.5.6.改造上传逻辑</h3><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UploadService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> FastFileStorageClient storageClient<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> List<span class="token operator">&lt;</span>String<span class="token operator">></span> CONTENT_TYPES <span class="token operator">=</span> Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">"image/jpeg"</span><span class="token punctuation">,</span> <span class="token string">"image/gif"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> Logger LOGGER <span class="token operator">=</span> LoggerFactory<span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span>UploadService<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> String <span class="token function">upload</span><span class="token punctuation">(</span>MultipartFile file<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        String originalFilename <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 校验文件的类型</span>
        String contentType <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">getContentType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>CONTENT_TYPES<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>contentType<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 文件类型不合法，直接返回null</span>
            LOGGER<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"文件类型不合法：{}"</span><span class="token punctuation">,</span> originalFilename<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> null<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 校验文件的内容</span>
            BufferedImage bufferedImage <span class="token operator">=</span> ImageIO<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>bufferedImage <span class="token operator">==</span> null<span class="token punctuation">)</span><span class="token punctuation">{</span>
                LOGGER<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"文件内容不合法：{}"</span><span class="token punctuation">,</span> originalFilename<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> null<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment" spellcheck="true">// 保存到服务器</span>
            <span class="token comment" spellcheck="true">// file.transferTo(new File("C:\\leyou\\images\\" + originalFilename));</span>
            String ext <span class="token operator">=</span> StringUtils<span class="token punctuation">.</span><span class="token function">substringAfterLast</span><span class="token punctuation">(</span>originalFilename<span class="token punctuation">,</span> <span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            StorePath storePath <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>storageClient<span class="token punctuation">.</span><span class="token function">uploadFile</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> file<span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ext<span class="token punctuation">,</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment" spellcheck="true">// 生成url地址，返回</span>
            <span class="token keyword">return</span> <span class="token string">"http://image.leyou.com/"</span> <span class="token operator">+</span> storePath<span class="token punctuation">.</span><span class="token function">getFullPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            LOGGER<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"服务器内部错误：{}"</span><span class="token punctuation">,</span> originalFilename<span class="token punctuation">)</span><span class="token punctuation">;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> null<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>只需要把原来保存文件的逻辑去掉，然后上传到FastDFS即可。</p>
<h3 id="3-5-7-测试"><a href="#3-5-7-测试" class="headerlink" title="3.5.7.测试"></a>3.5.7.测试</h3><p>通过RestClient测试：</p>
<p><img src="1528208647458.png" alt="1528208647458"></p>
<p><img src="1528208592430.png" alt="1528208592430"></p>
<h2 id="3-6-页面测试上传"><a href="#3-6-页面测试上传" class="headerlink" title="3.6.页面测试上传"></a>3.6.页面测试上传</h2><p>发现上传成功：</p>
<p><img src="1528210076570.png" alt="1528210076570"></p>
<p> <img src="1528210349042.png" alt="1528210349042"></p>
<h1 id="4-修改品牌"><a href="#4-修改品牌" class="headerlink" title="4.修改品牌"></a>4.修改品牌</h1><p>修改的难点在于回显。</p>
<p>当我们点击编辑按钮，希望弹出窗口的同时，看到原来的数据：</p>
<p><img src="1532923048027.png" alt="1532923048027"></p>
<h2 id="4-1-点击编辑出现弹窗"><a href="#4-1-点击编辑出现弹窗" class="headerlink" title="4.1.点击编辑出现弹窗"></a>4.1.点击编辑出现弹窗</h2><p>这个比较简单，修改show属性为true即可实现，我们绑定一个点击事件：</p>
<pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-icon</span> <span class="token attr-name">small</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mr-2<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>editItem(props.item)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    edit
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-icon</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>然后编写事件，改变show 的状态：</p>
<p><img src="1528210800331.png" alt="1528210800331"></p>
<p>如果仅仅是这样，编辑按钮与新增按钮将没有任何区别，关键在于，如何回显呢？</p>
<h2 id="4-2-回显数据"><a href="#4-2-回显数据" class="headerlink" title="4.2.回显数据"></a>4.2.回显数据</h2><p>回显数据，就是把当前点击的品牌数据传递到子组件（MyBrandForm）。而父组件给子组件传递数据，通过props属性。</p>
<ul>
<li><p>第一步：在编辑时获取当前选中的品牌信息，并且记录到data中</p>
<p>先在data中定义属性，用来接收用来编辑的brand数据：</p>
<p><img src="1528210594296.png" alt="1528210594296"></p>
<p>我们在页面触发编辑事件时，把当前的brand传递给editBrand方法：</p>
<pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-btn</span> <span class="token attr-name">color</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>info<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>editBrand(props.item)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>编辑<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-btn</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>然后在editBrand中接收数据，赋值给oldBrand：</p>
<pre class="line-numbers language-js"><code class="language-js"><span class="token function">editItem</span><span class="token punctuation">(</span>oldBrand<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 使编辑窗口可见</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dialog <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 初始化编辑的数据</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>oldBrand <span class="token operator">=</span> oldBrand<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>第二步：把获取的brand数据 传递给子组件</p>
<pre class="line-numbers language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!--对话框内容--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-card-text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>px-5<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token comment" spellcheck="true">&lt;!--这是一个表单--></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>my-brand-form</span> <span class="token attr-name">@close</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>close<span class="token punctuation">"</span></span> <span class="token attr-name">:oldBrand</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>oldBrand<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>my-brand-form</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-card-text</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>第三步：在子组件（MyBrandForm.vue）中通过props接收要编辑的brand数据，Vue会自动完成回显</p>
<p>接收数据：</p>
<p><img src="1528211066645.png" alt="1528211066645"></p>
<p>通过watch函数监控oldBrand的变化，把值copy到本地的brand：</p>
<pre class="line-numbers language-js"><code class="language-js">watch<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    oldBrand<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token comment" spellcheck="true">// 监控oldBrand的变化</span>
        <span class="token function">handler</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// 注意不要直接赋值，否则这边的修改会影响到父组件的数据，copy属性即可</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>brand <span class="token operator">=</span>  Object<span class="token punctuation">.</span><span class="token function">deepCopy</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// 为空，初始化brand</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>brand <span class="token operator">=</span> <span class="token punctuation">{</span>
                    name<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                    letter<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                    image<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                    categories<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
            deep<span class="token punctuation">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>Object.deepCopy 自定义的对象进行深度复制的方法。</li>
<li>需要判断监听到的是否为空，如果为空，应该进行初始化</li>
</ul>
</li>
</ul>
<p>测试：发现数据回显了，除了商品分类以外：</p>
<p> <img src="1528211235872.png" alt="1528211235872"></p>
<h2 id="4-3-商品分类回显"><a href="#4-3-商品分类回显" class="headerlink" title="4.3.商品分类回显"></a>4.3.商品分类回显</h2><p>为什么商品分类没有回显？</p>
<p>因为品牌中并没有商品分类数据。我们需要在进入编辑页面之前，查询商品分类信息：</p>
<h3 id="4-3-1-后台提供接口"><a href="#4-3-1-后台提供接口" class="headerlink" title="4.3.1.后台提供接口"></a>4.3.1.后台提供接口</h3><blockquote>
<h4 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h4></blockquote>
<pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
     * 通过品牌id查询商品分类
     * @param bid
     * @return
     */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"bid/{bid}"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> ResponseEntity<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>Category<span class="token operator">>></span> <span class="token function">queryByBrandId</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"bid"</span><span class="token punctuation">)</span> Long bid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    List<span class="token operator">&lt;</span>Category<span class="token operator">></span> list <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>categoryService<span class="token punctuation">.</span><span class="token function">queryByBrandId</span><span class="token punctuation">(</span>bid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>list <span class="token operator">==</span> null <span class="token operator">||</span> list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResponseEntity</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span>HttpStatus<span class="token punctuation">.</span>NOT_FOUND<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> ResponseEntity<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>Service</p>
</blockquote>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> List<span class="token operator">&lt;</span>Category<span class="token operator">></span> <span class="token function">queryByBrandId</span><span class="token punctuation">(</span>Long bid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>categoryMapper<span class="token punctuation">.</span><span class="token function">queryByBrandId</span><span class="token punctuation">(</span>bid<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>mapper</p>
</blockquote>
<p>因为需要通过中间表进行子查询，所以这里要手写Sql：</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
     * 根据品牌id查询商品分类
     * @param bid
     * @return
     */</span>
<span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"SELECT * FROM tb_category WHERE id IN (SELECT category_id FROM tb_category_brand WHERE brand_id = #{bid})"</span><span class="token punctuation">)</span>
List<span class="token operator">&lt;</span>Category<span class="token operator">></span> <span class="token function">queryByBrandId</span><span class="token punctuation">(</span>Long bid<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="4-3-2-前台查询分类并渲染"><a href="#4-3-2-前台查询分类并渲染" class="headerlink" title="4.3.2.前台查询分类并渲染"></a>4.3.2.前台查询分类并渲染</h3><p>我们在编辑页面打开之前，先把数据查询完毕：</p>
<pre class="line-numbers language-js"><code class="language-js"><span class="token function">editBrand</span><span class="token punctuation">(</span>oldBrand<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 根据品牌信息查询商品分类</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$http<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"/item/category/bid/"</span> <span class="token operator">+</span> oldBrand<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span>data<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 控制弹窗可见：</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dialog <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 获取要编辑的brand</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>oldBrand <span class="token operator">=</span> oldBrand
        <span class="token comment" spellcheck="true">// 回显商品分类</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>oldBrand<span class="token punctuation">.</span>categories <span class="token operator">=</span> data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>再次测试：数据成功回显了</p>
<p> <img src="1526222999115.png" alt="1526222999115"></p>
<h3 id="4-3-3-新增窗口数据干扰"><a href="#4-3-3-新增窗口数据干扰" class="headerlink" title="4.3.3.新增窗口数据干扰"></a>4.3.3.新增窗口数据干扰</h3><p>但是，此时却产生了新问题：新增窗口竟然也有数据？</p>
<p>原因：</p>
<pre><code>如果之前打开过编辑，那么在父组件中记录的oldBrand会保留。下次再打开窗口，如果是编辑窗口到没问题，但是新增的话，就会再次显示上次打开的品牌信息了。</code></pre><p>解决：</p>
<pre><code>新增窗口打开前，把数据置空。</code></pre><pre class="line-numbers language-js"><code class="language-js"><span class="token function">addBrand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 控制弹窗可见：</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dialog <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 把oldBrand变为null</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>oldBrand <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="4-3-4-提交表单时判断是新增还是修改"><a href="#4-3-4-提交表单时判断是新增还是修改" class="headerlink" title="4.3.4.提交表单时判断是新增还是修改"></a>4.3.4.提交表单时判断是新增还是修改</h3><p>新增和修改是同一个页面，我们该如何判断？</p>
<p>父组件中点击按钮弹出新增或修改的窗口，因此父组件非常清楚接下来是新增还是修改。</p>
<p>因此，最简单的方案就是，在父组件中定义变量，记录新增或修改状态，当弹出页面时，把这个状态也传递给子组件。</p>
<p>第一步：在父组件中记录状态：</p>
<p> <img src="1526224372366.png" alt="1526224372366"></p>
<p>第二步：在新增和修改前，更改状态：</p>
<p> <img src="1526224447288.png" alt="1526224447288"></p>
<p>第三步：传递给子组件</p>
<p> <img src="1526224495244.png" alt="1526224495244"></p>
<p>第四步，子组件接收标记：</p>
<p> <img src="1526224563838.png" alt="1526224563838"></p>
<p>标题的动态化：</p>
<p> <img src="1526224628514.png" alt="1526224628514"></p>
<p>表单提交动态：</p>
<p>axios除了除了get和post外，还有一个通用的请求方式：</p>
<pre class="line-numbers language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 将数据提交到后台</span>
<span class="token comment" spellcheck="true">// this.$http.post('/item/brand', this.$qs.stringify(params))</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$http</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    method<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>isEdit <span class="token operator">?</span> <span class="token string">'put'</span> <span class="token punctuation">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 动态判断是POST还是PUT</span>
    url<span class="token punctuation">:</span> <span class="token string">'/item/brand'</span><span class="token punctuation">,</span>
    data<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$qs<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>brand<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 关闭窗口</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">"close"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">"保存成功！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"保存失败！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="5-删除"><a href="#5-删除" class="headerlink" title="5.删除"></a>5.删除</h1>
    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/FastDFS/" rel="tag"># FastDFS</a>
              <a href="/tags/nginx/" rel="tag"># nginx</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/05/21/old/leyou%E5%90%8E%E5%8F%B0-3-%E5%88%86%E7%B1%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%81%E7%89%8C%E6%9F%A5%E8%AF%A2/" rel="prev" title="leyou后台#3-分类查询和品牌查询">
      <i class="fa fa-chevron-left"></i> leyou后台#3-分类查询和品牌查询
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/05/23/old/FDFS%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/" rel="next" title="FastDFS服务器搭建">
      FastDFS服务器搭建 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-品牌的新增"><span class="nav-text">1.品牌的新增</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-页面实现"><span class="nav-text">1.1.页面实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-1-重置表单"><span class="nav-text">1.1.1.重置表单</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-2-表单校验"><span class="nav-text">1.1.2.表单校验</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-2-1-校验规则"><span class="nav-text">1.1.2.1.校验规则</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-2-2-编写校验"><span class="nav-text">1.1.2.2.编写校验</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-3-表单提交"><span class="nav-text">1.1.3.表单提交</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-后台实现新增"><span class="nav-text">1.2.后台实现新增</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-1-controller"><span class="nav-text">1.2.1.controller</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-2-Service"><span class="nav-text">1.2.2.Service</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-3-Mapper"><span class="nav-text">1.2.3.Mapper</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-4-测试"><span class="nav-text">1.2.4.测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-解决400"><span class="nav-text">1.3.解决400</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-1-原因分析"><span class="nav-text">1.3.1.原因分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-2-QS工具"><span class="nav-text">1.3.2.QS工具</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-3-解决问题"><span class="nav-text">1.3.3.解决问题</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-4-新增完成后关闭窗口"><span class="nav-text">1.4.新增完成后关闭窗口</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-实现图片上传"><span class="nav-text">2.实现图片上传</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-搭建项目"><span class="nav-text">2.1.搭建项目</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-1-创建module"><span class="nav-text">2.1.1.创建module</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-2-依赖"><span class="nav-text">2.1.2.依赖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-3-编写配置"><span class="nav-text">2.1.3.编写配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-4-引导类"><span class="nav-text">2.1.4.引导类</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-编写上传功能"><span class="nav-text">2.2.编写上传功能</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-1-controller"><span class="nav-text">2.2.1.controller</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-2-service"><span class="nav-text">2.2.2.service</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-3-测试上传"><span class="nav-text">2.2.3.测试上传</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3-绕过网关"><span class="nav-text">2.3.绕过网关</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-1-Zuul的路由过滤"><span class="nav-text">2.3.1.Zuul的路由过滤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-2-Nginx的rewrite指令"><span class="nav-text">2.3.2.Nginx的rewrite指令</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-4-跨域问题"><span class="nav-text">2.4.跨域问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-5-文件上传的缺陷"><span class="nav-text">2.5.文件上传的缺陷</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-FastDFS"><span class="nav-text">3.FastDFS</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-什么是分布式文件系统"><span class="nav-text">3.1.什么是分布式文件系统</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-什么是FastDFS"><span class="nav-text">3.2.什么是FastDFS</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-FastDFS的架构"><span class="nav-text">3.3.FastDFS的架构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-1-架构图"><span class="nav-text">3.3.1.架构图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-2-上传和下载流程"><span class="nav-text">3.3.2.上传和下载流程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-4-安装和使用"><span class="nav-text">3.4.安装和使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-5-java客户端"><span class="nav-text">3.5.java客户端</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-1-引入依赖"><span class="nav-text">3.5.1.引入依赖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-2-引入配置类"><span class="nav-text">3.5.2.引入配置类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-3-编写FastDFS属性"><span class="nav-text">3.5.3.编写FastDFS属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-4-配置hosts"><span class="nav-text">3.5.4.配置hosts</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-5-测试"><span class="nav-text">3.5.5.测试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-6-改造上传逻辑"><span class="nav-text">3.5.6.改造上传逻辑</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-7-测试"><span class="nav-text">3.5.7.测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-6-页面测试上传"><span class="nav-text">3.6.页面测试上传</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-修改品牌"><span class="nav-text">4.修改品牌</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-点击编辑出现弹窗"><span class="nav-text">4.1.点击编辑出现弹窗</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-回显数据"><span class="nav-text">4.2.回显数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-3-商品分类回显"><span class="nav-text">4.3.商品分类回显</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-1-后台提供接口"><span class="nav-text">4.3.1.后台提供接口</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#controller"><span class="nav-text">controller</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-2-前台查询分类并渲染"><span class="nav-text">4.3.2.前台查询分类并渲染</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-3-新增窗口数据干扰"><span class="nav-text">4.3.3.新增窗口数据干扰</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-4-提交表单时判断是新增还是修改"><span class="nav-text">4.3.4.提交表单时判断是新增还是修改</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-删除"><span class="nav-text">5.删除</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="摘星"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">摘星</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">261</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">142</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/zhangkexuan" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zhangkexuan" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/kexuan_zhang@qq.com" title="E-Mail → kexuan_zhang@qq.com"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2019 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">摘星</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>

<!-- ҳ����С���� -->
<script type="text/javascript" src="/js/clicklove.js"></script>
